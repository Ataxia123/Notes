"use strict";var e,t,i,s=require("obsidian");!function(e){e[e.DEFINED=1]="DEFINED",e[e.INFERRED=2]="INFERRED"}(e||(e={})),function(e){e[e.PARENT=0]="PARENT",e[e.CHILD=1]="CHILD",e[e.FRIEND=2]="FRIEND",e[e.NEXT=3]="NEXT"}(t||(t={})),function(e){e[e.TO=1]="TO",e[e.FROM=2]="FROM",e[e.BOTH=3]="BOTH"}(i||(i={}));const n=(e,t,i)=>{const s=e.metadataCache.getFirstLinkpathDest(t,i);return s?s.path:t},u=(e,t)=>{var i,s,u,r;const a=new Set,o=e.matchAll(/[^[]*\[\[(?<wikiLink>[^#\]\|]*)[^\]]*]]|\[[^\]]*]\((?<mdLink>[^)]*)\)/g);let l;for(;!(l=o.next()).done;){if(null===(s=null===(i=null==l?void 0:l.value)||void 0===i?void 0:i.groups)||void 0===s?void 0:s.wikiLink){const e=n(app,l.value.groups.wikiLink,t.path);e&&a.add(e)}if(null===(r=null===(u=null==l?void 0:l.value)||void 0===u?void 0:u.groups)||void 0===r?void 0:r.mdLink){const e=n(app,decodeURIComponent(l.value.groups.mdLink),t.path);e&&a.add(e)}}return Array.from(a)},r=(e,t,i)=>{const s=new Set;if(t.values){const a=Array.from(t.values());a.filter((e=>(null==e?void 0:e.type)&&("file"===e.type||"header"===e.type||"block"==e.type))).forEach((t=>{const u=n(e,t.path,i.path);u&&s.add(u)})),a.filter((e=>Boolean(null==e?void 0:e.values))).forEach((t=>{const n=Array.from(t.values());r(e,n,i).forEach((e=>s.add(e)))}));const o=u(a.filter((e=>"string"==typeof e)).join(" "),i),l=a.filter((e=>(null==e?void 0:e.values)&&"object"==typeof e&&"string"==typeof e.values[0])).map((t=>n(e,t.values[0],i.path)));
//! currently there is an issue with case sensitivity. DataView retains case sensitivity of links for the front matter, but not the others
return Array.from(s).concat(o).concat(l)}if(t.path){const s=n(e,t.path,i.path);return s?[s]:[]}return"string"==typeof t?u(t,i):[]},a=(e,t,i)=>{const s=[],n=new Set;return i.forEach((i=>{const u=t[i];u&&!n.has(i)&&(n.add(i),r(e.app,u,t.file).forEach((e=>s.push({link:e,field:i}))))})),s},o=(e,t)=>{var i,s,n;return e?(null!==(n=null===(s=null===(i=e.file)||void 0===i?void 0:i.tags)||void 0===s?void 0:s.values)&&void 0!==n?n:[]).filter((e=>t.tagStyleList.some((t=>e.startsWith(t)))))[0]:null},l=(e,t)=>e?t.tagNodeStyles[t.tagStyleList.filter((t=>e.startsWith(t)))[0]]:{},D=e=>{console.error(Object.assign({plugin:"ExcaliBrain"},e))};console.log.bind(window.console),console.log.bind(window.console);const h=e=>`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(e.replaceAll("&nbsp;"," "))))}`;function d(e){const t=e.lastIndexOf("/"),i=-1==t?e:e.substring(t+1);return{folderpath:s.normalizePath(e.substring(0,t)),filename:i,basename:i.replace(/\.[^/.]+$/,"")}}class c{constructor(e){this.pages=new Map,this.forEach=this.pages.forEach.bind(this.pages),this.app=e.app,this.plugin=e}add(e,t){this.pages.set(e,t)}has(e){return this.pages.has(e)}get(e){return this.pages.get(e)}getPages(){return Array.from(this.pages.values())}get size(){return this.pages.size}delete(e){const t=this.pages.get(e);t&&(t.neighbours.forEach(((t,i)=>{const s=this.pages.get(i);s&&(s.unlinkNeighbour(e),s.file||0!==s.neighbours.size||this.pages.delete(i))})),this.pages.delete(e))}addResolvedLinks(t){const s=this.app.metadataCache.resolvedLinks;Object.keys(s).forEach((n=>{if(t&&t.path!==n)return;const u=this.pages.get(n);Object.keys(s[n]).forEach((t=>{let s=this.pages.get(t);s||(s=this.pages.get(this.plugin.lowercasePathMap.get(t.toLowerCase()))),this.plugin.settings.inferAllLinksAsFriends?(s.addLeftFriend(u,e.INFERRED,i.FROM),u.addLeftFriend(s,e.INFERRED,i.TO)):this.plugin.settings.inverseInfer?(s.addChild(u,e.INFERRED,i.FROM),u.addParent(s,e.INFERRED,i.TO)):(s.addParent(u,e.INFERRED,i.FROM),u.addChild(s,e.INFERRED,i.TO))}))}))}addUnresolvedLinks(e){if(e&&(e.isFolder||e.isTag))return;const t=this.app.metadataCache.unresolvedLinks;Object.keys(t).forEach((i=>{if(e&&e.path!==i)return;let s=this.pages.get(i);s&&i!==this.plugin.settings.excalibrainFilepath&&Object.keys(t[i]).forEach((e=>g(e,s,this.plugin,this)))}))}}const g=(t,s,n,u)=>{var r;const a=null!==(r=u.get(t))&&void 0!==r?r:new m(u,t,null,n);return n.settings.inferAllLinksAsFriends?(a.addLeftFriend(s,e.INFERRED,i.FROM),s.addLeftFriend(a,e.INFERRED,i.TO)):n.settings.inverseInfer?(a.addChild(s,e.INFERRED,i.FROM),s.addParent(a,e.INFERRED,i.TO)):(a.addParent(s,e.INFERRED,i.FROM),s.addChild(a,e.INFERRED,i.TO)),u.add(t,a),a},p={target:null,isParent:!1,isChild:!1,isLeftFriend:!1,isRightFriend:!1,direction:null},F=(e,t)=>e&&t?e+", "+t:e||t,f=(e,t)=>e?e===i.BOTH||e===t?e:i.BOTH:t,E=(t,i)=>t===e.DEFINED?e.DEFINED:t===e.INFERRED?i===e.DEFINED?e.DEFINED:e.INFERRED:i;class m{constructor(t,i,s,n,u=!1,r=!1,a){this.pages=t,this.path=i,this.file=s,this.plugin=n,this.isFolder=u,this.isTag=r,this.name=a,this.dvIndexReady=!1,this.isChild=t=>{const{pi:i,pd:s,ci:n,cd:u,lfd:r,rfd:a}=this.getRelationVector(t);return!u||s||r||a?i||s||!n||u||r||a?null:e.INFERRED:e.DEFINED},a||(this.name=s?"md"===s.extension?s.basename:s.name:(e=>{const t=e.endsWith(".md"),i=e.substring(e.lastIndexOf("/")+1);return t?i.slice(0,-3):i})(i)),this.mtime=s?s.stat.mtime:null,this.neighbours=new Map}addDVFieldLinksToPage(){var t,s,n;if(this.dvIndexReady||this.isFolder||!this.pages)return;if(this.dvIndexReady=!0,this.isTag){const t=this.plugin.DVAPI.index.etags.getInverse("#"+this.path.substring(4));if(!t)return;return void t.forEach((t=>{const s=this.pages.get(t);s&&(this.neighbours.has(t)||(s.addParent(this,e.DEFINED,i.FROM,"tag-tree"),this.addChild(s,e.DEFINED,i.TO,"tag-tree")))}))}if(!this.file)return;const u=this.plugin.DVAPI.page(this.file.path);if(!u)return;if(this.dvPage=u,!u)return;this.primaryStyleTag=o(this.dvPage,this.plugin.settings),(null!==(n=null===(s=null===(t=u.file)||void 0===t?void 0:t.etags)||void 0===s?void 0:s.values)&&void 0!==n?n:[]).forEach((t=>{t="tag:"+t.substring(1);const s=this.pages.get(t);s&&(this.addParent(s,e.DEFINED,i.FROM,"tag-tree"),s.addChild(this,e.DEFINED,i.TO,"tag-tree"))}));const r=this.plugin.hierarchyLowerCase.parents;a(this.plugin,u,r).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addParent(s,e.DEFINED,i.TO,t.field),s.addChild(this,e.DEFINED,i.FROM,t.field)}));const l=this.plugin.hierarchyLowerCase.children;a(this.plugin,u,l).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addChild(s,e.DEFINED,i.TO,t.field),s.addParent(this,e.DEFINED,i.FROM,t.field)}));const D=this.plugin.hierarchyLowerCase.leftFriends;a(this.plugin,u,D).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addLeftFriend(s,e.DEFINED,i.TO,t.field),s.addLeftFriend(this,e.DEFINED,i.FROM,t.field)}));const h=this.plugin.hierarchyLowerCase.rightFriends;a(this.plugin,u,h).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addRightFriend(s,e.DEFINED,i.TO,t.field),s.addRightFriend(this,e.DEFINED,i.FROM,t.field)}));const d=this.plugin.hierarchyLowerCase.previous;a(this.plugin,u,d).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addLeftFriend(s,e.DEFINED,i.TO,t.field),s.addRightFriend(this,e.DEFINED,i.FROM,t.field)}));const c=this.plugin.hierarchyLowerCase.next;a(this.plugin,u,c).forEach((t=>{let s=this.pages.get(t.link);s||(s=g(t.link,this,this.plugin,this.plugin.pages)),this.addRightFriend(s,e.DEFINED,i.TO,t.field),s.addLeftFriend(this,e.DEFINED,i.FROM,t.field)}))}getTitle(){var e,t,i,s,n,u;const r=this.file&&this.plugin.settings.renderAlias&&null!==(s=null===(i=null===(t=null===(e=this.dvPage)||void 0===e?void 0:e.file)||void 0===t?void 0:t.aliases)||void 0===i?void 0:i.values)&&void 0!==s?s:[];let a=r.length>0?r[0]:this.name;if("[object Object]"===a&&(a=(null===(n=this.dvPage.aliases)||void 0===n?void 0:n[0])?Object.entries(this.dvPage.aliases[0])[0].join(": "):this.name),(null===(u=this.dvPage)||void 0===u?void 0:u.file)&&this.plugin.customNodeLabel)try{return this.plugin.customNodeLabel(this.dvPage,a)}catch(e){D({fn:this.getTitle,message:"Error executing cutomer node label function. The script is: "+this.plugin.settings.nodeTitleScript,data:this.dvPage,where:"Page.getTitle()",error:e})}return a}getRelationVector(t){return{pi:t.isParent&&t.parentType===e.INFERRED,pd:t.isParent&&t.parentType===e.DEFINED,ci:t.isChild&&t.childType===e.INFERRED,cd:t.isChild&&t.childType===e.DEFINED,lfd:!this.plugin.settings.inferAllLinksAsFriends&&t.isLeftFriend||this.plugin.settings.inferAllLinksAsFriends&&t.isLeftFriend&&!(t.parentType===e.DEFINED||t.childType===e.DEFINED),rfd:t.isRightFriend&&t.nextFriendType===e.DEFINED}}getNeighbours(){this.addDVFieldLinksToPage(),this.neighbours.forEach((e=>e.target.addDVFieldLinksToPage()));const{showVirtualNodes:e,showAttachments:t,showFolderNodes:i,showTagNodes:s,showPageNodes:n}=this.plugin.settings;return Array.from(this.neighbours).filter((u=>(e||!u[1].target.isVirtual)&&(t||!u[1].target.isAttachment)&&(i||!u[1].target.isFolder)&&(s||!u[1].target.isTag)&&(n||u[1].target.isFolder||u[1].target.isTag||u[1].target.isAttachment)))}get isVirtual(){return null===this.file&&!this.isFolder&&!this.isTag}get isAttachment(){return!!this.file&&"md"!==this.file.extension}get isMarkdown(){var e;return"md"===(null===(e=this.file)||void 0===e?void 0:e.extension)||!this.file}addParent(e,t,i,s){var n;if(e.path===this.plugin.settings.excalibrainFilepath||e.path===this.path)return;const u=this.neighbours.get(e.path);if(u)return u.isParent=!0,u.parentType=E(u.parentType,t),s&&!(null===(n=u.parentTypeDefinition)||void 0===n?void 0:n.contains(s))&&(u.parentTypeDefinition=F(s,u.parentTypeDefinition)),void(u.direction=f(u.direction,i));this.neighbours.set(e.path,Object.assign(Object.assign({},p),{target:e,isParent:!0,parentType:t,parentTypeDefinition:s,direction:i}))}addChild(e,t,i,s){var n;if(e.path===this.plugin.settings.excalibrainFilepath||e.path===this.path)return;const u=this.neighbours.get(e.path);if(u)return u.isChild=!0,u.childType=E(u.childType,t),s&&!(null===(n=u.childTypeDefinition)||void 0===n?void 0:n.contains(s))&&(u.childTypeDefinition=F(s,u.childTypeDefinition)),void(u.direction=f(u.direction,i));this.neighbours.set(e.path,Object.assign(Object.assign({},p),{target:e,isChild:!0,childType:t,childTypeDefinition:s,direction:i}))}addLeftFriend(e,t,i,s){var n;if(e.path===this.plugin.settings.excalibrainFilepath||e.path===this.path)return;const u=this.neighbours.get(e.path);if(u)return u.isLeftFriend=!0,u.friendType=E(u.friendType,t),s&&!(null===(n=u.friendTypeDefinition)||void 0===n?void 0:n.contains(s))&&(u.friendTypeDefinition=F(s,u.friendTypeDefinition)),void(u.direction=f(u.direction,i));this.neighbours.set(e.path,Object.assign(Object.assign({},p),{target:e,isLeftFriend:!0,friendType:t,friendTypeDefinition:s,direction:i}))}addRightFriend(e,t,i,s){var n;if(e.path===this.plugin.settings.excalibrainFilepath||e.path===this.path)return;const u=this.neighbours.get(e.path);if(u)return u.isRightFriend=!0,u.nextFriendType=E(u.nextFriendType,t),s&&!(null===(n=u.nextFriendTypeDefinition)||void 0===n?void 0:n.contains(s))&&(u.nextFriendTypeDefinition=F(s,u.nextFriendTypeDefinition)),void(u.direction=f(u.direction,i));this.neighbours.set(e.path,Object.assign(Object.assign({},p),{target:e,isRightFriend:!0,nextFriendType:t,nextFriendTypeDefinition:s,direction:i}))}unlinkNeighbour(e){this.neighbours.delete(e)}childrenCount(){return this.getNeighbours().reduce(((t,i)=>{const s=this.isChild(i[1]);return t+(s&&this.plugin.settings.showInferredNodes||s===e.DEFINED?1:0)}),0)}hasChildren(){return this.getNeighbours().some((t=>{const i=this.isChild(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED}))}getChildren(){return this.getNeighbours().filter((t=>{const i=this.isChild(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED})).map((e=>({page:e[1].target,relationType:e[1].childType,typeDefinition:e[1].childTypeDefinition,linkDirection:e[1].direction})))}isParent(t){const{pi:i,pd:s,ci:n,cd:u,lfd:r,rfd:a}=this.getRelationVector(t);return u||!s||r||a?!i||s||n||u||r||a?null:e.INFERRED:e.DEFINED}parentCount(){return this.getNeighbours().reduce(((t,i)=>{const s=this.isParent(i[1]);return t+(s&&this.plugin.settings.showInferredNodes||s===e.DEFINED?1:0)}),0)}hasParents(){return this.getNeighbours().some((t=>{const i=this.isParent(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED}))}getParents(){return this.getNeighbours().filter((t=>{const i=this.isParent(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED})).map((e=>({page:e[1].target,relationType:e[1].parentType,typeDefinition:e[1].parentTypeDefinition,linkDirection:e[1].direction})))}isLeftFriend(t){const{pi:i,pd:s,ci:n,cd:u,lfd:r,rfd:a}=this.getRelationVector(t);return r?e.DEFINED:!i||s||!n||u||r||a?null:e.INFERRED}leftFriendCount(){return this.getNeighbours().reduce(((t,i)=>{const s=this.isLeftFriend(i[1]);return t+(s&&this.plugin.settings.showInferredNodes||s===e.DEFINED?1:0)}),0)}hasLeftFriends(){return this.getNeighbours().some((t=>{const i=this.isLeftFriend(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED}))}getLeftFriends(){return this.getNeighbours().filter((t=>{const i=this.isLeftFriend(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED})).map((t=>{var i;return{page:t[1].target,relationType:null!==(i=t[1].friendType)&&void 0!==i?i:t[1].parentType===e.DEFINED&&t[1].childType===e.DEFINED?e.DEFINED:e.INFERRED,typeDefinition:t[1].friendTypeDefinition,linkDirection:t[1].direction}}))}isRightFriend(t){const{pi:i,pd:s,ci:n,cd:u,lfd:r,rfd:a}=this.getRelationVector(t);return a?e.DEFINED:null}rightFriendCount(){return this.getNeighbours().reduce(((t,i)=>{const s=this.isRightFriend(i[1]);return t+(s&&this.plugin.settings.showInferredNodes||s===e.DEFINED?1:0)}),0)}hasRightFriends(){return this.getNeighbours().some((t=>{const i=this.isRightFriend(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED}))}getRightFriends(){return this.getNeighbours().filter((t=>{const i=this.isRightFriend(t[1]);return i&&this.plugin.settings.showInferredNodes||i===e.DEFINED})).map((t=>({page:t[1].target,relationType:e.DEFINED,typeDefinition:t[1].nextFriendTypeDefinition,linkDirection:t[1].direction})))}getRelationToPage(e){const t=this.neighbours.get(e.path);return t?this.isChild(t)?{type:"child",relationType:t.childType,typeDefinition:t.childTypeDefinition}:this.isParent(t)?{type:"parent",relationType:t.parentType,typeDefinition:t.parentTypeDefinition}:this.isRightFriend(t)?{type:"nextFriend",relationType:t.nextFriendType,typeDefinition:t.nextFriendTypeDefinition}:{type:"leftFriend",relationType:t.friendType,typeDefinition:t.friendTypeDefinition}:null}getSiblings(){const t=new Map;return this.getParents().forEach((i=>i.page.getChildren().forEach((i=>{t.has(i.page.path)?i.relationType===e.DEFINED&&(t.get(i.page.path).relationType=e.DEFINED):t.set(i.page.path,i)})))),Array.from(t.values())}}var C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y={};Object.defineProperty(y,"__esModule",{value:!0});const w=e=>{try{return window.ExcalidrawAutomate.getAPI(e)}catch(e){return console.log({message:"Excalidraw not available",fn:w}),null}};var v=y.getEA=w;const S="ExcaliBrain",b=["base","inferred","file-tree","tag-tree"],x={strokeColor:"#696969FF",strokeWidth:1,strokeStyle:"solid",roughness:0,startArrowHead:"none",endArrowHead:"none",showLabel:!1,fontSize:10,fontFamily:3,textColor:"#ffffffff"},T={prefix:"",backgroundColor:"#00000066",fillStyle:"solid",textColor:"#ffffffff",borderColor:"#00000000",fontSize:20,fontFamily:3,maxLabelLength:30,roughness:0,strokeShaprness:"round",strokeWidth:1,strokeStyle:"solid",padding:10,gateRadius:5,gateOffset:15,gateStrokeColor:"#ffffffff",gateBackgroundColor:"#ffffffff",gateFillStyle:"solid"},A={exclusions:["excalidraw-font","excalidraw-font-color","excalidraw-css","excalidraw-plugin","excalidraw-link-brackets","excalidraw-link-prefix","excalidraw-border-color","excalidraw-default-mode","excalidraw-export-dark","excalidraw-export-transparent","excalidraw-export-svgpadding","excalidraw-export-pngscale","excalidraw-url-prefix","excalidraw-linkbutton-opacity","excalidraw-onload-script","kanban-plugin"],parents:["Parent","Parents","up","u","North","origin","inception","source","parnet domain"],children:["Children","Child","down","d","South","leads to","contributes to","nurtures"],leftFriends:["Friends","Friend","Jump","Jumps","j","similar","supports","alternatives","advantages","pros"],rightFriends:["opposes","disadvantages","missing","cons"],previous:["Previous","Prev","West","w","Before"],next:["Next","n","East","e","After"]};var O={JSON_MALFORMED:"Malformed JSON",JSON_MISSING_KEYS:'JSON must have these 4 keys: "parents", "children", "friends", "nextFriends"',JSON_VALUES_NOT_STRING_ARRAYS:'Key values must be a non-empty array of strings. e.g. "parents": ["Parent", "Parents", "up"]',EXCALIBRAIN_FILE_NAME:"Filepath of Excalibrain drawing",EXCALIBRAIN_FILE_DESC:"âš  This file will be overwritten by the plugin. If you stop the script and make changes to the graph, you should rename the file so your edits are preserved, because the next time you initiate ExcaliBrain your edits will be overwritten by the automatically generated ExcaliBrain graph.",INDEX_REFRESH_FREQ_NAME:"Index refresh frequency",INDEX_REFRESH_FREQ_DESC:"ExcaliBrain will update its index whenever you switch work panes, in case a file has changed in your Vault since the last index update. <br>This setting is thus only relevant when you are typing in a markdown editor (not switching files or panes) and you still want ExcaliBrain to update it's graph as you type. Because frequent background index updates can be resource intensive you have an option to increase the time interval for the index-updates which in turn will reduce the overhead on your system.",HIERARCHY_HEAD:"Ontology",HIERARCHY_DESC:"Enter the Dataview field names separated by comma (,) that you will use to define link directions in your graph.<br>You can also add fields to the ontology on the fly from the markdown editor by typing the new field at the beginning of a paragraph (e.g.: 'Consits of::') and then calling one of the command palette actions to <code>Add dataview field to ontology as PARENT</code>, or <code>as CHILD</code>, <code>as FRIEND</code>, or <code>as RIGHT FRIEND</code>",INFER_NAME:"Infer all implicit relationships as Friend",INFER_DESC:"<b>Toggle On:</b> All implicit links in the document are interpreted as FRIENDS.<br><b>Toggle Off:</b> The following logic is used:<ul><li>A forward link is inferred as a CHILD</li><li>A backlink is inferred as a PARENT</li><li>If files mutually link to each other, they are FRIENDS</li></ul>",REVERSE_NAME:"Reverse infer logic",REVERSE_DESC:"<b>Toggle ON:</b> Treat backlinks as children and forward links as parents.<br><b>Toggle OFF:</b> Treat backlinks as parents and forward links as children</b>",PARENTS_NAME:"Parents",CHILDREN_NAME:"Children",LEFT_FRIENDS_NAME:"Left-Side Friends",RIGHT_FRIENDS_NAME:"Right-Side Friends",PREVIOUS_NAME:"Previous (Friends)",NEXT_NAME:"Next (Friends)",EXCLUSIONS_NAME:"Excluded",EXCLUSIONS_DESC:"Dataview or YAML fields that are never used for ontology",UNASSIGNED_NAME:"Unassigned",UNASSIGNED_DESC:"Fields in your Vault that are neither excluded nor part of the defined ontology.",ONTOLOGY_SUGGESTER_NAME:"Ontology Suggester",ONTOLOGY_SUGGESTER_DESC:"Activate ontology suggester in the markdown editor. If enabled then typing the trigger sequence at the beginning of a paragraph will activate the suggester listing your ontology fields defined above.",ONTOLOGY_SUGGESTER_ALL_NAME:"Character sequence to trigger generic suggester. The Generic suggester will include all the ontology fields regardless of their direction.",ONTOLOGY_SUGGESTER_PARENT_NAME:"Character sequence to trigger parent suggester",ONTOLOGY_SUGGESTER_CHILD_NAME:"Character sequence to trigger child suggester",ONTOLOGY_SUGGESTER_LEFT_FRIEND_NAME:"Character sequence to trigger left-side friend suggester",ONTOLOGY_SUGGESTER_RIGHT_FRIEND_NAME:"Character sequence to trigger right-side friend suggester",ONTOLOGY_SUGGESTER_PREVIOUS_NAME:"Character sequence to trigger pr<u>e</u>vious (friend) suggester",ONTOLOGY_SUGGESTER_NEXT_NAME:"Character sequence to trigger next (friend) suggester",MID_SENTENCE_SUGGESTER_TRIGGER_NAME:"Mid-sentence dataview field suggester trigger",MID_SENTENCE_SUGGESTER_TRIGGER_DESC:"You may add fields mid-way in sentences following one of these two formats:<br><code>We met at [location:: [[XYZ restaurant]]] with [candidate:: [[John Doe]]]</code><br><code>We met at (location:: [[XYZ restaurant]]) with (candidate:: [[John Doe]])</code><br>If you set this trigger to e.g. <code>(</code> then typing <code>(:::</code> anywhere in the sentence will activate the suggester (assuming you are using the default generic suggester trigger commbination of <code>:::</code> - see setting above).<br>More info on inline fields: [DataView Help](https://blacksmithgu.github.io/obsidian-dataview/data-annotation/)",BOLD_FIELDS_NAME:"Add selected field with BOLD",BOLD_FIELDS_DESC:"Add selected field to text with bold typeface, i.e. (**field name**:: ) resulting in (<b>field name</b>:: )",DISPLAY_HEAD:"Display",COMPACT_VIEW_NAME:"Compact view",COMPACT_VIEW_DESC:"Display the graph in a compact view",EXCLUDE_PATHLIST_NAME:"Filepaths to exclude",EXCLUDE_PATHLIST_DESC:"Enter comma-separated list of filepaths to exclude from the index.",RENDERALIAS_NAME:"Display alias if available",RENDERALIAS_DESC:"Displays the page alias instead of the filename if it is specified in the page's front matter.",NODETITLE_SCRIPT_NAME:"Javascript for rendering node names",NODETITLE_SCRIPT_DESC:"Javascript code to render the node title. If you don't need it, just leave this field empty.<br>Function definition: <code>customNodeLabel: (dvPage: Literal, defaultName:string) => string</code><br>In your script you may refer to the dataview page object via the <code>dvPage</code> variable; and the default page name (filename or alias if available) via the <code>defaultName</code> variable. Use the following expression syntax:<br><code>dvPage['field 1']??defaultName</code> - this example will display the vaule of 'field 1' if available else the defaultName<br>âš  Your line of code will be executed as is, make sure you add proper exception handling. Beyond <code>defaultName</code> and dataview field names, you also have the freedom to use any javascript function (e.g. <code>defaultName.toLowerCase()</code>) and any value that appears on the <code>dvPage</code> object, e.g. <code>dvPage.file.path</code>, etc. <br> To explore the dataview page object open Developer Console and enter the following code:<br><code>DataviewAPI.page('full filepath including extension')</code><br>Here's an example code that will display the value of the title field if available, else the filename, followed by the state (if available): <br><code>dvPage.title??defaultName & (dvPage.state ? ' - ' & dvPage.state : '')</code>",SHOWINFERRED_NAME:"Display inferred relationships",SHOWINFERRED_DESC:"<b>Toggle ON</b>: Display both explicitly defined and inferred links. Forward links are children, backlinks are parents, if two page mutually referes to one another then relationship is inferred to be a friendship. Explicitly defined relationships always take priority.<br><b>Toggle OFF</b>: Display only explicitely defined relationships.",SHOWVIRTUAL_NAME:"Display virtual child nodes",SHOWVIRTUAL_DESC:"<b>Toggle ON</b>: Display unresolved links.<br><b>Toggle OFF</b>: Do not display unresolved links.",SHOWATTACHMENTS_NAME:"Include attachments",SHOWATTACHMENTS_DESC:"<b>Toggle ON</b>: Display every type of file on the graph. <br><b>Toggle OFF</b>: Display only markdown files.",STYLE_HEAD:"Styling",STYLE_DESC:"Styles are applied in sequence.<br><ol><li><b>Base</b> node style</li><li><b>Inferred</b> node style (only applied if the node is inferred)</li><li><b>Virtual</b> node style (only applied if the node is virtual)</li> <li><b>Central</b> node style (only applied if the node is in the center)</li><li><b>Sibling</b> node style (only applied if the node is a sibling)</li> <li><b>Attachment</b> node style (only applied if the node is an attachment)</li><li><b>Optional</b> tag based style</li></ol>All the attributes of the base node style must be specified. All other styles may have partial definitions. e.g. You may add a prefix and override the base node-background color in the tag-based style, override the font color in the inferred-node style and set the border stroke style to dotted in the virtual-node style.",CANVAS_BGCOLOR:"Canvas color",SHOW_FULL_TAG_PATH_NAME:"Display full tag name",SHOW_FULL_TAG_PATH_DESC:"<b>Toggle on:</b> will display the full tag e.g. #reading/books/sci-fi</br><b>Toggle off:</b> will display the current section of the tag, e.g. assuming the tag above, the graph will display only #reading, #books, #sci-fi respectively as you navigate the tag hierarchy.",SHOW_COUNT_NAME:"Display neighbor count",SHOW_COUNT_DESC:"Show the number of children, parents, friends next to the node gate",ALLOW_AUTOZOOM_NAME:"Autozoom",ALLOW_AUTOZOOM_DESC:"<b>Toggle ON:</b> Allow autozoom<br><b>Toggle OFF:</b> Disable autozoom",ALLOW_AUTOFOCUS_ON_SEARCH_NAME:"Autofocus on search",ALLOW_AUTOFOCUS_ON_SEARCH_DESC:"<b>Toggle ON:</b> Allow autofocus on Search<br><b>Toggle OFF:</b> Disable autofocus",ALWAYS_ON_TOP_NAME:"Popout default 'always on top' behavior",ALWAYS_ON_TOP_DESC:"<b>Toggle ON:</b> When opening ExcaliBrain in a popout window, it will open with the new window in 'always on top' mode.<br><b>Toggle OFF:</b> The new window will not be in 'always on top' mode.",TAGLIST_NAME:"Formatted tags",TAGLIST_DESC:"You can specify special formatting rules for Nodes based on tags. If multiple tags are present on the page the first matching a specification will be used. <br>Tagnames should start with <mark>#</mark> and may be incomplete. i.e. <code>#book</code> will match #books, #book/fiction, etc.<br>Enter a comma separated list of tags here, then select from the dropdown list to change the formatting.",MAX_ITEMCOUNT_DESC:"Maximum node count",MAX_ITEMCOUNT_NAME:"Maximum number of nodes to display in a given area of the layout.i.e. the maximum number of parents, the maximum number of children, the maximum number of friends, and the maximum number of siblings to display. If there are more items, they will be ommitted from the drawing.",NODESTYLE_INCLUDE_TOGGLE:"Toggle ON: override base node style for this attribute; OFF: apply base node style for this attribute",NODESTYLE_PREFIX_NAME:"Prefix",NODESTYLE_PREFIX_DESC:"Prefix character or emoji to display in front of the node's label",NODESTYLE_BGCOLOR:"Background color",NODESTYLE_BG_FILLSTYLE:"Background fill-style",NODESTYLE_TEXTCOLOR:"Text color",NODESTYLE_BORDERCOLOR:"Border color",NODESTYLE_FONTSIZE:"Font size",NODESTYLE_FONTFAMILY:"Font family",NODESTYLE_MAXLABELLENGTH_NAME:"Max label length",NODESTYLE_MAXLABELLENGTH_DESC:"Maximum number of characters to display from node title. Longer nodes will end with '...'",NODESTYLE_ROUGHNESS:"Stroke roughness",NODESTYLE_SHARPNESS:"Stroke sharpness",NODESTYLE_STROKEWIDTH:"Stroke width",NODESTYLE_STROKESTYLE:"Stroke style",NODESTYLE_RECTANGLEPADDING:"Padding of the node rectangle",NODESTYLE_GATE_RADIUS_NAME:"Gate radius",NODESTYLE_GATE_RADIUS_DESC:"The radius of the 3 small circles (alias: gates) serving as connection points for nodes",NODESTYLE_GATE_OFFSET_NAME:"Gate offset",NODESTYLE_GATE_OFFSET_DESC:"The offset to the left and right of the parent and child gates.",NODESTYLE_GATE_COLOR:"Gate border color",NODESTYLE_GATE_BGCOLOR_NAME:"Gate background color",NODESTYLE_GATE_BGCOLOR_DESC:"The fill color of the gate if it has children",NODESTYLE_GATE_FILLSTYLE:"Gate background fill-style",NODESTYLE_BASE:"Base node style",NODESTYLE_CENTRAL:"Style of central node",NODESTYLE_INFERRED:"Style of inferred nodes",NODESTYLE_VIRTUAL:"Style of virtual nodes",NODESTYLE_SIBLING:"Style of sibling nodes",NODESTYLE_ATTACHMENT:"Style of attachment nodes",NODESTYLE_FOLDER:"Style of folder nodes",NODESTYLE_TAG:"Style of tag nodes",LINKSTYLE_COLOR:"Color",LINKSTYLE_WIDTH:"Width",LINKSTYLE_STROKE:"Stroke style",LINKSTYLE_ROUGHNESS:"Roughness",LINKSTYLE_ARROWSTART:"Start arrow head",LINKSTYLE_ARROWEND:"End arrow head",LINKSTYLE_SHOWLABEL:"Show label on link",LINKSTYLE_FONTSIZE:"Label font size",LINKSTYLE_FONTFAMILY:"Label font family",LINKSTYLE_BASE:"Base link style",LINKSTYLE_INFERRED:"Style of inferred link",LINKSTYLE_FOLDER:"Style of folder link",LINKSTYLE_TAG:"Style of tag link",DATAVIEW_NOT_FOUND:`Dataview plugin not found. Please install or enable Dataview then try restarting ${S}.`,DATAVIEW_UPGRADE:`Please upgrade Dataview to 0.5.31 or newer. Please update Dataview then try restarting ${S}.`,EXCALIDRAW_NOT_FOUND:`Excalidraw plugin not found. Please install or enable Excalidraw then try restarting ${S}.`,EXCALIDRAW_MINAPP_VERSION:`ExcaliBrain requires Excalidraw 1.6.33 or higher. Please upgrade Excalidraw then try restarting ${S}.`,COMMAND_ADD_PARENT_FIELD:"Add dataview field to ontology as PARENT",COMMAND_ADD_CHILD_FIELD:"Add dataview field to ontology as CHILD",COMMAND_ADD_LEFT_FRIEND_FIELD:"Add dataview field to ontology as LEFT-SIDE FRIEND",COMMAND_ADD_RIGHT_FRIEND_FIELD:"Add dataview field to ontology as RIGHT-SIDE FRIEND",COMMAND_ADD_PREVIOUS_FIELD:"Add dataview field to ontology as PREVIOUS",COMMAND_ADD_NEXT_FIELD:"Add dataview field to ontology as NEXT",COMMAND_START:"ExcaliBrain Normal",COMMAND_START_HOVER:"ExcaliBrain Hover-Editor",COMMAND_START_POPOUT:"ExcaliBrain Popout Window",COMMAND_STOP:"Stop ExcaliBrain",HOVER_EDITOR_ERROR:"I am sorry. Something went wrong. Most likely there was a version update to Hover Editor which I haven't addressed properly in ExcaliBrain. Normally I should get this fixed within few days",OPEN_DRAWING:"Save snapshot for editing",SEARCH_IN_VAULT:"Starred items will be listed in empty search.\nSearch for a file, a folder or a tag in your Vault.\nToggle folders and tags on/off to show in the list.",SHOW_HIDE_ATTACHMENTS:"Show/Hide attachments",SHOW_HIDE_VIRTUAL:"Show/Hide virtual nodes",SHOW_HIDE_INFERRED:"Show/Hide inferred nodes",SHOW_HIDE_ALIAS:"Show/Hide document alias",SHOW_HIDE_SIBLINGS:"Show/Hide siblings",SHOW_HIDE_FOLDER:"Show/Hide folder nodes",SHOW_HIDE_TAG:"Show/Hide tag nodes",SHOW_HIDE_PAGES:"Show/Hide page nodes (incl. defined, inferred, virtual and attachments)",PIN_LEAF:"Link ExcaliBrain to most recent active leaf"};const N={en:O}[s.moment.locale()];function L(e){return N||D({fn:L,where:"src/lang/helpers.ts",message:"Error: locale not found",data:s.moment.locale()}),N&&N[e]||O[e]}class B extends s.Modal{constructor(e,t,i){super(e),this.title=t,this.message=i}onOpen(){this.createForm()}onClose(){}createForm(){this.titleEl.setText(this.title),this.contentEl.createDiv({cls:"excalibrain-prompt-center",text:this.message}),this.contentEl.createDiv({cls:"excalibrain-prompt-center"},(e=>{e.style.textAlign="right",e.createEl("button",{text:"Ok"}).onclick=()=>{this.resolve(!0),this.close()},e.createEl("button",{text:"Cancel"}).onclick=()=>{this.resolve(!1),this.close()}}))}show(e){this.resolve=e,this.open()}}class k{constructor(e){this.style={},this.center={x:0,y:0},this.isCentral=!1,this.isCentral=e.isCentral,this.page=e.page,this.settings=e.page.plugin.settings,this.ea=e.ea,this.page.isFolder?this.style=Object.assign(Object.assign(Object.assign(Object.assign({},this.settings.baseNodeStyle),e.isCentral?this.settings.centralNodeStyle:{}),e.isSibling?this.settings.siblingNodeStyle:{}),this.settings.folderNodeStyle):this.page.isTag?this.style=Object.assign(Object.assign(Object.assign(Object.assign({},this.settings.baseNodeStyle),e.isCentral?this.settings.centralNodeStyle:{}),e.isSibling?this.settings.siblingNodeStyle:{}),this.settings.tagNodeStyle):this.style=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.settings.baseNodeStyle),e.isInferred?this.settings.inferredNodeStyle:{}),e.page.isVirtual?this.settings.virtualNodeStyle:{}),e.isCentral?this.settings.centralNodeStyle:{}),e.isSibling?this.settings.siblingNodeStyle:{}),e.page.isAttachment?this.settings.attachmentNodeStyle:{}),l(this.page.primaryStyleTag,this.settings)),this.friendGateOnLeft=e.friendGateOnLeft,this.title=this.page.getTitle()}displayText(){var e;const t=(null!==(e=this.style.prefix)&&void 0!==e?e:"")+this.title;return t.length>this.style.maxLabelLength?t.substring(0,this.style.maxLabelLength-1)+"...":t}setCenter(e){this.center=e}render(){var e,t;const i=this.ea,s=this.displayText(),n=2*this.style.gateRadius;i.style.fontSize=this.style.fontSize,i.style.fontFamily=this.style.fontFamily;const u=i.measureText(`${s}`);i.style.fillStyle=this.style.fillStyle,i.style.roughness=this.style.roughness,i.style.strokeSharpness=this.style.strokeShaprness,i.style.strokeWidth=this.style.strokeWidth,i.style.strokeColor=this.style.textColor,i.style.backgroundColor="transparent",this.id=i.addText(this.center.x-u.width/2,this.center.y-u.height/2,s,{wrapAt:this.style.maxLabelLength+5,textAlign:"center",box:!0,boxPadding:this.style.padding});const r=i.getElement(this.id);r.link=`[[${null!==(t=null===(e=this.page.file)||void 0===e?void 0:e.path)&&void 0!==t?t:this.page.path}]]`,r.backgroundColor=this.style.backgroundColor,r.strokeColor=this.style.borderColor,r.strokeStyle=this.style.strokeStyle,i.style.fillStyle=this.style.gateFillStyle,i.style.strokeColor=this.style.gateStrokeColor,i.style.strokeStyle="solid";const a=this.isCentral?this.page.leftFriendCount():this.page.leftFriendCount()+this.page.rightFriendCount();if(i.style.backgroundColor=a>0?this.style.gateBackgroundColor:"transparent",this.friendGateId=i.addEllipse(this.friendGateOnLeft?this.center.x-n-this.style.padding-u.width/2:this.center.x+this.style.padding+u.width/2,this.center.y-this.style.gateRadius,n,n),this.settings.showNeighborCount&&a>0&&(i.style.fontSize=n,i.addText(this.friendGateOnLeft?a>9?this.center.x-2*n-this.style.padding-u.width/2:this.center.x-n-this.style.padding-u.width/2:this.center.x+this.style.padding+u.width/2,this.friendGateOnLeft?this.center.y-2*n:this.center.y-this.style.gateRadius+n,a.toString())),this.isCentral){const e=this.page.rightFriendCount();i.style.backgroundColor=e>0?this.style.gateBackgroundColor:"transparent",this.nextFriendGateId=i.addEllipse(this.friendGateOnLeft?this.center.x+this.style.padding+u.width/2:this.center.x-n-this.style.padding-u.width/2,this.center.y-this.style.gateRadius,n,n),this.settings.showNeighborCount&&e>0&&(i.style.fontSize=n,i.addText(this.friendGateOnLeft?this.center.x+this.style.padding+u.width/2:e>9?this.center.x-2*n-this.style.padding-u.width/2:this.center.x-n-this.style.padding-u.width/2,this.friendGateOnLeft?this.center.y-this.style.gateRadius+n:this.center.y-2*n,e.toString()))}else this.nextFriendGateId=this.friendGateId;const o=this.page.parentCount();i.style.backgroundColor=o>0?this.style.gateBackgroundColor:"transparent",this.parentGateId=i.addEllipse(this.center.x-this.style.gateRadius-this.style.gateOffset,this.center.y-n-this.style.padding-u.height/2,n,n),this.settings.showNeighborCount&&o>0&&(i.style.fontSize=n,i.addText(this.center.x+n-this.style.gateOffset,this.center.y-n-this.style.padding-u.height/2,o.toString()));const l=this.page.childrenCount();i.style.backgroundColor=l>0?this.style.gateBackgroundColor:"transparent",this.childGateId=i.addEllipse(this.center.x-this.style.gateRadius+this.style.gateOffset,this.center.y+this.style.padding+u.height/2,n,n),this.settings.showNeighborCount&&l>0&&(i.style.fontSize=n,i.addText(this.center.x+n+this.style.gateOffset,this.center.y+this.style.padding+u.height/2,l.toString())),i.addToGroup([this.friendGateId,this.parentGateId,this.childGateId,this.id,r.boundElements[0].id])}}class I{constructor(t,i,s,n,u,r,a,o){this.nodeA=t,this.nodeB=i,this.nodeBRole=s,this.hierarchyDefinition=u,this.ea=r,this.isInferred=!1;const l=null==u?void 0:u.split(",").map((e=>e.trim()));this.isInferred=n===e.INFERRED;let D={};l&&l.forEach((e=>{if(o.hierarchyLinkStylesExtended[e])D=Object.assign(Object.assign({},D),o.hierarchyLinkStylesExtended[e]);else switch(e){case"file-tree":D=Object.assign(Object.assign({},D),o.settings.folderLinkStyle);break;case"tag-tree":D=Object.assign(Object.assign({},D),o.settings.tagLinkStyle)}})),this.style=Object.assign(Object.assign(Object.assign({},a.baseLinkStyle),this.isInferred?a.inferredLinkStyle:{}),D)}render(e){const i=this.ea,s=this.style;let n,u;switch(i.style.strokeStyle=s.strokeStyle,i.style.roughness=s.roughness,i.style.strokeColor=s.strokeColor,i.style.strokeWidth=s.strokeWidth,i.style.opacity=e?10:100,this.nodeBRole){case t.CHILD:n=this.nodeA.childGateId,u=this.nodeB.parentGateId;break;case t.PARENT:n=this.nodeA.parentGateId,u=this.nodeB.childGateId;break;case t.NEXT:n=this.nodeA.nextFriendGateId,u=this.nodeB.nextFriendGateId;break;default:n=this.nodeA.friendGateId,u=this.nodeB.friendGateId}const r=i.connectObjects(n,null,u,null,{startArrowHead:"none"===s.startArrowHead?null:s.startArrowHead,endArrowHead:"none"===s.endArrowHead?null:s.endArrowHead});s.showLabel&&this.hierarchyDefinition&&(i.style.fontSize=s.fontSize,i.style.fontFamily=s.fontFamily,i.style.strokeColor=s.textColor,i.addLabelToLine(r,this.hierarchyDefinition))}}const _={compactView:!1,excalibrainFilepath:"excalibrain.md",indexUpdateInterval:5e3,hierarchy:A,inferAllLinksAsFriends:!1,inverseInfer:!1,renderAlias:!0,nodeTitleScript:"",backgroundColor:"#0c3e6aff",excludeFilepaths:[],showInferredNodes:!0,showAttachments:!0,showVirtualNodes:!0,showFolderNodes:!1,showTagNodes:!1,showPageNodes:!0,showNeighborCount:!0,showFullTagName:!1,maxItemCount:30,renderSiblings:!0,baseNodeStyle:T,centralNodeStyle:{fontSize:30,backgroundColor:"#C49A13FF",textColor:"#000000ff"},inferredNodeStyle:{backgroundColor:"#000005b3",textColor:"#95c7f3ff"},virtualNodeStyle:{backgroundColor:"#ff000066",fillStyle:"hachure",textColor:"#ffffffff"},siblingNodeStyle:{fontSize:15},attachmentNodeStyle:{prefix:"ðŸ“Ž "},folderNodeStyle:{prefix:"ðŸ“‚ ",strokeShaprness:"sharp",borderColor:"#ffd700ff",textColor:"#ffd700ff"},tagNodeStyle:{prefix:"#",strokeShaprness:"sharp",borderColor:"#4682b4ff",textColor:"#4682b4ff"},tagNodeStyles:{},tagStyleList:[],baseLinkStyle:x,inferredLinkStyle:{strokeStyle:"dashed"},folderLinkStyle:{strokeColor:"#ffd700ff"},tagLinkStyle:{strokeColor:"#4682b4ff"},hierarchyLinkStyles:{},navigationHistory:[],allowOntologySuggester:!0,ontologySuggesterParentTrigger:"::p",ontologySuggesterChildTrigger:"::c",ontologySuggesterLeftFriendTrigger:"::l",ontologySuggesterRightFriendTrigger:"::r",ontologySuggesterPreviousTrigger:"::e",ontologySuggesterNextTrigger:"::n",ontologySuggesterTrigger:":::",ontologySuggesterMidSentenceTrigger:"(",boldFields:!1,allowAutozoom:!0,allowAutofocuOnSearch:!0,defaultAlwaysOnTop:!1},M="excalibrain-settings-disabled",R=e=>(255*e|256).toString(16).slice(1),P=e=>createFragment((t=>t.createDiv().innerHTML=e)),V=e=>{const t=document.getElementById(e);if(!t)return;const i=t.parentNode;i&&i.removeChild(t)},H=(e,t)=>{const i=document.createElement("style");i.id=e,i.innerHTML=`.${t} {display: none;}`,document.body.appendChild(i)};class j extends s.PluginSettingTab{constructor(e,t){super(e,t),this.dirty=!1,this.updateTimer=!1,this.plugin=t}get hierarchyStyleList(){return b.concat(Array.from(this.plugin.settings.hierarchy.parents)).concat(Array.from(this.plugin.settings.hierarchy.children)).concat(Array.from(this.plugin.settings.hierarchy.leftFriends)).concat(Array.from(this.plugin.settings.hierarchy.rightFriends)).concat(Array.from(this.plugin.settings.hierarchy.previous)).concat(Array.from(this.plugin.settings.hierarchy.next))}async updateNodeDemoImg(){this.ea.reset(),this.ea.canvas.viewBackgroundColor=this.plugin.settings.backgroundColor,this.demoNode.style=Object.assign(Object.assign({},this.demoNodeStyle.getInheritedStyle()),this.demoNodeStyle.style),this.demoNode.render();const e=await this.ea.createSVG(null,!0,{withBackground:!0,withTheme:!1},null,"",40);e.removeAttribute("width"),e.removeAttribute("height"),this.demoNodeImg.setAttribute("src",h(e.outerHTML))}async updateLinkDemoImg(){this.ea.reset(),this.ea.canvas.viewBackgroundColor=this.plugin.settings.backgroundColor;const s=new m(null,"Start node",null,this.plugin),n=new m(null,"End node",null,this.plugin),u=this.plugin.settings.hierarchy;u.leftFriends.contains(this.demoLinkStyle.display)?(s.addLeftFriend(n,e.DEFINED,i.FROM),n.addLeftFriend(s,e.DEFINED,i.TO)):u.rightFriends.contains(this.demoLinkStyle.display)?(s.addRightFriend(n,e.DEFINED,i.FROM),n.addRightFriend(s,e.DEFINED,i.TO)):u.parents.contains(this.demoLinkStyle.display)?(s.addParent(n,e.DEFINED,i.FROM),n.addChild(s,e.DEFINED,i.TO)):(s.addChild(n,e.DEFINED,i.FROM),n.addParent(s,e.DEFINED,i.TO));const r=new k({ea:this.ea,page:s,isInferred:!1,isCentral:!0,isSibling:!1,friendGateOnLeft:!0});r.ea=this.ea,r.setCenter({x:0,y:0});const a=new k({ea:this.ea,page:n,isInferred:!1,isCentral:!1,isSibling:!1,friendGateOnLeft:!1});a.ea=this.ea;let o=t.CHILD;u.leftFriends.contains(this.demoLinkStyle.display)?(a.setCenter({x:-300,y:0}),o=t.FRIEND):u.rightFriends.contains(this.demoLinkStyle.display)?(a.setCenter({x:300,y:0}),o=t.NEXT):u.parents.contains(this.demoLinkStyle.display)?(a.setCenter({x:0,y:-150}),o=t.PARENT):a.setCenter({x:0,y:150});const l=new I(r,a,o,e.DEFINED,"base",this.ea,this.plugin.settings,this.plugin);r.style=Object.assign(Object.assign({},this.plugin.settings.baseNodeStyle),this.plugin.settings.centralNodeStyle),r.render(),a.style=Object.assign(Object.assign({},this.demoNodeStyle.getInheritedStyle()),this.demoNodeStyle.style),a.render(),l.style=Object.assign(Object.assign({},this.demoLinkStyle.getInheritedStyle()),this.demoLinkStyle.style),l.render(!1);const D=await this.ea.createSVG(null,!0,{withBackground:!0,withTheme:!1},null,"",40);D.removeAttribute("width"),D.removeAttribute("height"),this.demoLinkImg.setAttribute("src",h(D.outerHTML))}async hide(){var e;this.dirty&&(""===this.plugin.settings.ontologySuggesterParentTrigger&&(this.plugin.settings.ontologySuggesterParentTrigger="::p"),""===this.plugin.settings.ontologySuggesterChildTrigger&&(this.plugin.settings.ontologySuggesterChildTrigger="::c"),""===this.plugin.settings.ontologySuggesterLeftFriendTrigger&&(this.plugin.settings.ontologySuggesterLeftFriendTrigger="::l"),""===this.plugin.settings.ontologySuggesterRightFriendTrigger&&(this.plugin.settings.ontologySuggesterRightFriendTrigger="::r"),""===this.plugin.settings.ontologySuggesterPreviousTrigger&&(this.plugin.settings.ontologySuggesterPreviousTrigger="::e"),""===this.plugin.settings.ontologySuggesterNextTrigger&&(this.plugin.settings.ontologySuggesterNextTrigger="::n"),""===this.plugin.settings.ontologySuggesterTrigger&&(this.plugin.settings.ontologySuggesterTrigger=":::"),""===this.plugin.settings.ontologySuggesterMidSentenceTrigger&&(this.plugin.settings.ontologySuggesterMidSentenceTrigger="("),this.plugin.setHierarchyLinkStylesExtended(),this.plugin.settings.tagStyleList=Object.keys(this.plugin.settings.tagNodeStyles),this.plugin.loadCustomNodeLabelFunction(),this.plugin.saveSettings(),this.updateTimer&&this.plugin.scene&&!this.plugin.scene.terminated&&this.plugin.scene.setTimer(),null===(e=this.plugin.scene)||void 0===e||e.reRender())}colorpicker(e,t,i,n,u,r,a,o){let l,D,h,d,c,g;const p=new s.Setting(e).setName(t);i&&p.setDesc(P(i));const F=e=>{e?p.settingEl.addClass(M):p.settingEl.removeClass(M),D.disabled=e,D.style.opacity=e?"0.3":"1",l.setDisabled(e),l.sliderEl.style.opacity=e?"0.3":"1",d.style.opacity=e?"0.3":"1",c.style.opacity=e?"0.3":"1",g.style.opacity=e?"0.3":"1"};a&&p.addToggle((e=>{h=e,e.toggleEl.addClass("excalibrain-settings-toggle"),e.setValue(void 0!==n()).setTooltip(L("NODESTYLE_INCLUDE_TOGGLE")).onChange((e=>{if(this.dirty=!0,!e)return F(!0),void r();u(D.value+R(l.getValue())),F(!1)}))})),p.settingEl.removeClass("mod-toggle"),d=createEl("span",{text:"color:",cls:"excalibrain-settings-colorlabel"}),p.controlEl.appendChild(d),D=createEl("input",{type:"color",cls:"excalibrain-settings-colorpicker"},(e=>{var t;e.value=(null!==(t=n())&&void 0!==t?t:o).substring(0,7),e.onchange=()=>{u(e.value+R(l.getValue())),this.dirty=!0}})),p.controlEl.appendChild(D),c=createEl("span",{text:"opacity:",cls:"excalibrain-settings-opacitylabel"}),p.controlEl.appendChild(c),p.addSlider((e=>{var t,i;l=e,e.setLimits(0,1,.1).setValue((i=null!==(t=n())&&void 0!==t?t:o,parseInt(i.substring(7,9),16)/255)).onChange((e=>{u(D.value+R(e)),g.innerText=` ${e.toString()}`,D.style.opacity=e.toString(),this.dirty=!0}))})),g=createDiv({text:`${l.getValue().toString()}`,cls:"excalibrain-settings-sliderlabel"}),p.controlEl.appendChild(g),D.style.opacity=l.getValue().toString(),F(a&&!h.getValue())}numberslider(e,t,i,n,u,r,a,o,l){let D,h,d;const c=new s.Setting(e).setName(t),g=e=>{e?c.settingEl.addClass(M):c.settingEl.removeClass(M),d.setDisabled(e),d.sliderEl.style.opacity=e?"0.3":"1",D.style.opacity=e?"0.3":"1"};o&&c.addToggle((e=>{h=e,e.toggleEl.addClass("excalibrain-settings-toggle"),e.setValue(void 0!==u()).setTooltip(L("NODESTYLE_INCLUDE_TOGGLE")).onChange((e=>{if(this.dirty=!0,!e)return g(!0),void a();r(d.getValue()),g(!1)}))})),c.addSlider((e=>{var t;d=e,e.setLimits(n.min,n.max,n.step).setValue(null!==(t=u())&&void 0!==t?t:l).onChange((async e=>{D.innerText=` ${e.toString()}`,r(e),this.dirty=!0}))})),i&&c.setDesc(P(i)),c.settingEl.createDiv("",(e=>{D=e,e.style.minWidth="2.3em",e.style.textAlign="right",e.innerText=` ${d.getValue().toString()}`})),g(o&&!h.getValue())}toggle(e,t,i,n,u,r,a,o){let l,D;const h=new s.Setting(e).setName(t),d=e=>{e?h.settingEl.addClass(M):h.settingEl.removeClass(M),D.setDisabled(e),D.toggleEl.style.opacity=e?"0.3":"1"};a&&h.addToggle((e=>{l=e,e.toggleEl.addClass("excalibrain-settings-toggle"),e.setValue(void 0!==n()).setTooltip(L("NODESTYLE_INCLUDE_TOGGLE")).onChange((e=>{if(this.dirty=!0,!e)return d(!0),void r();u(D.getValue()),d(!1)}))})),h.addToggle((e=>{var t;D=e,e.setValue(null!==(t=n())&&void 0!==t?t:o).onChange((async e=>{u(e),this.dirty=!0}))})),i&&h.setDesc(P(i)),d(a&&!l.getValue())}dropdownpicker(e,t,i,n,u,r,a,o,l){let D,h;const d=new s.Setting(e).setName(t),c=e=>{e?d.settingEl.addClass(M):d.settingEl.removeClass(M),D.setDisabled(e),D.selectEl.style.opacity=e?"0.3":"1"};o&&d.addToggle((e=>{h=e,e.toggleEl.addClass("excalibrain-settings-toggle"),e.setValue(void 0!==u()).setTooltip(L("NODESTYLE_INCLUDE_TOGGLE")).onChange((e=>{if(this.dirty=!0,!e)return c(!0),void a();r(D.getValue()),c(!1)}))})),d.addDropdown((e=>{var t;D=e,e.addOptions(n).setValue(null!==(t=u())&&void 0!==t?t:l).onChange((e=>{r(e),this.dirty=!0}))})),i&&d.setDesc(P(i)),c(o&&!h.getValue())}nodeSettings(e,t,i=!0,n){let u,r;const a=new s.Setting(e).setName(L("NODESTYLE_PREFIX_NAME")).setDesc(P(L("NODESTYLE_PREFIX_DESC"))),o=e=>{e?a.settingEl.addClass(M):a.settingEl.removeClass(M),u.setDisabled(e),u.inputEl.style.opacity=e?"0.3":"1"};i&&a.addToggle((e=>{r=e,e.toggleEl.addClass("excalibrain-settings-toggle"),e.setValue(void 0!==t.prefix).setTooltip(L("NODESTYLE_INCLUDE_TOGGLE")).onChange((e=>{if(this.dirty=!0,!e)return o(!0),t.prefix=void 0,void this.updateNodeDemoImg();o(!1)}))})),a.addText((e=>{var i;u=e,e.setValue(null!==(i=t.prefix)&&void 0!==i?i:n.prefix).onChange((e=>{t.prefix=e,this.updateNodeDemoImg(),this.dirty=!0}))})),o(i&&!r.getValue()),this.colorpicker(e,L("NODESTYLE_BGCOLOR"),null,(()=>t.backgroundColor),(e=>{t.backgroundColor=e,this.updateNodeDemoImg()}),(()=>{delete t.backgroundColor,this.updateNodeDemoImg()}),i,n.backgroundColor),this.dropdownpicker(e,L("NODESTYLE_BG_FILLSTYLE"),null,{hachure:"Hachure","cross-hatch":"Cross-hatch",solid:"Solid"},(()=>{var e;return null===(e=t.fillStyle)||void 0===e?void 0:e.toString()}),(e=>{t.fillStyle=e,this.updateNodeDemoImg()}),(()=>{delete t.fillStyle,this.updateNodeDemoImg()}),i,n.fillStyle.toString()),this.colorpicker(e,L("NODESTYLE_TEXTCOLOR"),null,(()=>t.textColor),(e=>{t.textColor=e,this.updateNodeDemoImg()}),(()=>{delete t.textColor,this.updateNodeDemoImg()}),i,n.textColor),this.colorpicker(e,L("NODESTYLE_BORDERCOLOR"),null,(()=>t.borderColor),(e=>{t.borderColor=e,this.updateNodeDemoImg()}),(()=>{delete t.borderColor,this.updateNodeDemoImg()}),i,n.borderColor),this.numberslider(e,L("NODESTYLE_FONTSIZE"),null,{min:10,max:50,step:5},(()=>t.fontSize),(e=>{t.fontSize=e,this.updateNodeDemoImg()}),(()=>{delete t.fontSize,this.updateNodeDemoImg()}),i,n.fontSize),this.dropdownpicker(e,L("NODESTYLE_FONTFAMILY"),null,{1:"Hand-drawn",2:"Normal",3:"Code",4:"Fourth (custom) Font"},(()=>{var e;return null===(e=t.fontFamily)||void 0===e?void 0:e.toString()}),(e=>{t.fontFamily=parseInt(e),this.updateNodeDemoImg()}),(()=>{delete t.fontFamily,this.updateNodeDemoImg()}),i,n.fontFamily.toString()),this.numberslider(e,L("NODESTYLE_MAXLABELLENGTH_NAME"),L("NODESTYLE_MAXLABELLENGTH_DESC"),{min:15,max:100,step:5},(()=>t.maxLabelLength),(e=>{t.maxLabelLength=e,this.updateNodeDemoImg()}),(()=>{delete t.maxLabelLength,this.updateNodeDemoImg()}),i,n.maxLabelLength),this.dropdownpicker(e,L("NODESTYLE_ROUGHNESS"),null,{0:"Architect",1:"Artist",2:"Cartoonist"},(()=>{var e;return null===(e=t.roughness)||void 0===e?void 0:e.toString()}),(e=>{t.roughness=parseInt(e),this.updateNodeDemoImg()}),(()=>{delete t.roughness,this.updateNodeDemoImg()}),i,n.roughness.toString()),this.dropdownpicker(e,L("NODESTYLE_SHARPNESS"),null,{sharp:"Sharp",round:"Round"},(()=>t.strokeShaprness),(e=>{t.strokeShaprness=e,this.updateNodeDemoImg()}),(()=>{delete t.strokeShaprness,this.updateNodeDemoImg()}),i,n.strokeShaprness),this.numberslider(e,L("NODESTYLE_STROKEWIDTH"),null,{min:.5,max:6,step:.5},(()=>t.strokeWidth),(e=>{t.strokeWidth=e,this.updateNodeDemoImg()}),(()=>{delete t.strokeWidth,this.updateNodeDemoImg()}),i,n.strokeWidth),this.dropdownpicker(e,L("NODESTYLE_STROKESTYLE"),null,{solid:"Solid",dashed:"Dashed",dotted:"Dotted"},(()=>t.strokeStyle),(e=>{t.strokeStyle=e,this.updateNodeDemoImg()}),(()=>{delete t.strokeStyle,this.updateNodeDemoImg()}),i,n.strokeStyle),this.numberslider(e,L("NODESTYLE_RECTANGLEPADDING"),null,{min:5,max:50,step:5},(()=>t.padding),(e=>{t.padding=e,this.updateNodeDemoImg()}),(()=>{delete t.padding,this.updateNodeDemoImg()}),i,n.padding),this.numberslider(e,L("NODESTYLE_GATE_RADIUS_NAME"),L("NODESTYLE_GATE_RADIUS_DESC"),{min:3,max:10,step:1},(()=>t.gateRadius),(e=>{t.gateRadius=e,this.updateNodeDemoImg()}),(()=>{delete t.gateRadius,this.updateNodeDemoImg()}),i,n.gateRadius),this.numberslider(e,L("NODESTYLE_GATE_OFFSET_NAME"),L("NODESTYLE_GATE_OFFSET_DESC"),{min:0,max:25,step:1},(()=>t.gateOffset),(e=>{t.gateOffset=e,this.updateNodeDemoImg()}),(()=>{delete t.gateOffset,this.updateNodeDemoImg()}),i,n.gateOffset),this.colorpicker(e,L("NODESTYLE_GATE_COLOR"),null,(()=>t.gateStrokeColor),(e=>{t.gateStrokeColor=e,this.updateNodeDemoImg()}),(()=>{delete t.gateStrokeColor,this.updateNodeDemoImg()}),i,n.gateStrokeColor),this.colorpicker(e,L("NODESTYLE_GATE_BGCOLOR_NAME"),L("NODESTYLE_GATE_BGCOLOR_DESC"),(()=>t.gateBackgroundColor),(e=>{t.gateBackgroundColor=e,this.updateNodeDemoImg()}),(()=>{delete t.gateBackgroundColor,this.updateNodeDemoImg()}),i,n.gateBackgroundColor),this.dropdownpicker(e,L("NODESTYLE_GATE_FILLSTYLE"),null,{hachure:"Hachure","cross-hatch":"Cross-hatch",solid:"Solid"},(()=>{var e;return null===(e=t.gateFillStyle)||void 0===e?void 0:e.toString()}),(e=>{t.gateFillStyle=e,this.updateNodeDemoImg()}),(()=>{delete t.gateFillStyle,this.updateNodeDemoImg()}),i,n.gateFillStyle.toString())}linkSettings(e,t,i=!0,s){this.colorpicker(e,L("LINKSTYLE_COLOR"),null,(()=>t.strokeColor),(e=>{t.strokeColor=e,this.updateLinkDemoImg()}),(()=>{delete t.strokeColor,this.updateLinkDemoImg()}),i,s.strokeColor),this.numberslider(e,L("LINKSTYLE_WIDTH"),null,{min:.5,max:10,step:.5},(()=>t.strokeWidth),(e=>{t.strokeWidth=e,this.updateLinkDemoImg()}),(()=>{delete t.strokeWidth,this.updateLinkDemoImg()}),i,s.strokeWidth),this.dropdownpicker(e,L("LINKSTYLE_ROUGHNESS"),null,{0:"Architect",1:"Artist",2:"Cartoonist"},(()=>{var e;return null===(e=t.roughness)||void 0===e?void 0:e.toString()}),(e=>{t.roughness=parseInt(e),this.updateLinkDemoImg()}),(()=>{delete t.roughness,this.updateLinkDemoImg()}),i,s.roughness.toString()),this.dropdownpicker(e,L("LINKSTYLE_STROKE"),null,{solid:"Solid",dashed:"Dashed",dotted:"Dotted"},(()=>t.strokeStyle),(e=>{t.strokeStyle=e,this.updateLinkDemoImg()}),(()=>{delete t.strokeStyle,this.updateLinkDemoImg()}),i,s.strokeStyle),this.dropdownpicker(e,L("LINKSTYLE_ARROWSTART"),null,{none:"None",arrow:"Arrow",bar:"Bar",dot:"Dot",triangle:"Triangle"},(()=>t.startArrowHead),(e=>{t.startArrowHead=""===e?null:e,this.updateLinkDemoImg()}),(()=>{delete t.startArrowHead,this.updateLinkDemoImg()}),i,s.startArrowHead),this.dropdownpicker(e,L("LINKSTYLE_ARROWEND"),null,{none:"None",arrow:"Arrow",bar:"Bar",dot:"Dot",triangle:"Triangle"},(()=>t.endArrowHead),(e=>{t.endArrowHead=""===e?null:e,this.updateLinkDemoImg()}),(()=>{delete t.endArrowHead,this.updateLinkDemoImg()}),i,s.endArrowHead),this.toggle(e,L("LINKSTYLE_SHOWLABEL"),null,(()=>t.showLabel),(e=>{t.showLabel=e,this.updateLinkDemoImg()}),(()=>{delete t.showLabel,this.updateLinkDemoImg()}),i,s.showLabel),this.colorpicker(e,L("NODESTYLE_TEXTCOLOR"),null,(()=>t.textColor),(e=>{t.textColor=e,this.updateLinkDemoImg()}),(()=>{delete t.textColor,this.updateLinkDemoImg()}),i,s.textColor),this.numberslider(e,L("LINKSTYLE_FONTSIZE"),null,{min:6,max:30,step:3},(()=>t.fontSize),(e=>{t.fontSize=e,this.updateLinkDemoImg()}),(()=>{delete t.fontSize,this.updateLinkDemoImg()}),i,s.fontSize),this.dropdownpicker(e,L("LINKSTYLE_FONTFAMILY"),null,{1:"Hand-drawn",2:"Normal",3:"Code",4:"Fourth (custom) Font"},(()=>{var e;return null===(e=t.fontFamily)||void 0===e?void 0:e.toString()}),(e=>{t.fontFamily=parseInt(e),this.updateLinkDemoImg()}),(()=>{delete t.fontFamily,this.updateLinkDemoImg()}),i,s.fontFamily.toString())}getUnusedFieldNames(){const e=new Set;this.plugin.DVAPI.index.pages.forEach((t=>{const i=null==t?void 0:t.fields.keys();if(!i)return;let s;for(;!(s=i.next()).done;)s.value.contains(",")||s.value.startsWith("**")&&s.value.endsWith("**")||e.add(s.value)}));const t=new Map;e.forEach((e=>{t.set(e,e.toLowerCase().replaceAll(" ","-"))}));const i=new Set;return this.plugin.settings.hierarchy.parents.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.children.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.leftFriends.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.rightFriends.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.previous.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.next.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),this.plugin.settings.hierarchy.exclusions.forEach((e=>i.add(e.toLowerCase().replaceAll(" ","-")))),Array.from(t.entries()).forEach((([e,s])=>i.has(e.toLowerCase().replaceAll(" ","-"))||i.has(s)?(t.delete(e),void t.delete(s)):void(e!==s&&t.delete(s)))),Array.from(t.keys()).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)).join(", ")}async display(){const t=this.plugin.settings.navigationHistory;await this.plugin.loadSettings(),this.plugin.settings.navigationHistory=t,this.ea=v();const n=new m(null,"This is a demo node that is 46 characters long",null,this.plugin),u=new m(null,"This is a child node",null,this.plugin);n.addChild(u,e.DEFINED,i.FROM),u.addParent(n,e.DEFINED,i.TO),this.demoNode=new k({ea:this.ea,page:n,isInferred:!1,isCentral:!1,isSibling:!1,friendGateOnLeft:!0}),this.demoNode.ea=this.ea,this.demoNode.setCenter({x:0,y:0});const{containerEl:r}=this;this.containerEl.empty();const a=r.createDiv("coffee");a.addClass("ex-coffee-div"),a.createEl("a",{href:"https://ko-fi.com/zsolt"}).createEl("img",{attr:{src:"https://cdn.ko-fi.com/cdn/kofi3.png?v=3"}}).height=45,new s.Setting(r).setName(L("EXCALIBRAIN_FILE_NAME")).setDesc(P(L("EXCALIBRAIN_FILE_DESC"))).addText((e=>e.setValue(this.plugin.settings.excalibrainFilepath).onChange((t=>{this.dirty=!0,t.endsWith(".md")||(t+=t.endsWith(".m")?"d":t.endsWith(".")?"md":".md"),this.app.vault.getAbstractFileByPath(t)?new B(this.app,"âš  File Exists",`${t} already exists in your Vault. Is it ok to overwrite this file?`).show((i=>{i&&(this.plugin.settings.excalibrainFilepath=t,this.dirty=!0,e.inputEl.value=t)})):(this.plugin.settings.excalibrainFilepath=t,this.dirty=!0)})).inputEl.onblur=()=>{e.setValue(this.plugin.settings.excalibrainFilepath)})),this.numberslider(r,L("INDEX_REFRESH_FREQ_NAME"),L("INDEX_REFRESH_FREQ_DESC"),{min:5,max:120,step:5},(()=>this.plugin.settings.indexUpdateInterval/1e3),(e=>{this.plugin.settings.indexUpdateInterval=1e3*e,this.updateTimer=!0}),(()=>{}),!1,5e3),this.containerEl.createEl("h1",{cls:"excalibrain-settings-h1",text:L("HIERARCHY_HEAD")}),this.containerEl.createEl("p",{}).innerHTML=L("HIERARCHY_DESC");let o=()=>{};const l=new s.Setting(r).setName(L("PARENTS_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.parents.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.parents=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.parents=[],this.plugin.settings.hierarchy.parents.forEach((e=>this.plugin.hierarchyLowerCase.parents.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));l.nameEl.addClass("excalibrain-setting-nameEl"),l.descEl.addClass("excalibrain-setting-descEl"),l.controlEl.addClass("excalibrain-setting-controlEl");const D=new s.Setting(r).setName(L("CHILDREN_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.children.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.children=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.children=[],this.plugin.settings.hierarchy.children.forEach((e=>this.plugin.hierarchyLowerCase.children.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));D.nameEl.addClass("excalibrain-setting-nameEl"),D.descEl.addClass("excalibrain-setting-descEl"),D.controlEl.addClass("excalibrain-setting-controlEl");const h=new s.Setting(r).setName(L("LEFT_FRIENDS_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.leftFriends.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.leftFriends=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.leftFriends=[],this.plugin.settings.hierarchy.leftFriends.forEach((e=>this.plugin.hierarchyLowerCase.leftFriends.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));h.nameEl.addClass("excalibrain-setting-nameEl"),h.descEl.addClass("excalibrain-setting-descEl"),h.controlEl.addClass("excalibrain-setting-controlEl");const d=new s.Setting(r).setName(L("RIGHT_FRIENDS_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.rightFriends.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.rightFriends=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.rightFriends=[],this.plugin.settings.hierarchy.rightFriends.forEach((e=>this.plugin.hierarchyLowerCase.rightFriends.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));d.nameEl.addClass("excalibrain-setting-nameEl"),d.descEl.addClass("excalibrain-setting-descEl"),d.controlEl.addClass("excalibrain-setting-controlEl");const c=new s.Setting(r).setName(L("PREVIOUS_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.previous.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.previous=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.previous=[],this.plugin.settings.hierarchy.previous.forEach((e=>this.plugin.hierarchyLowerCase.previous.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));c.nameEl.addClass("excalibrain-setting-nameEl"),c.descEl.addClass("excalibrain-setting-descEl"),c.controlEl.addClass("excalibrain-setting-controlEl");const g=new s.Setting(r).setName(L("NEXT_NAME")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.next.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.next=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.plugin.hierarchyLowerCase.next=[],this.plugin.settings.hierarchy.next.forEach((e=>this.plugin.hierarchyLowerCase.next.push(e.toLowerCase().replaceAll(" ","-")))),o(),this.dirty=!0}))}));g.nameEl.addClass("excalibrain-setting-nameEl"),g.descEl.addClass("excalibrain-setting-descEl"),g.controlEl.addClass("excalibrain-setting-controlEl");const p=new s.Setting(r).setName(L("EXCLUSIONS_NAME")).setDesc(L("EXCLUSIONS_DESC")).addTextArea((e=>{e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.hierarchy.exclusions.join(", ")).onChange((e=>{this.plugin.settings.hierarchy.exclusions=e.split(",").map((e=>e.trim())).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),o(),this.dirty=!0}))}));let F;p.nameEl.addClass("excalibrain-setting-nameEl"),p.descEl.addClass("excalibrain-setting-descEl"),p.controlEl.addClass("excalibrain-setting-controlEl");const f=new s.Setting(r).setName(L("UNASSIGNED_NAME")).setDesc(L("UNASSIGNED_DESC")).addTextArea((e=>{F=e,e.inputEl.style.height="90px",e.inputEl.style.width="100%",e.setValue(this.getUnusedFieldNames()),e.setDisabled(!0)}));let E,C,y,w,S,x;f.nameEl.addClass("excalibrain-setting-nameEl"),f.descEl.addClass("excalibrain-setting-descEl"),f.controlEl.addClass("excalibrain-setting-controlEl"),new s.Setting(r).setName(L("INFER_NAME")).setDesc(P(L("INFER_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.inferAllLinksAsFriends).onChange((e=>{this.plugin.settings.inferAllLinksAsFriends=e,this.dirty=!0})))),new s.Setting(r).setName(L("REVERSE_NAME")).setDesc(P(L("REVERSE_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.inverseInfer).onChange((e=>{this.plugin.settings.inverseInfer=e,this.dirty=!0})))),new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_NAME")).setDesc(L("ONTOLOGY_SUGGESTER_DESC")).addToggle((e=>e.setValue(this.plugin.settings.allowOntologySuggester).onChange((e=>{this.plugin.settings.allowOntologySuggester=e,w.setDisabled(!e),E.setDisabled(!e),C.setDisabled(!e),y.setDisabled(!e),S.setDisabled(!e),x.setDisabled(!e),this.dirty=!0})))),w=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_ALL_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterTrigger=e,this.dirty=!0})))),E=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_PARENT_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterParentTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterParentTrigger=e,this.dirty=!0})))),C=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_CHILD_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterChildTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterChildTrigger=e,this.dirty=!0})))),y=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_LEFT_FRIEND_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterLeftFriendTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterLeftFriendTrigger=e,this.dirty=!0})))),y=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_RIGHT_FRIEND_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterRightFriendTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterRightFriendTrigger=e,this.dirty=!0})))),y=new s.Setting(r).setName(P(L("ONTOLOGY_SUGGESTER_PREVIOUS_NAME"))).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterPreviousTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterPreviousTrigger=e,this.dirty=!0})))),y=new s.Setting(r).setName(L("ONTOLOGY_SUGGESTER_NEXT_NAME")).setDisabled(!this.plugin.settings.allowOntologySuggester).addText((e=>e.setValue(this.plugin.settings.ontologySuggesterNextTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterNextTrigger=e,this.dirty=!0})))),S=new s.Setting(r).setName(L("MID_SENTENCE_SUGGESTER_TRIGGER_NAME")).setDesc(P(L("MID_SENTENCE_SUGGESTER_TRIGGER_DESC"))).addDropdown((e=>{e.addOption("(","(").addOption("[","[").setValue(this.plugin.settings.ontologySuggesterMidSentenceTrigger).onChange((e=>{this.plugin.settings.ontologySuggesterMidSentenceTrigger=e,this.dirty=!0}))})),x=new s.Setting(r).setName(L("BOLD_FIELDS_NAME")).setDesc(P(L("BOLD_FIELDS_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.boldFields).onChange((e=>{this.plugin.settings.boldFields=e,this.dirty=!0})))),this.containerEl.createEl("h1",{cls:"excalibrain-settings-h1",text:L("DISPLAY_HEAD")}),new s.Setting(r).setName(L("COMPACT_VIEW_NAME")).setDesc(P(L("COMPACT_VIEW_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.compactView).onChange((e=>{this.plugin.settings.compactView=e,this.dirty=!0}))));const T=new s.Setting(r).setName(L("EXCLUDE_PATHLIST_NAME")).setDesc(P(L("EXCLUDE_PATHLIST_DESC"))).addTextArea((e=>{e.inputEl.style.height="100px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.excludeFilepaths.join(", ")).onChange((e=>{const t=(e=e.replaceAll("\n"," ")).split(",").map((e=>e.trim()));this.plugin.settings.excludeFilepaths=t.filter((e=>""!==e)),this.dirty=!0}))}));T.descEl.style.width="90%",T.controlEl.style.width="90%",new s.Setting(r).setName(L("SHOW_FULL_TAG_PATH_NAME")).setDesc(P(L("SHOW_FULL_TAG_PATH_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.showFullTagName).onChange((e=>{this.plugin.settings.showFullTagName=e,this.dirty=!0})))),new s.Setting(r).setName(L("RENDERALIAS_NAME")).setDesc(P(L("RENDERALIAS_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.renderAlias).onChange((e=>{this.plugin.settings.renderAlias=e,this.dirty=!0}))));const A=new s.Setting(r).setName(L("NODETITLE_SCRIPT_NAME")).setDesc(P(L("NODETITLE_SCRIPT_DESC"))).addTextArea((e=>{e.inputEl.style.height="200px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.nodeTitleScript).onChange((e=>{this.plugin.settings.nodeTitleScript=e,this.dirty=!0}))}));let O,N;A.descEl.style.width="90%",A.controlEl.style.width="90%",new s.Setting(r).setName(L("SHOWINFERRED_NAME")).setDesc(P(L("SHOWINFERRED_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.showInferredNodes).onChange((e=>{this.plugin.settings.showInferredNodes=e,this.dirty=!0})))),new s.Setting(r).setName(L("SHOWATTACHMENTS_NAME")).setDesc(P(L("SHOWATTACHMENTS_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.showAttachments).onChange((e=>{this.plugin.settings.showAttachments=e,this.dirty=!0})))),new s.Setting(r).setName(L("SHOWVIRTUAL_NAME")).setDesc(P(L("SHOWVIRTUAL_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.showVirtualNodes).onChange((e=>{this.plugin.settings.showVirtualNodes=e,this.dirty=!0})))),this.numberslider(r,L("MAX_ITEMCOUNT_NAME"),L("MAX_ITEMCOUNT_DESC"),{min:5,max:150,step:5},(()=>this.plugin.settings.maxItemCount),(e=>this.plugin.settings.maxItemCount=e),(()=>{}),!1,30),new s.Setting(r).setName(L("SHOW_COUNT_NAME")).setDesc(P(L("SHOW_COUNT_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.showNeighborCount).onChange((e=>{this.plugin.settings.showNeighborCount=e,this.dirty=!0})))),new s.Setting(r).setName(L("ALLOW_AUTOZOOM_NAME")).setDesc(P(L("ALLOW_AUTOZOOM_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.allowAutozoom).onChange((e=>{this.plugin.settings.allowAutozoom=e,this.dirty=!0})))),new s.Setting(r).setName(L("ALLOW_AUTOFOCUS_ON_SEARCH_NAME")).setDesc(P(L("ALLOW_AUTOFOCUS_ON_SEARCH_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.allowAutofocuOnSearch).onChange((e=>{this.plugin.settings.allowAutofocuOnSearch=e,this.dirty=!0})))),new s.Setting(r).setName(L("ALWAYS_ON_TOP_NAME")).setDesc(P(L("ALWAYS_ON_TOP_DESC"))).addToggle((e=>e.setValue(this.plugin.settings.defaultAlwaysOnTop).onChange((e=>{this.plugin.settings.defaultAlwaysOnTop=e,this.dirty=!0})))),r.createEl("h1",{cls:"excalibrain-settings-h1",text:L("STYLE_HEAD")}),this.containerEl.createEl("p",{}).innerHTML=L("STYLE_DESC"),this.colorpicker(r,L("CANVAS_BGCOLOR"),null,(()=>this.plugin.settings.backgroundColor),(e=>{this.plugin.settings.backgroundColor=e,this.updateNodeDemoImg()}),(()=>{}),!1,this.plugin.settings.backgroundColor);const I=e=>{N.empty();const t=this.plugin.nodeStyles[e];this.nodeSettings(N,t.style,t.allowOverride,t.getInheritedStyle()),this.demoNodeStyle=t,this.updateNodeDemoImg()},_=new s.Setting(r).setName(L("TAGLIST_NAME")).setDesc(L("TAGLIST_DESC")).addTextArea((e=>{e.inputEl.style.height="200px",e.inputEl.style.width="100%",e.setValue(this.plugin.settings.tagStyleList.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)).join(", ")).onChange((e=>{const t=this.plugin.settings.tagNodeStyles,i=this.plugin.nodeStyles,s=(e=e.replaceAll("\n"," ")).split(",").map((e=>e.trim())).sort(((e,t)=>e.toLocaleLowerCase()<t.toLocaleLowerCase()?-1:1));this.plugin.settings.tagStyleList=s,Object.keys(t).forEach((e=>{s.contains(e)||(delete t[e],delete i[e])})),s.forEach((e=>{Object.keys(t).contains(e)||(t[e]={},i[e]={style:t[e],allowOverride:!0,userStyle:!0,display:e,getInheritedStyle:()=>this.plugin.settings.baseNodeStyle})}));const n=O.getValue();for(let e=O.selectEl.options.length-1;e>=0;e--)O.selectEl.remove(e);Object.entries(i).forEach((e=>{O.addOption(e[0],e[1].display)})),i[n]?O.setValue(n):(O.setValue("base"),I("base")),this.dirty=!0}))}));_.descEl.style.width="90%",_.controlEl.style.width="90%";const R=r.createDiv({cls:"setting-item"}),j=R.createDiv({cls:"setting-item-info"});let W;O=new s.DropdownComponent(j),R.createDiv({text:"Show inherited",cls:"setting-item-name"}).style.marginRight="10px";let G=!1;const Y=new s.ToggleComponent(R);Y.setValue(!0).setTooltip("Show/Hide Inherited Properties").onChange((e=>{G?G=!1:(e?V("excalibrain-hide-disabled"):H("excalibrain-hide-disabled",M),G=!0,W.setValue(e))})),Object.entries(this.plugin.nodeStyles).forEach((e=>{O.addOption(e[0],e[1].display)})),this.demoNodeImg=r.createEl("img",{cls:"excalibrain-settings-demoimg"}),N=r.createDiv({cls:"excalibrain-setting-style-section"}),V("excalibrain-hide-disabled"),O.setValue("base").onChange(I);const U=this.plugin.nodeStyles.base;let z,q;this.nodeSettings(N,U.style,U.allowOverride,U.getInheritedStyle()),this.demoNodeStyle=U,this.updateNodeDemoImg();const $=e=>{q.empty();const t=this.plugin.linkStyles[e];this.linkSettings(q,t.style,t.allowOverride,t.getInheritedStyle()),this.demoLinkStyle=t,this.updateLinkDemoImg()},Z=r.createDiv({cls:"setting-item"}),X=Z.createDiv({cls:"setting-item-info"});z=new s.DropdownComponent(X),Z.createDiv({text:"Show inherited",cls:"setting-item-name"}).style.marginRight="10px",W=new s.ToggleComponent(Z),W.setValue(!0).setTooltip("Show/Hide Inherited Properties").onChange((e=>{G?G=!1:(e?V("excalibrain-hide-disabled"):H("excalibrain-hide-disabled",M),G=!0,Y.setValue(e))})),Object.entries(this.plugin.linkStyles).forEach((e=>{z.addOption(e[0],e[1].display)})),this.demoLinkImg=r.createEl("img",{cls:"excalibrain-settings-demoimg"}),q=r.createDiv({cls:"excalibrain-setting-nodestyle-section"}),z.setValue("base").onChange($);const J=this.plugin.linkStyles.base;this.linkSettings(q,J.style,J.allowOverride,J.getInheritedStyle()),this.demoLinkStyle=J,this.updateLinkDemoImg(),o=()=>{F.setValue(this.getUnusedFieldNames());const e=this.plugin.settings.hierarchyLinkStyles,t=this.plugin.linkStyles;Object.keys(t).forEach((i=>{b.contains(i)||this.hierarchyStyleList.contains(i)||(delete t[i],delete e[i])})),this.hierarchyStyleList.forEach((i=>{Object.keys(e).contains(i)||b.contains(i)||(e[i]={},t[i]={style:e[i],allowOverride:!0,userStyle:!0,display:i,getInheritedStyle:()=>this.plugin.settings.baseLinkStyle})}));const i=z.getValue();for(let e=z.selectEl.options.length-1;e>=0;e--)z.selectEl.remove(e);const s=this.plugin.settings.hierarchy,n=e=>b.includes(e)?"0"+e.toLowerCase():s.parents.includes(e)?"1"+e.toLowerCase():s.children.includes(e)?"2"+e.toLowerCase():"3"+e.toLowerCase();Object.entries(t).sort(((e,t)=>n(e[0])<n(t[0])?-1:1)).forEach((e=>{z.addOption(e[0],this.plugin.settings.hierarchy.parents.includes(e[1].display)?"Parent > "+e[1].display:this.plugin.settings.hierarchy.children.includes(e[1].display)?"Child > "+e[1].display:this.plugin.settings.hierarchy.leftFriends.includes(e[1].display)?"Left Friend > "+e[1].display:this.plugin.settings.hierarchy.rightFriends.includes(e[1].display)?"Right Friend > "+e[1].display:this.plugin.settings.hierarchy.previous.includes(e[1].display)?"Previous > "+e[1].display:this.plugin.settings.hierarchy.next.includes(e[1].display)?"Next > "+e[1].display:e[1].display)})),t[i]?z.setValue(i):(z.setValue("base"),$("base"))},o()}}var W={};Object.defineProperty(W,"__esModule",{value:!0});class G extends Error{}class Y extends G{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class U extends G{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class z extends G{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class q extends G{}class $ extends G{constructor(e){super(`Invalid unit ${e}`)}}class Z extends G{}class X extends G{constructor(){super("Zone is an abstract class")}}const J="numeric",K="short",Q="long",ee={year:J,month:J,day:J},te={year:J,month:K,day:J},ie={year:J,month:K,day:J,weekday:K},se={year:J,month:Q,day:J},ne={year:J,month:Q,day:J,weekday:Q},ue={hour:J,minute:J},re={hour:J,minute:J,second:J},ae={hour:J,minute:J,second:J,timeZoneName:K},oe={hour:J,minute:J,second:J,timeZoneName:Q},le={hour:J,minute:J,hourCycle:"h23"},De={hour:J,minute:J,second:J,hourCycle:"h23"},he={hour:J,minute:J,second:J,hourCycle:"h23",timeZoneName:K},de={hour:J,minute:J,second:J,hourCycle:"h23",timeZoneName:Q},ce={year:J,month:J,day:J,hour:J,minute:J},ge={year:J,month:J,day:J,hour:J,minute:J,second:J},pe={year:J,month:K,day:J,hour:J,minute:J},Fe={year:J,month:K,day:J,hour:J,minute:J,second:J},fe={year:J,month:K,day:J,weekday:K,hour:J,minute:J},Ee={year:J,month:Q,day:J,hour:J,minute:J,timeZoneName:K},me={year:J,month:Q,day:J,hour:J,minute:J,second:J,timeZoneName:K},Ce={year:J,month:Q,day:J,weekday:Q,hour:J,minute:J,timeZoneName:Q},ye={year:J,month:Q,day:J,weekday:Q,hour:J,minute:J,second:J,timeZoneName:Q};class we{get type(){throw new X}get name(){throw new X}get ianaName(){return this.name}get isUniversal(){throw new X}offsetName(e,t){throw new X}formatOffset(e,t){throw new X}offset(e){throw new X}equals(e){throw new X}get isValid(){throw new X}}let ve=null;class Se extends we{static get instance(){return null===ve&&(ve=new Se),ve}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Ft(e,t,i)}formatOffset(e,t){return Ct(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let be={};const xe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Te={};class Ae extends we{static create(e){return Te[e]||(Te[e]=new Ae(e)),Te[e]}static resetCache(){Te={},be={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ae.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return Ft(e,t,i,this.name)}formatOffset(e,t){return Ct(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const i=(s=this.name,be[s]||(be[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),be[s]);var s;let[n,u,r,a,o,l,D]=i.formatToParts?function(e,t){const i=e.formatToParts(t),s=[];for(let e=0;e<i.length;e++){const{type:t,value:n}=i[e],u=xe[t];"era"===t?s[u]=n:Ke(u)||(s[u]=parseInt(n,10))}return s}(i,t):function(e,t){const i=e.format(t).replace(/\u200E/g,""),s=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,u,r,a,o,l,D]=s;return[r,n,u,a,o,l,D]}(i,t);"BC"===a&&(n=1-Math.abs(n));let h=+t;const d=h%1e3;return h-=d>=0?d:1e3+d,(ct({year:n,month:u,day:r,hour:24===o?0:o,minute:l,second:D,millisecond:0})-h)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let Oe={},Ne={};function Le(e,t={}){const i=JSON.stringify([e,t]);let s=Ne[i];return s||(s=new Intl.DateTimeFormat(e,t),Ne[i]=s),s}let Be={},ke={},Ie=null;function _e(e,t,i,s,n){const u=e.listingMode(i);return"error"===u?null:"en"===u?s(t):n(t)}class Me{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...u}=i;if(!t||Object.keys(u).length>0){const t={useGrouping:!1,...i};i.padTo>0&&(t.minimumIntegerDigits=i.padTo),this.inf=function(e,t={}){const i=JSON.stringify([e,t]);let s=Be[i];return s||(s=new Intl.NumberFormat(e,t),Be[i]=s),s}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return ut(this.floor?Math.floor(e):lt(e,3),this.padTo)}}class Re{constructor(e,t,i){let s;if(this.opts=i,e.zone.isUniversal){const t=e.offset/60*-1,n=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&Ae.create(n).valid?(s=n,this.dt=e):(s="UTC",i.timeZoneName?this.dt=e:this.dt=0===e.offset?e:_s.fromMillis(e.ts+60*e.offset*1e3))}else"system"===e.zone.type?this.dt=e:(this.dt=e,s=e.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Le(t,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class Pe{constructor(e,t,i){this.opts={style:"long",...i},!t&&tt()&&(this.rtf=function(e,t={}){const{base:i,...s}=t,n=JSON.stringify([e,s]);let u=ke[n];return u||(u=new Intl.RelativeTimeFormat(e,t),ke[n]=u),u}(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,i="always",s=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},u=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===i&&u){const i="days"===e;switch(t){case 1:return i?"tomorrow":`next ${n[e][0]}`;case-1:return i?"yesterday":`last ${n[e][0]}`;case 0:return i?"today":`this ${n[e][0]}`}}const r=Object.is(t,-0)||t<0,a=Math.abs(t),o=1===a,l=n[e],D=s?o?l[1]:l[2]||l[1]:o?n[e][0]:e;return r?`${a} ${D} ago`:`in ${a} ${D}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}class Ve{static fromOpts(e){return Ve.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,i,s=!1){const n=e||Je.defaultLocale,u=n||(s?"en-US":Ie||(Ie=(new Intl.DateTimeFormat).resolvedOptions().locale,Ie)),r=t||Je.defaultNumberingSystem,a=i||Je.defaultOutputCalendar;return new Ve(u,r,a,n)}static resetCache(){Ie=null,Ne={},Be={},ke={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:i}={}){return Ve.create(e,t,i)}constructor(e,t,i,s){const[n,u,r]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const i=e.indexOf("-u-");if(-1===i)return[e];{let t,s;try{t=Le(e).resolvedOptions(),s=e}catch(n){const u=e.substring(0,i);t=Le(u).resolvedOptions(),s=u}const{numberingSystem:n,calendar:u}=t;return[s,n,u]}}(e);this.locale=n,this.numberingSystem=t||u||null,this.outputCalendar=i||r||null,this.intl=function(e,t,i){return i||t?(e.includes("-u-")||(e+="-u"),i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?Ve.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1,i=!0){return _e(this,e,i,bt,(()=>{const i=t?{month:e,day:"numeric"}:{month:e},s=t?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=function(e){const t=[];for(let i=1;i<=12;i++){const s=_s.utc(2016,i,1);t.push(e(s))}return t}((e=>this.extract(e,i,"month")))),this.monthsCache[s][e]}))}weekdays(e,t=!1,i=!0){return _e(this,e,i,Ot,(()=>{const i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=t?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=function(e){const t=[];for(let i=1;i<=7;i++){const s=_s.utc(2016,11,13+i);t.push(e(s))}return t}((e=>this.extract(e,i,"weekday")))),this.weekdaysCache[s][e]}))}meridiems(e=!0){return _e(this,void 0,e,(()=>Nt),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[_s.utc(2016,11,13,9),_s.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e,t=!0){return _e(this,e,t,It,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[_s.utc(-40,1,1),_s.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,i){const s=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===i));return s?s.value:null}numberFormatter(e={}){return new Me(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Re(e,this.intl,t)}relFormatter(e={}){return new Pe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const i=JSON.stringify([e,t]);let s=Oe[i];return s||(s=new Intl.ListFormat(e,t),Oe[i]=s),s}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let He=null;class je extends we{static get utcInstance(){return null===He&&(He=new je(0)),He}static instance(e){return 0===e?je.utcInstance:new je(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new je(ft(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${Ct(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${Ct(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return Ct(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class We extends we{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Ge(e,t){if(Ke(e)||null===e)return t;if(e instanceof we)return e;if("string"==typeof e){const i=e.toLowerCase();return"default"===i?t:"local"===i||"system"===i?Se.instance:"utc"===i||"gmt"===i?je.utcInstance:je.parseSpecifier(i)||Ae.create(e)}return Qe(e)?je.instance(e):"object"==typeof e&&e.offset&&"number"==typeof e.offset?e:new We(e)}let Ye,Ue=()=>Date.now(),ze="system",qe=null,$e=null,Ze=null,Xe=60;class Je{static get now(){return Ue}static set now(e){Ue=e}static set defaultZone(e){ze=e}static get defaultZone(){return Ge(ze,Se.instance)}static get defaultLocale(){return qe}static set defaultLocale(e){qe=e}static get defaultNumberingSystem(){return $e}static set defaultNumberingSystem(e){$e=e}static get defaultOutputCalendar(){return Ze}static set defaultOutputCalendar(e){Ze=e}static get twoDigitCutoffYear(){return Xe}static set twoDigitCutoffYear(e){Xe=e%100}static get throwOnInvalid(){return Ye}static set throwOnInvalid(e){Ye=e}static resetCaches(){Ve.resetCache(),Ae.resetCache()}}function Ke(e){return void 0===e}function Qe(e){return"number"==typeof e}function et(e){return"number"==typeof e&&e%1==0}function tt(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function it(e,t,i){if(0!==e.length)return e.reduce(((e,s)=>{const n=[t(s),s];return e&&i(e[0],n[0])===e[0]?e:n}),null)[1]}function st(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function nt(e,t,i){return et(e)&&e>=t&&e<=i}function ut(e,t=2){let i;return i=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),i}function rt(e){return Ke(e)||null===e||""===e?void 0:parseInt(e,10)}function at(e){return Ke(e)||null===e||""===e?void 0:parseFloat(e)}function ot(e){if(!Ke(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function lt(e,t,i=!1){const s=10**t;return(i?Math.trunc:Math.round)(e*s)/s}function Dt(e){return e%4==0&&(e%100!=0||e%400==0)}function ht(e){return Dt(e)?366:365}function dt(e,t){const i=(s=t-1)-12*Math.floor(s/12)+1;var s;return 2===i?Dt(e+(t-i)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function ct(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function gt(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,s=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return 4===t||3===s?53:52}function pt(e){return e>99?e:e>Je.twoDigitCutoffYear?1900+e:2e3+e}function Ft(e,t,i,s=null){const n=new Date(e),u={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};s&&(u.timeZone=s);const r={timeZoneName:t,...u},a=new Intl.DateTimeFormat(i,r).formatToParts(n).find((e=>"timezonename"===e.type.toLowerCase()));return a?a.value:null}function ft(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const s=parseInt(t,10)||0;return 60*i+(i<0||Object.is(i,-0)?-s:s)}function Et(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new Z(`Invalid unit value ${e}`);return t}function mt(e,t){const i={};for(const s in e)if(st(e,s)){const n=e[s];if(null==n)continue;i[t(s)]=Et(n)}return i}function Ct(e,t){const i=Math.trunc(Math.abs(e/60)),s=Math.trunc(Math.abs(e%60)),n=e>=0?"+":"-";switch(t){case"short":return`${n}${ut(i,2)}:${ut(s,2)}`;case"narrow":return`${n}${i}${s>0?`:${s}`:""}`;case"techie":return`${n}${ut(i,2)}${ut(s,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function yt(e){return function(e,t){return["hour","minute","second","millisecond"].reduce(((t,i)=>(t[i]=e[i],t)),{})}(e)}const wt=["January","February","March","April","May","June","July","August","September","October","November","December"],vt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],St=["J","F","M","A","M","J","J","A","S","O","N","D"];function bt(e){switch(e){case"narrow":return[...St];case"short":return[...vt];case"long":return[...wt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const xt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Tt=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],At=["M","T","W","T","F","S","S"];function Ot(e){switch(e){case"narrow":return[...At];case"short":return[...Tt];case"long":return[...xt];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Nt=["AM","PM"],Lt=["Before Christ","Anno Domini"],Bt=["BC","AD"],kt=["B","A"];function It(e){switch(e){case"narrow":return[...kt];case"short":return[...Bt];case"long":return[...Lt];default:return null}}function _t(e,t){let i="";for(const s of e)s.literal?i+=s.val:i+=t(s.val);return i}const Mt={D:ee,DD:te,DDD:se,DDDD:ne,t:ue,tt:re,ttt:ae,tttt:oe,T:le,TT:De,TTT:he,TTTT:de,f:ce,ff:pe,fff:Ee,ffff:Ce,F:ge,FF:Fe,FFF:me,FFFF:ye};class Rt{static create(e,t={}){return new Rt(e,t)}static parseFormat(e){let t=null,i="",s=!1;const n=[];for(let u=0;u<e.length;u++){const r=e.charAt(u);"'"===r?(i.length>0&&n.push({literal:s,val:i}),t=null,i="",s=!s):s||r===t?i+=r:(i.length>0&&n.push({literal:!1,val:i}),i=r,t=r)}return i.length>0&&n.push({literal:s,val:i}),n}static macroTokenToFormatOpts(e){return Mt[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}formatDateTime(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).format()}formatDateTimeParts(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).formatToParts()}formatInterval(e,t={}){return this.loc.dtFormatter(e.start,{...this.opts,...t}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t}).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return ut(e,t);const i={...this.opts};return t>0&&(i.padTo=t),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,t){const i="en"===this.loc.listingMode(),s=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,n=(t,i)=>this.loc.extract(e,t,i),u=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",r=(t,s)=>i?function(e,t){return bt(t)[e.month-1]}(e,t):n(s?{month:t}:{month:t,day:"numeric"},"month"),a=(t,s)=>i?function(e,t){return Ot(t)[e.weekday-1]}(e,t):n(s?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),o=t=>{const i=Rt.macroTokenToFormatOpts(t);return i?this.formatWithSystemDefault(e,i):t},l=t=>i?function(e,t){return It(t)[e.year<0?0:1]}(e,t):n({era:t},"era");return _t(Rt.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return u({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return u({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return u({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return i?function(e){return Nt[e.hour<12?0:1]}(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return a("short",!0);case"cccc":return a("long",!0);case"ccccc":return a("narrow",!0);case"EEE":return a("short",!1);case"EEEE":return a("long",!1);case"EEEEE":return a("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return r("short",!0);case"LLLL":return r("long",!0);case"LLLLL":return r("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return r("short",!1);case"MMMM":return r("long",!1);case"MMMMM":return r("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return l("short");case"GG":return l("long");case"GGGGG":return l("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return o(t)}}))}formatDurationFromString(e,t){const i=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=Rt.parseFormat(t),n=s.reduce(((e,{literal:t,val:i})=>t?e:e.concat(i)),[]);return _t(s,(e=>t=>{const s=i(t);return s?this.num(e.get(s),t.length):t})(e.shiftTo(...n.map(i).filter((e=>e)))))}}class Pt{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Vt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Ht(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp(`^${t}$`)}function jt(...e){return t=>e.reduce((([e,i,s],n)=>{const[u,r,a]=n(t,s);return[{...e,...u},r||i,a]}),[{},null,1]).slice(0,2)}function Wt(e,...t){if(null==e)return[null,null];for(const[i,s]of t){const t=i.exec(e);if(t)return s(t)}return[null,null]}function Gt(...e){return(t,i)=>{const s={};let n;for(n=0;n<e.length;n++)s[e[n]]=rt(t[i+n]);return[s,null,i+n]}}const Yt=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Ut=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,zt=RegExp(`${Ut.source}(?:${Yt.source}?(?:\\[(${Vt.source})\\])?)?`),qt=RegExp(`(?:T${zt.source})?`),$t=Gt("weekYear","weekNumber","weekDay"),Zt=Gt("year","ordinal"),Xt=RegExp(`${Ut.source} ?(?:${Yt.source}|(${Vt.source}))?`),Jt=RegExp(`(?: ${Xt.source})?`);function Kt(e,t,i){const s=e[t];return Ke(s)?i:rt(s)}function Qt(e,t){return[{hours:Kt(e,t,0),minutes:Kt(e,t+1,0),seconds:Kt(e,t+2,0),milliseconds:ot(e[t+3])},null,t+4]}function ei(e,t){const i=!e[t]&&!e[t+1],s=ft(e[t+1],e[t+2]);return[{},i?null:je.instance(s),t+3]}function ti(e,t){return[{},e[t]?Ae.create(e[t]):null,t+1]}const ii=RegExp(`^T?${Ut.source}$`),si=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function ni(e){const[t,i,s,n,u,r,a,o,l]=e,D="-"===t[0],h=o&&"-"===o[0],d=(e,t=!1)=>void 0!==e&&(t||e&&D)?-e:e;return[{years:d(at(i)),months:d(at(s)),weeks:d(at(n)),days:d(at(u)),hours:d(at(r)),minutes:d(at(a)),seconds:d(at(o),"-0"===o),milliseconds:d(ot(l),h)}]}const ui={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function ri(e,t,i,s,n,u,r){const a={year:2===t.length?pt(rt(t)):rt(t),month:vt.indexOf(i)+1,day:rt(s),hour:rt(n),minute:rt(u)};return r&&(a.second=rt(r)),e&&(a.weekday=e.length>3?xt.indexOf(e)+1:Tt.indexOf(e)+1),a}const ai=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function oi(e){const[,t,i,s,n,u,r,a,o,l,D,h]=e,d=ri(t,n,s,i,u,r,a);let c;return c=o?ui[o]:l?0:ft(D,h),[d,new je(c)]}const li=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Di=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,hi=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function di(e){const[,t,i,s,n,u,r,a]=e;return[ri(t,n,s,i,u,r,a),je.utcInstance]}function ci(e){const[,t,i,s,n,u,r,a]=e;return[ri(t,a,i,s,n,u,r),je.utcInstance]}const gi=Ht(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,qt),pi=Ht(/(\d{4})-?W(\d\d)(?:-?(\d))?/,qt),Fi=Ht(/(\d{4})-?(\d{3})/,qt),fi=Ht(zt),Ei=jt((function(e,t){return[{year:Kt(e,t),month:Kt(e,t+1,1),day:Kt(e,t+2,1)},null,t+3]}),Qt,ei,ti),mi=jt($t,Qt,ei,ti),Ci=jt(Zt,Qt,ei,ti),yi=jt(Qt,ei,ti),wi=jt(Qt),vi=Ht(/(\d{4})-(\d\d)-(\d\d)/,Jt),Si=Ht(Xt),bi=jt(Qt,ei,ti),xi={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Ti={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...xi},Ai={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...xi},Oi=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Ni=Oi.slice(0).reverse();function Li(e,t,i=!1){const s={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new ki(s)}function Bi(e,t,i,s,n){const u=e[n][i],r=t[i]/u,a=Math.sign(r)!==Math.sign(s[n])&&0!==s[n]&&Math.abs(r)<=1?function(e){return e<0?Math.floor(e):Math.ceil(e)}(r):Math.trunc(r);s[n]+=a,t[i]-=a*u}class ki{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let i=t?Ai:Ti;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Ve.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return ki.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new Z("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new ki({values:mt(e,ki.normalizeUnit),loc:Ve.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Qe(e))return ki.fromMillis(e);if(ki.isDuration(e))return e;if("object"==typeof e)return ki.fromObject(e);throw new Z(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=function(e){return Wt(e,[si,ni])}(e);return i?ki.fromObject(i,t):ki.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=function(e){return Wt(e,[ii,wi])}(e);return i?ki.fromObject(i,t):ki.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Z("need to specify a reason the Duration is invalid");const i=e instanceof Pt?e:new Pt(e,t);if(Je.throwOnInvalid)throw new z(i);return new ki({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new $(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?Rt.create(this.loc,i).formatDurationFromString(this,e):"Invalid Duration"}toHuman(e={}){const t=Oi.map((t=>{const i=this.values[t];return Ke(i)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(i)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=lt(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s="basic"===e.format?"hhmm":"hh:mm";e.suppressSeconds&&0===i.seconds&&0===i.milliseconds||(s+="basic"===e.format?"ss":":ss",e.suppressMilliseconds&&0===i.milliseconds||(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=ki.fromDurationLike(e),i={};for(const e of Oi)(st(t.values,e)||st(this.values,e))&&(i[e]=t.get(e)+this.get(e));return Li(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=ki.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=Et(e(this.values[i],i));return Li(this,{values:t},!0)}get(e){return this[ki.normalizeUnit(e)]}set(e){return this.isValid?Li(this,{values:{...this.values,...mt(e,ki.normalizeUnit)}}):this}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:s}={}){return Li(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:s,conversionAccuracy:i})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return function(e,t){Ni.reduce(((i,s)=>Ke(t[s])?i:(i&&Bi(e,t,i,t,s),s)),null)}(this.matrix,e),Li(this,{values:e},!0)}rescale(){return this.isValid?Li(this,{values:function(e){const t={};for(const[i,s]of Object.entries(e))0!==s&&(t[i]=s);return t}(this.normalize().shiftToAll().toObject())},!0):this}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>ki.normalizeUnit(e)));const t={},i={},s=this.toObject();let n;for(const u of Oi)if(e.indexOf(u)>=0){n=u;let e=0;for(const t in i)e+=this.matrix[t][u]*i[t],i[t]=0;Qe(s[u])&&(e+=s[u]);const r=Math.trunc(e);t[u]=r,i[u]=(1e3*e-1e3*r)/1e3;for(const e in s)Oi.indexOf(e)>Oi.indexOf(u)&&Bi(this.matrix,s,e,t,u)}else Qe(s[u])&&(i[u]=s[u]);for(const e in i)0!==i[e]&&(t[n]+=e===n?i[e]:i[e]/this.matrix[n][e]);return Li(this,{values:t},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return Li(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const s of Oi)if(t=this.values[s],i=e.values[s],!(void 0===t||0===t?void 0===i||0===i:t===i))return!1;var t,i;return!0}}const Ii="Invalid Interval";class _i{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Z("need to specify a reason the Interval is invalid");const i=e instanceof Pt?e:new Pt(e,t);if(Je.throwOnInvalid)throw new U(i);return new _i({invalid:i})}static fromDateTimes(e,t){const i=Ms(e),s=Ms(t),n=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?_i.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:_i.invalid("missing or invalid end"):_i.invalid("missing or invalid start")}(i,s);return null==n?new _i({start:i,end:s}):n}static after(e,t){const i=ki.fromDurationLike(t),s=Ms(e);return _i.fromDateTimes(s,s.plus(i))}static before(e,t){const i=ki.fromDurationLike(t),s=Ms(e);return _i.fromDateTimes(s.minus(i),s)}static fromISO(e,t){const[i,s]=(e||"").split("/",2);if(i&&s){let e,n,u,r;try{e=_s.fromISO(i,t),n=e.isValid}catch(s){n=!1}try{u=_s.fromISO(s,t),r=u.isValid}catch(s){r=!1}if(n&&r)return _i.fromDateTimes(e,u);if(n){const i=ki.fromISO(s,t);if(i.isValid)return _i.after(e,i)}else if(r){const e=ki.fromISO(i,t);if(e.isValid)return _i.before(u,e)}}return _i.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const t=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(t,e).get(e))+1}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&this.s<=e&&this.e>e}set({start:e,end:t}={}){return this.isValid?_i.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(Ms).filter((e=>this.contains(e))).sort(),i=[];let{s:s}=this,n=0;for(;s<this.e;){const e=t[n]||this.e,u=+e>+this.e?this.e:e;i.push(_i.fromDateTimes(s,u)),s=u,n+=1}return i}splitBy(e){const t=ki.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let i,{s:s}=this,n=1;const u=[];for(;s<this.e;){const e=this.start.plus(t.mapUnits((e=>e*n)));i=+e>+this.e?this.e:e,u.push(_i.fromDateTimes(s,i)),s=i,n+=1}return u}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&this.s<=e.s&&this.e>=e.e}equals(e){return!(!this.isValid||!e.isValid)&&this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:_i.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return _i.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],i)=>t?t.overlaps(i)||t.abutsStart(i)?[e,t.union(i)]:[e.concat([t]),i]:[e,i]),[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const s=[],n=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),u=Array.prototype.concat(...n).sort(((e,t)=>e.time-t.time));for(const e of u)i+="s"===e.type?1:-1,1===i?t=e.time:(t&&+t!=+e.time&&s.push(_i.fromDateTimes(t,e.time)),t=null);return _i.merge(s)}difference(...e){return _i.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:Ii}toLocaleString(e=ee,t={}){return this.isValid?Rt.create(this.s.loc.clone(t),e).formatInterval(this):Ii}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ii}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ii}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ii}toFormat(e,{separator:t=" â€“ "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Ii}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):ki.invalid(this.invalidReason)}mapEndpoints(e){return _i.fromDateTimes(e(this.s),e(this.e))}}class Mi{static hasDST(e=Je.defaultZone){const t=_s.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Ae.isValidZone(e)}static normalizeZone(e){return Ge(e,Je.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ve.create(t,i,n)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ve.create(t,i,n)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ve.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ve.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Ve.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return Ve.create(t,null,"gregory").eras(e)}static features(){return{relative:tt()}}}function Ri(e,t){const i=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),s=i(t)-i(e);return Math.floor(ki.fromMillis(s).as("days"))}const Pi={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},Vi={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Hi=Pi.hanidec.replace(/[\[|\]]/g,"").split("");function ji({numberingSystem:e},t=""){return new RegExp(`${Pi[e||"latn"]}${t}`)}function Wi(e,t=(e=>e)){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);if(-1!==e[i].search(Pi.hanidec))t+=Hi.indexOf(e[i]);else for(const e in Vi){const[i,n]=Vi[e];s>=i&&s<=n&&(t+=s-i)}}return parseInt(t,10)}return t}(e))}}const Gi=`[ ${String.fromCharCode(160)}]`,Yi=new RegExp(Gi,"g");function Ui(e){return e.replace(/\./g,"\\.?").replace(Yi,Gi)}function zi(e){return e.replace(/\./g,"").replace(Yi," ").toLowerCase()}function qi(e,t){return null===e?null:{regex:RegExp(e.map(Ui).join("|")),deser:([i])=>e.findIndex((e=>zi(i)===zi(e)))+t}}function $i(e,t){return{regex:e,deser:([,e,t])=>ft(e,t),groups:t}}function Zi(e){return{regex:e,deser:([e])=>e}}const Xi={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let Ji=null;function Ki(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const i=es(Rt.macroTokenToFormatOpts(e.val),t);return null==i||i.includes(void 0)?e:i}(e,t))))}function Qi(e,t,i){const s=Ki(Rt.parseFormat(i),e),n=s.map((t=>function(e,t){const i=ji(t),s=ji(t,"{2}"),n=ji(t,"{3}"),u=ji(t,"{4}"),r=ji(t,"{6}"),a=ji(t,"{1,2}"),o=ji(t,"{1,3}"),l=ji(t,"{1,6}"),D=ji(t,"{1,9}"),h=ji(t,"{2,4}"),d=ji(t,"{4,6}"),c=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},g=(g=>{if(e.literal)return c(g);switch(g.val){case"G":return qi(t.eras("short",!1),0);case"GG":return qi(t.eras("long",!1),0);case"y":return Wi(l);case"yy":case"kk":return Wi(h,pt);case"yyyy":case"kkkk":return Wi(u);case"yyyyy":return Wi(d);case"yyyyyy":return Wi(r);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return Wi(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return Wi(s);case"MMM":return qi(t.months("short",!0,!1),1);case"MMMM":return qi(t.months("long",!0,!1),1);case"LLL":return qi(t.months("short",!1,!1),1);case"LLLL":return qi(t.months("long",!1,!1),1);case"o":case"S":return Wi(o);case"ooo":case"SSS":return Wi(n);case"u":return Zi(D);case"uu":return Zi(a);case"uuu":case"E":case"c":return Wi(i);case"a":return qi(t.meridiems(),0);case"EEE":return qi(t.weekdays("short",!1,!1),1);case"EEEE":return qi(t.weekdays("long",!1,!1),1);case"ccc":return qi(t.weekdays("short",!0,!1),1);case"cccc":return qi(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return $i(new RegExp(`([+-]${a.source})(?::(${s.source}))?`),2);case"ZZZ":return $i(new RegExp(`([+-]${a.source})(${s.source})?`),2);case"z":return Zi(/[a-z_+-/]{1,256}?/i);default:return c(g)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return g.token=e,g}(t,e))),u=n.find((e=>e.invalidReason));if(u)return{input:t,tokens:s,invalidReason:u.invalidReason};{const[e,i]=function(e){return[`^${e.map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"")}$`,e]}(n),u=RegExp(e,"i"),[r,a]=function(e,t,i){const s=e.match(t);if(s){const e={};let t=1;for(const n in i)if(st(i,n)){const u=i[n],r=u.groups?u.groups+1:1;!u.literal&&u.token&&(e[u.token.val[0]]=u.deser(s.slice(t,t+r))),t+=r}return[s,e]}return[s,{}]}(t,u,i),[o,l,D]=a?function(e){let t,i=null;return Ke(e.z)||(i=Ae.create(e.z)),Ke(e.Z)||(i||(i=new je(e.Z)),t=e.Z),Ke(e.q)||(e.M=3*(e.q-1)+1),Ke(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Ke(e.u)||(e.S=ot(e.u)),[Object.keys(e).reduce(((t,i)=>{const s=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(i);return s&&(t[s]=e[i]),t}),{}),i,t]}(a):[null,null,void 0];if(st(a,"a")&&st(a,"H"))throw new q("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:s,regex:u,rawMatches:r,matches:a,result:o,zone:l,specificOffset:D}}}function es(e,t){return e?Rt.create(t,e).formatDateTimeParts((Ji||(Ji=_s.fromMillis(1555555555555)),Ji)).map((t=>function(e,t){const{type:i,value:s}=e;if("literal"===i)return{literal:!0,val:s};const n=t[i];let u=Xi[i];return"object"==typeof u&&(u=u[n]),u?{literal:!1,val:u}:void 0}(t,e))):null}const ts=[0,31,59,90,120,151,181,212,243,273,304,334],is=[0,31,60,91,121,152,182,213,244,274,305,335];function ss(e,t){return new Pt("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function ns(e,t,i){const s=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&s.setUTCFullYear(s.getUTCFullYear()-1900);const n=s.getUTCDay();return 0===n?7:n}function us(e,t,i){return i+(Dt(e)?is:ts)[t-1]}function rs(e,t){const i=Dt(e)?is:ts,s=i.findIndex((e=>e<t));return{month:s+1,day:t-i[s]}}function as(e){const{year:t,month:i,day:s}=e,n=us(t,i,s),u=ns(t,i,s);let r,a=Math.floor((n-u+10)/7);return a<1?(r=t-1,a=gt(r)):a>gt(t)?(r=t+1,a=1):r=t,{weekYear:r,weekNumber:a,weekday:u,...yt(e)}}function os(e){const{weekYear:t,weekNumber:i,weekday:s}=e,n=ns(t,1,4),u=ht(t);let r,a=7*i+s-n-3;a<1?(r=t-1,a+=ht(r)):a>u?(r=t+1,a-=ht(t)):r=t;const{month:o,day:l}=rs(r,a);return{year:r,month:o,day:l,...yt(e)}}function ls(e){const{year:t,month:i,day:s}=e;return{year:t,ordinal:us(t,i,s),...yt(e)}}function Ds(e){const{year:t,ordinal:i}=e,{month:s,day:n}=rs(t,i);return{year:t,month:s,day:n,...yt(e)}}function hs(e){const t=et(e.year),i=nt(e.month,1,12),s=nt(e.day,1,dt(e.year,e.month));return t?i?!s&&ss("day",e.day):ss("month",e.month):ss("year",e.year)}function ds(e){const{hour:t,minute:i,second:s,millisecond:n}=e,u=nt(t,0,23)||24===t&&0===i&&0===s&&0===n,r=nt(i,0,59),a=nt(s,0,59),o=nt(n,0,999);return u?r?a?!o&&ss("millisecond",n):ss("second",s):ss("minute",i):ss("hour",t)}const cs="Invalid DateTime";function gs(e){return new Pt("unsupported zone",`the zone "${e.name}" is not supported`)}function ps(e){return null===e.weekData&&(e.weekData=as(e.c)),e.weekData}function Fs(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new _s({...i,...t,old:i})}function fs(e,t,i){let s=e-60*t*1e3;const n=i.offset(s);if(t===n)return[s,t];s-=60*(n-t)*1e3;const u=i.offset(s);return n===u?[s,n]:[e-60*Math.min(n,u)*1e3,Math.max(n,u)]}function Es(e,t){const i=new Date(e+=60*t*1e3);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function ms(e,t,i){return fs(ct(e),t,i)}function Cs(e,t){const i=e.o,s=e.c.year+Math.trunc(t.years),n=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),u={...e.c,year:s,month:n,day:Math.min(e.c.day,dt(s,n))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},r=ki.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=ct(u);let[o,l]=fs(a,i,e.zone);return 0!==r&&(o+=r,l=e.zone.offset(o)),{ts:o,o:l}}function ys(e,t,i,s,n,u){const{setZone:r,zone:a}=i;if(e&&0!==Object.keys(e).length){const s=t||a,n=_s.fromObject(e,{...i,zone:s,specificOffset:u});return r?n:n.setZone(a)}return _s.invalid(new Pt("unparsable",`the input "${n}" can't be parsed as ${s}`))}function ws(e,t,i=!0){return e.isValid?Rt.create(Ve.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function vs(e,t){const i=e.c.year>9999||e.c.year<0;let s="";return i&&e.c.year>=0&&(s+="+"),s+=ut(e.c.year,i?6:4),t?(s+="-",s+=ut(e.c.month),s+="-",s+=ut(e.c.day)):(s+=ut(e.c.month),s+=ut(e.c.day)),s}function Ss(e,t,i,s,n,u){let r=ut(e.c.hour);return t?(r+=":",r+=ut(e.c.minute),0===e.c.second&&i||(r+=":")):r+=ut(e.c.minute),0===e.c.second&&i||(r+=ut(e.c.second),0===e.c.millisecond&&s||(r+=".",r+=ut(e.c.millisecond,3))),n&&(e.isOffsetFixed&&0===e.offset&&!u?r+="Z":e.o<0?(r+="-",r+=ut(Math.trunc(-e.o/60)),r+=":",r+=ut(Math.trunc(-e.o%60))):(r+="+",r+=ut(Math.trunc(e.o/60)),r+=":",r+=ut(Math.trunc(e.o%60)))),u&&(r+="["+e.zone.ianaName+"]"),r}const bs={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},xs={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Ts={ordinal:1,hour:0,minute:0,second:0,millisecond:0},As=["year","month","day","hour","minute","second","millisecond"],Os=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Ns=["year","ordinal","hour","minute","second","millisecond"];function Ls(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new $(e);return t}function Bs(e,t){const i=Ge(t.zone,Je.defaultZone),s=Ve.fromObject(t),n=Je.now();let u,r;if(Ke(e.year))u=n;else{for(const t of As)Ke(e[t])&&(e[t]=bs[t]);const t=hs(e)||ds(e);if(t)return _s.invalid(t);const s=i.offset(n);[u,r]=ms(e,s,i)}return new _s({ts:u,zone:i,loc:s,o:r})}function ks(e,t,i){const s=!!Ke(i.round)||i.round,n=(e,n)=>(e=lt(e,s||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(e,n)),u=s=>i.calendary?t.hasSame(e,s)?0:t.startOf(s).diff(e.startOf(s),s).get(s):t.diff(e,s).get(s);if(i.unit)return n(u(i.unit),i.unit);for(const e of i.units){const t=u(e);if(Math.abs(t)>=1)return n(t,e)}return n(e>t?-0:0,i.units[i.units.length-1])}function Is(e){let t,i={};return e.length>0&&"object"==typeof e[e.length-1]?(i=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[i,t]}class _s{constructor(e){const t=e.zone||Je.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Pt("invalid input"):null)||(t.isValid?null:gs(t));this.ts=Ke(e.ts)?Je.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[s,n]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);s=Es(this.ts,e),i=Number.isNaN(s.year)?new Pt("invalid input"):null,s=i?null:s,n=i?null:e}this._zone=t,this.loc=e.loc||Ve.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new _s({})}static local(){const[e,t]=Is(arguments),[i,s,n,u,r,a,o]=t;return Bs({year:i,month:s,day:n,hour:u,minute:r,second:a,millisecond:o},e)}static utc(){const[e,t]=Is(arguments),[i,s,n,u,r,a,o]=t;return e.zone=je.utcInstance,Bs({year:i,month:s,day:n,hour:u,minute:r,second:a,millisecond:o},e)}static fromJSDate(e,t={}){const i=(s=e,"[object Date]"===Object.prototype.toString.call(s)?e.valueOf():NaN);var s;if(Number.isNaN(i))return _s.invalid("invalid input");const n=Ge(t.zone,Je.defaultZone);return n.isValid?new _s({ts:i,zone:n,loc:Ve.fromObject(t)}):_s.invalid(gs(n))}static fromMillis(e,t={}){if(Qe(e))return e<-864e13||e>864e13?_s.invalid("Timestamp out of range"):new _s({ts:e,zone:Ge(t.zone,Je.defaultZone),loc:Ve.fromObject(t)});throw new Z(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Qe(e))return new _s({ts:1e3*e,zone:Ge(t.zone,Je.defaultZone),loc:Ve.fromObject(t)});throw new Z("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=Ge(t.zone,Je.defaultZone);if(!i.isValid)return _s.invalid(gs(i));const s=Je.now(),n=Ke(t.specificOffset)?i.offset(s):t.specificOffset,u=mt(e,Ls),r=!Ke(u.ordinal),a=!Ke(u.year),o=!Ke(u.month)||!Ke(u.day),l=a||o,D=u.weekYear||u.weekNumber,h=Ve.fromObject(t);if((l||r)&&D)throw new q("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&r)throw new q("Can't mix ordinal dates with month/day");const d=D||u.weekday&&!l;let c,g,p=Es(s,n);d?(c=Os,g=xs,p=as(p)):r?(c=Ns,g=Ts,p=ls(p)):(c=As,g=bs);let F=!1;for(const e of c)Ke(u[e])?u[e]=F?g[e]:p[e]:F=!0;const f=d?function(e){const t=et(e.weekYear),i=nt(e.weekNumber,1,gt(e.weekYear)),s=nt(e.weekday,1,7);return t?i?!s&&ss("weekday",e.weekday):ss("week",e.week):ss("weekYear",e.weekYear)}(u):r?function(e){const t=et(e.year),i=nt(e.ordinal,1,ht(e.year));return t?!i&&ss("ordinal",e.ordinal):ss("year",e.year)}(u):hs(u),E=f||ds(u);if(E)return _s.invalid(E);const m=d?os(u):r?Ds(u):u,[C,y]=ms(m,n,i),w=new _s({ts:C,zone:i,o:y,loc:h});return u.weekday&&l&&e.weekday!==w.weekday?_s.invalid("mismatched weekday",`you can't specify both a weekday of ${u.weekday} and a date of ${w.toISO()}`):w}static fromISO(e,t={}){const[i,s]=function(e){return Wt(e,[gi,Ei],[pi,mi],[Fi,Ci],[fi,yi])}(e);return ys(i,s,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,s]=function(e){return Wt(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[ai,oi])}(e);return ys(i,s,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,s]=function(e){return Wt(e,[li,di],[Di,di],[hi,ci])}(e);return ys(i,s,t,"HTTP",t)}static fromFormat(e,t,i={}){if(Ke(e)||Ke(t))throw new Z("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,u=Ve.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[r,a,o,l]=function(e,t,i){const{result:s,zone:n,specificOffset:u,invalidReason:r}=Qi(e,t,i);return[s,n,u,r]}(u,e,t);return l?_s.invalid(l):ys(r,a,i,`format ${t}`,e,o)}static fromString(e,t,i={}){return _s.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,s]=function(e){return Wt(e,[vi,Ei],[Si,bi])}(e);return ys(i,s,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Z("need to specify a reason the DateTime is invalid");const i=e instanceof Pt?e:new Pt(e,t);if(Je.throwOnInvalid)throw new Y(i);return new _s({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=es(e,Ve.fromObject(t));return i?i.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return Ki(Rt.parseFormat(e),Ve.fromObject(t)).map((e=>e.val)).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?ps(this).weekYear:NaN}get weekNumber(){return this.isValid?ps(this).weekNumber:NaN}get weekday(){return this.isValid?ps(this).weekday:NaN}get ordinal(){return this.isValid?ls(this.c).ordinal:NaN}get monthShort(){return this.isValid?Mi.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Mi.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Mi.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Mi.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}get isInLeapYear(){return Dt(this.year)}get daysInMonth(){return dt(this.year,this.month)}get daysInYear(){return this.isValid?ht(this.year):NaN}get weeksInWeekYear(){return this.isValid?gt(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:s}=Rt.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:s}}toUTC(e=0,t={}){return this.setZone(je.instance(e),t)}toLocal(){return this.setZone(Je.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if((e=Ge(e,Je.defaultZone)).equals(this.zone))return this;if(e.isValid){let s=this.ts;if(t||i){const t=e.offset(this.ts),i=this.toObject();[s]=ms(i,t,e)}return Fs(this,{ts:s,zone:e})}return _s.invalid(gs(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){return Fs(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=mt(e,Ls),i=!Ke(t.weekYear)||!Ke(t.weekNumber)||!Ke(t.weekday),s=!Ke(t.ordinal),n=!Ke(t.year),u=!Ke(t.month)||!Ke(t.day),r=n||u,a=t.weekYear||t.weekNumber;if((r||s)&&a)throw new q("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&s)throw new q("Can't mix ordinal dates with month/day");let o;i?o=os({...as(this.c),...t}):Ke(t.ordinal)?(o={...this.toObject(),...t},Ke(t.day)&&(o.day=Math.min(dt(o.year,o.month),o.day))):o=Ds({...ls(this.c),...t});const[l,D]=ms(o,this.o,this.zone);return Fs(this,{ts:l,o:D})}plus(e){return this.isValid?Fs(this,Cs(this,ki.fromDurationLike(e))):this}minus(e){return this.isValid?Fs(this,Cs(this,ki.fromDurationLike(e).negate())):this}startOf(e){if(!this.isValid)return this;const t={},i=ki.normalizeUnit(e);switch(i){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0}if("weeks"===i&&(t.weekday=1),"quarters"===i){const e=Math.ceil(this.month/3);t.month=3*(e-1)+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?Rt.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):cs}toLocaleString(e=ee,t={}){return this.isValid?Rt.create(this.loc.clone(t),e).formatDateTime(this):cs}toLocaleParts(e={}){return this.isValid?Rt.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const u="extended"===e;let r=vs(this,u);return r+="T",r+=Ss(this,u,t,i,s,n),r}toISODate({format:e="extended"}={}){return this.isValid?vs(this,"extended"===e):null}toISOWeekDate(){return ws(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:u="extended"}={}){return this.isValid?(s?"T":"")+Ss(this,"extended"===u,t,e,i,n):null}toRFC2822(){return ws(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ws(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?vs(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(t||e)&&(i&&(s+=" "),t?s+="z":e&&(s+="ZZ")),ws(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():cs}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return ki.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=(a=t,Array.isArray(a)?a:[a]).map(ki.normalizeUnit),u=e.valueOf()>this.valueOf(),r=function(e,t,i,s){let[n,u,r,a]=function(e,t,i){const s=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const i=Ri(e,t);return(i-i%7)/7}],["days",Ri]],n={},u=e;let r,a;for(const[o,l]of s)i.indexOf(o)>=0&&(r=o,n[o]=l(e,t),a=u.plus(n),a>t?(n[o]--,e=u.plus(n)):e=a);return[e,n,a,r]}(e,t,i);const o=t-n,l=i.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===l.length&&(r<t&&(r=n.plus({[a]:1})),r!==n&&(u[a]=(u[a]||0)+o/(r-n)));const D=ki.fromObject(u,s);return l.length>0?ki.fromMillis(o,s).shiftTo(...l).plus(D):D}(u?this:e,u?e:this,n,s);var a;return u?r.negate():r}diffNow(e="milliseconds",t={}){return this.diff(_s.now(),e,t)}until(e){return this.isValid?_i.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(t)<=i&&i<=s.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||_s.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),ks(t,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?ks(e.base||_s.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(_s.isDateTime))throw new Z("min requires all arguments be DateTimes");return it(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(_s.isDateTime))throw new Z("max requires all arguments be DateTimes");return it(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:s=null,numberingSystem:n=null}=i;return Qi(Ve.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,i={}){return _s.fromFormatExplain(e,t,i)}static get DATE_SHORT(){return ee}static get DATE_MED(){return te}static get DATE_MED_WITH_WEEKDAY(){return ie}static get DATE_FULL(){return se}static get DATE_HUGE(){return ne}static get TIME_SIMPLE(){return ue}static get TIME_WITH_SECONDS(){return re}static get TIME_WITH_SHORT_OFFSET(){return ae}static get TIME_WITH_LONG_OFFSET(){return oe}static get TIME_24_SIMPLE(){return le}static get TIME_24_WITH_SECONDS(){return De}static get TIME_24_WITH_SHORT_OFFSET(){return he}static get TIME_24_WITH_LONG_OFFSET(){return de}static get DATETIME_SHORT(){return ce}static get DATETIME_SHORT_WITH_SECONDS(){return ge}static get DATETIME_MED(){return pe}static get DATETIME_MED_WITH_SECONDS(){return Fe}static get DATETIME_MED_WITH_WEEKDAY(){return fe}static get DATETIME_FULL(){return Ee}static get DATETIME_FULL_WITH_SECONDS(){return me}static get DATETIME_HUGE(){return Ce}static get DATETIME_HUGE_WITH_SECONDS(){return ye}}function Ms(e){if(_s.isDateTime(e))return e;if(e&&e.valueOf&&Qe(e.valueOf()))return _s.fromJSDate(e);if(e&&"object"==typeof e)return _s.fromObject(e);throw new Z(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const Rs={renderNullAs:"\\-",taskCompletionTracking:!1,taskCompletionUseEmojiShorthand:!1,taskCompletionText:"completion",taskCompletionDateFormat:"yyyy-MM-dd",recursiveSubTaskCompletion:!1,warnOnEmptyResult:!0,refreshEnabled:!0,refreshInterval:2500,defaultDateFormat:"MMMM dd, yyyy",defaultDateTimeFormat:"h:mm a - MMMM dd, yyyy",maxRecursiveRenderDepth:4,tableIdColumnName:"File",tableGroupColumnName:"Group",showResultCount:!0};class Ps{constructor(e){this.value=e,this.successful=!0}map(e){return new Ps(e(this.value))}flatMap(e){return e(this.value)}mapErr(e){return this}bimap(e,t){return this.map(e)}orElse(e){return this.value}cast(){return this}orElseThrow(e){return this.value}}class Vs{constructor(e){this.error=e,this.successful=!1}map(e){return this}flatMap(e){return this}mapErr(e){return new Vs(e(this.error))}bimap(e,t){return this.mapErr(t)}orElse(e){return e}cast(){return this}orElseThrow(e){throw e?new Error(e(this.error)):new Error(""+this.error)}}var Hs;!function(e){function t(e){return new Ps(e)}function i(e){return new Vs(e)}function s(e,t,s){return e.successful?t.successful?s(e.value,t.value):i(t.error):i(e.error)}e.success=t,e.failure=i,e.flatMap2=s,e.map2=function(e,i,n){return s(e,i,((e,i)=>t(n(e,i))))}}(Hs||(Hs={})),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C||"undefined"!=typeof self&&self;var js={exports:{}};function Ws(e){return null==e?e:e.shiftToAll().normalize()}function Gs(e){return e.includes("/")&&(e=e.substring(e.lastIndexOf("/")+1)),e.endsWith(".md")&&(e=e.substring(0,e.length-3)),e}"undefined"!=typeof self&&self,js.exports=function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){function s(e){if(!(this instanceof s))return new s(e);this._=e}var n=s.prototype;function u(e,t){for(var i=0;i<e;i++)t(i)}function r(e,t,i){return function(e,t){u(t.length,(function(i){e(t[i],i,t)}))}((function(i,s,n){t=e(t,i,s,n)}),i),t}function a(e,t){return r((function(t,i,s,n){return t.concat([e(i,s,n)])}),[],t)}function o(e,t){var i={v:0,buf:t};return u(e,(function(){var e;i={v:i.v<<1|(e=i.buf,e[0]>>7),buf:function(e){var t=r((function(e,t,i,s){return e.concat(i===s.length-1?Buffer.from([t,0]).readUInt16BE(0):s.readUInt16BE(i))}),[],e);return Buffer.from(a((function(e){return(e<<1&65535)>>8}),t))}(i.buf)}})),i}function l(){return"undefined"!=typeof Buffer}function D(){if(!l())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function h(e){D();var t=r((function(e,t){return e+t}),0,e);if(t%8!=0)throw new Error("The bits ["+e.join(", ")+"] add up to "+t+" which is not an even number of bytes; the total should be divisible by 8");var i,n=t/8,u=(i=function(e){return e>48},r((function(e,t){return e||(i(t)?t:e)}),null,e));if(u)throw new Error(u+" bit range requested exceeds 48 bit (6 byte) Number max.");return new s((function(t,i){var s=n+i;return s>t.length?w(i,n.toString()+" bytes"):y(s,r((function(e,t){var i=o(t,e.buf);return{coll:e.coll.concat(i.v),buf:i.buf}}),{coll:[],buf:t.slice(i,s)},e).coll)}))}function d(e,t){return new s((function(i,s){return D(),s+t>i.length?w(s,t+" bytes for "+e):y(s+t,i.slice(s,s+t))}))}function c(e,t){if("number"!=typeof(i=t)||Math.floor(i)!==i||t<0||t>6)throw new Error(e+" requires integer length in range [0, 6].");var i}function g(e){return c("uintBE",e),d("uintBE("+e+")",e).map((function(t){return t.readUIntBE(0,e)}))}function p(e){return c("uintLE",e),d("uintLE("+e+")",e).map((function(t){return t.readUIntLE(0,e)}))}function F(e){return c("intBE",e),d("intBE("+e+")",e).map((function(t){return t.readIntBE(0,e)}))}function f(e){return c("intLE",e),d("intLE("+e+")",e).map((function(t){return t.readIntLE(0,e)}))}function E(e){return e instanceof s}function m(e){return"[object Array]"==={}.toString.call(e)}function C(e){return l()&&Buffer.isBuffer(e)}function y(e,t){return{status:!0,index:e,value:t,furthest:-1,expected:[]}}function w(e,t){return m(t)||(t=[t]),{status:!1,index:-1,value:null,furthest:e,expected:t}}function v(e,t){if(!t)return e;if(e.furthest>t.furthest)return e;var i=e.furthest===t.furthest?function(e,t){if(function(){if(void 0!==s._supportsSet)return s._supportsSet;var e="undefined"!=typeof Set;return s._supportsSet=e,e}()&&Array.from){for(var i=new Set(e),n=0;n<t.length;n++)i.add(t[n]);var u=Array.from(i);return u.sort(),u}for(var r={},a=0;a<e.length;a++)r[e[a]]=!0;for(var o=0;o<t.length;o++)r[t[o]]=!0;var l=[];for(var D in r)({}).hasOwnProperty.call(r,D)&&l.push(D);return l.sort(),l}(e.expected,t.expected):t.expected;return{status:e.status,index:e.index,value:e.value,furthest:t.furthest,expected:i}}var S={};function b(e,t){if(C(e))return{offset:t,line:-1,column:-1};e in S||(S[e]={});for(var i=S[e],s=0,n=0,u=0,r=t;r>=0;){if(r in i){s=i[r].line,0===u&&(u=i[r].lineStart);break}("\n"===e.charAt(r)||"\r"===e.charAt(r)&&"\n"!==e.charAt(r+1))&&(n++,0===u&&(u=r+1)),r--}var a=s+n,o=t-u;return i[t]={line:a,lineStart:u},{offset:t,line:a+1,column:o+1}}function x(e){if(!E(e))throw new Error("not a parser: "+e)}function T(e,t){return"string"==typeof e?e.charAt(t):e[t]}function A(e){if("number"!=typeof e)throw new Error("not a number: "+e)}function O(e){if("function"!=typeof e)throw new Error("not a function: "+e)}function N(e){if("string"!=typeof e)throw new Error("not a string: "+e)}function L(e,t){return new Array(t+1).join(e)}function B(e,t,i){var s=t-e.length;return s<=0?e:L(i,s)+e}function k(e,t,i,s){return{from:e-t>0?e-t:0,to:e+i>s?s:e+i}}function I(e,t){var i,s,n,u,o,l=t.index,D=l.offset,h=1;if(D===e.length)return"Got the end of the input";if(C(e)){var d=D-D%8,c=D-d,g=k(d,40,40,e.length),p=a((function(e){return a((function(e){return B(e.toString(16),2,"0")}),e)}),function(e,t){var i=e.length,s=[],n=0;if(i<=8)return[e.slice()];for(var u=0;u<i;u++)s[n]||s.push([]),s[n].push(e[u]),(u+1)%8==0&&n++;return s}(e.slice(g.from,g.to).toJSON().data));u=function(e){return 0===e.from&&1===e.to?{from:e.from,to:e.to}:{from:e.from/8,to:Math.floor(e.to/8)}}(g),s=d/8,i=3*c,c>=4&&(i+=1),h=2,n=a((function(e){return e.length<=4?e.join(" "):e.slice(0,4).join(" ")+"  "+e.slice(4).join(" ")}),p),(o=(8*(u.to>0?u.to-1:u.to)).toString(16).length)<2&&(o=2)}else{var F=e.split(/\r\n|[\n\r\u2028\u2029]/);i=l.column-1,s=l.line-1,u=k(s,2,3,F.length),n=F.slice(u.from,u.to),o=u.to.toString().length}var f=s-u.from;return C(e)&&(o=(8*(u.to>0?u.to-1:u.to)).toString(16).length)<2&&(o=2),r((function(t,s,n){var r,a=n===f,l=a?"> ":"  ";return r=C(e)?B((8*(u.from+n)).toString(16),o,"0"):B((u.from+n+1).toString(),o," "),[].concat(t,[l+r+" | "+s],a?["  "+L(" ",o)+" | "+B("",i," ")+L("^",h)]:[])}),[],n).join("\n")}function _(e,t){return["\n","-- PARSING FAILED "+L("-",50),"\n\n",I(e,t),"\n\n",(i=t.expected,1===i.length?"Expected:\n\n"+i[0]:"Expected one of the following: \n\n"+i.join(", ")),"\n"].join("");var i}function M(e){return void 0!==e.flags?e.flags:[e.global?"g":"",e.ignoreCase?"i":"",e.multiline?"m":"",e.unicode?"u":"",e.sticky?"y":""].join("")}function R(){for(var e=[].slice.call(arguments),t=e.length,i=0;i<t;i+=1)x(e[i]);return s((function(i,s){for(var n,u=new Array(t),r=0;r<t;r+=1){if(!(n=v(e[r]._(i,s),n)).status)return n;u[r]=n.value,s=n.index}return v(y(s,u),n)}))}function P(){var e=[].slice.call(arguments);if(0===e.length)throw new Error("seqMap needs at least one argument");var t=e.pop();return O(t),R.apply(null,e).map((function(e){return t.apply(null,e)}))}function V(){var e=[].slice.call(arguments),t=e.length;if(0===t)return U("zero alternates");for(var i=0;i<t;i+=1)x(e[i]);return s((function(t,i){for(var s,n=0;n<e.length;n+=1)if((s=v(e[n]._(t,i),s)).status)return s;return s}))}function H(e,t){return j(e,t).or(Y([]))}function j(e,t){return x(e),x(t),P(e,t.then(e).many(),(function(e,t){return[e].concat(t)}))}function W(e){N(e);var t="'"+e+"'";return s((function(i,s){var n=s+e.length,u=i.slice(s,n);return u===e?y(n,u):w(s,t)}))}function G(e,t){!function(e){if(!(e instanceof RegExp))throw new Error("not a regexp: "+e);for(var t=M(e),i=0;i<t.length;i++){var s=t.charAt(i);if("i"!==s&&"m"!==s&&"u"!==s&&"s"!==s)throw new Error('unsupported regexp flag "'+s+'": '+e)}}(e),arguments.length>=2?A(t):t=0;var i=function(e){return RegExp("^(?:"+e.source+")",M(e))}(e),n=""+e;return s((function(e,s){var u=i.exec(e.slice(s));if(u){if(0<=t&&t<=u.length){var r=u[0],a=u[t];return y(s+r.length,a)}return w(s,"valid match group (0 to "+u.length+") in "+n)}return w(s,n)}))}function Y(e){return s((function(t,i){return y(i,e)}))}function U(e){return s((function(t,i){return w(i,e)}))}function z(e){if(E(e))return s((function(t,i){var s=e._(t,i);return s.index=i,s.value="",s}));if("string"==typeof e)return z(W(e));if(e instanceof RegExp)return z(G(e));throw new Error("not a string, regexp, or parser: "+e)}function q(e){return x(e),s((function(t,i){var s=e._(t,i),n=t.slice(i,s.index);return s.status?w(i,'not "'+n+'"'):y(i,null)}))}function $(e){return O(e),s((function(t,i){var s=T(t,i);return i<t.length&&e(s)?y(i+1,s):w(i,"a character/byte matching "+e)}))}function Z(e,t){arguments.length<2&&(t=e,e=void 0);var i=s((function(e,s){return i._=t()._,i._(e,s)}));return e?i.desc(e):i}function X(){return U("fantasy-land/empty")}n.parse=function(e){if("string"!=typeof e&&!C(e))throw new Error(".parse must be called with a string or Buffer as its argument");var t,i=this.skip(ee)._(e,0);return t=i.status?{status:!0,value:i.value}:{status:!1,index:b(e,i.furthest),expected:i.expected},delete S[e],t},n.tryParse=function(e){var t=this.parse(e);if(t.status)return t.value;var i=_(e,t),s=new Error(i);throw s.type="ParsimmonError",s.result=t,s},n.assert=function(e,t){return this.chain((function(i){return e(i)?Y(i):U(t)}))},n.or=function(e){return V(this,e)},n.trim=function(e){return this.wrap(e,e)},n.wrap=function(e,t){return P(e,this,t,(function(e,t){return t}))},n.thru=function(e){return e(this)},n.then=function(e){return x(e),R(this,e).map((function(e){return e[1]}))},n.many=function(){var e=this;return s((function(t,i){for(var s=[],n=void 0;;){if(!(n=v(e._(t,i),n)).status)return v(y(i,s),n);if(i===n.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");i=n.index,s.push(n.value)}}))},n.tieWith=function(e){return N(e),this.map((function(t){if(function(e){if(!m(e))throw new Error("not an array: "+e)}(t),t.length){N(t[0]);for(var i=t[0],s=1;s<t.length;s++)N(t[s]),i+=e+t[s];return i}return""}))},n.tie=function(){return this.tieWith("")},n.times=function(e,t){var i=this;return arguments.length<2&&(t=e),A(e),A(t),s((function(s,n){for(var u=[],r=void 0,a=void 0,o=0;o<e;o+=1){if(a=v(r=i._(s,n),a),!r.status)return a;n=r.index,u.push(r.value)}for(;o<t&&(a=v(r=i._(s,n),a),r.status);o+=1)n=r.index,u.push(r.value);return v(y(n,u),a)}))},n.result=function(e){return this.map((function(){return e}))},n.atMost=function(e){return this.times(0,e)},n.atLeast=function(e){return P(this.times(e),this.many(),(function(e,t){return e.concat(t)}))},n.map=function(e){O(e);var t=this;return s((function(i,s){var n=t._(i,s);return n.status?v(y(n.index,e(n.value)),n):n}))},n.contramap=function(e){O(e);var t=this;return s((function(i,s){var n=t.parse(e(i.slice(s)));return n.status?y(s+i.length,n.value):n}))},n.promap=function(e,t){return O(e),O(t),this.contramap(e).map(t)},n.skip=function(e){return R(this,e).map((function(e){return e[0]}))},n.mark=function(){return P(J,this,J,(function(e,t,i){return{start:e,value:t,end:i}}))},n.node=function(e){return P(J,this,J,(function(t,i,s){return{name:e,value:i,start:t,end:s}}))},n.sepBy=function(e){return H(this,e)},n.sepBy1=function(e){return j(this,e)},n.lookahead=function(e){return this.skip(z(e))},n.notFollowedBy=function(e){return this.skip(q(e))},n.desc=function(e){m(e)||(e=[e]);var t=this;return s((function(i,s){var n=t._(i,s);return n.status||(n.expected=e),n}))},n.fallback=function(e){return this.or(Y(e))},n.ap=function(e){return P(e,this,(function(e,t){return e(t)}))},n.chain=function(e){var t=this;return s((function(i,s){var n=t._(i,s);return n.status?v(e(n.value)._(i,n.index),n):n}))},n.concat=n.or,n.empty=X,n.of=Y,n["fantasy-land/ap"]=n.ap,n["fantasy-land/chain"]=n.chain,n["fantasy-land/concat"]=n.concat,n["fantasy-land/empty"]=n.empty,n["fantasy-land/of"]=n.of,n["fantasy-land/map"]=n.map;var J=s((function(e,t){return y(t,b(e,t))})),K=s((function(e,t){return t>=e.length?w(t,"any character/byte"):y(t+1,T(e,t))})),Q=s((function(e,t){return y(e.length,e.slice(t))})),ee=s((function(e,t){return t<e.length?w(t,"EOF"):y(t,null)})),te=G(/[0-9]/).desc("a digit"),ie=G(/[0-9]*/).desc("optional digits"),se=G(/[a-z]/i).desc("a letter"),ne=G(/[a-z]*/i).desc("optional letters"),ue=G(/\s*/).desc("optional whitespace"),re=G(/\s+/).desc("whitespace"),ae=W("\r"),oe=W("\n"),le=W("\r\n"),De=V(le,oe,ae).desc("newline"),he=V(De,ee);s.all=Q,s.alt=V,s.any=K,s.cr=ae,s.createLanguage=function(e){var t={};for(var i in e)({}).hasOwnProperty.call(e,i)&&function(i){t[i]=Z((function(){return e[i](t)}))}(i);return t},s.crlf=le,s.custom=function(e){return s(e(y,w))},s.digit=te,s.digits=ie,s.empty=X,s.end=he,s.eof=ee,s.fail=U,s.formatError=_,s.index=J,s.isParser=E,s.lazy=Z,s.letter=se,s.letters=ne,s.lf=oe,s.lookahead=z,s.makeFailure=w,s.makeSuccess=y,s.newline=De,s.noneOf=function(e){return $((function(t){return e.indexOf(t)<0})).desc("none of '"+e+"'")},s.notFollowedBy=q,s.of=Y,s.oneOf=function(e){for(var t=e.split(""),i=0;i<t.length;i++)t[i]="'"+t[i]+"'";return $((function(t){return e.indexOf(t)>=0})).desc(t)},s.optWhitespace=ue,s.Parser=s,s.range=function(e,t){return $((function(i){return e<=i&&i<=t})).desc(e+"-"+t)},s.regex=G,s.regexp=G,s.sepBy=H,s.sepBy1=j,s.seq=R,s.seqMap=P,s.seqObj=function(){for(var e,t={},i=0,n=(e=arguments,Array.prototype.slice.call(e)),u=n.length,r=0;r<u;r+=1){var a=n[r];if(!E(a)){if(m(a)&&2===a.length&&"string"==typeof a[0]&&E(a[1])){var o=a[0];if(Object.prototype.hasOwnProperty.call(t,o))throw new Error("seqObj: duplicate key "+o);t[o]=!0,i++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===i)throw new Error("seqObj expects at least one named parser, found zero");return s((function(e,t){for(var i,s={},r=0;r<u;r+=1){var a,o;if(m(n[r])?(a=n[r][0],o=n[r][1]):(a=null,o=n[r]),!(i=v(o._(e,t),i)).status)return i;a&&(s[a]=i.value),t=i.index}return v(y(t,s),i)}))},s.string=W,s.succeed=Y,s.takeWhile=function(e){return O(e),s((function(t,i){for(var s=i;s<t.length&&e(T(t,s));)s++;return y(s,t.slice(i,s))}))},s.test=$,s.whitespace=re,s["fantasy-land/empty"]=X,s["fantasy-land/of"]=Y,s.Binary={bitSeq:h,bitSeqObj:function(e){D();var t={},i=0,s=a((function(e){if(m(e)){var s=e;if(2!==s.length)throw new Error("["+s.join(", ")+"] should be length 2, got length "+s.length);if(N(s[0]),A(s[1]),Object.prototype.hasOwnProperty.call(t,s[0]))throw new Error("duplicate key in bitSeqObj: "+s[0]);return t[s[0]]=!0,i++,s}return A(e),[null,e]}),e);if(i<1)throw new Error("bitSeqObj expects at least one named pair, got ["+e.join(", ")+"]");var n=a((function(e){return e[0]}),s);return h(a((function(e){return e[1]}),s)).map((function(e){return r((function(e,t){return null!==t[0]&&(e[t[0]]=t[1]),e}),{},a((function(t,i){return[t,e[i]]}),n))}))},byte:function(e){if(D(),A(e),e>255)throw new Error("Value specified to byte constructor ("+e+"=0x"+e.toString(16)+") is larger in value than a single byte.");var t=(e>15?"0x":"0x0")+e.toString(16);return s((function(i,s){var n=T(i,s);return n===e?y(s+1,n):w(s,t)}))},buffer:function(e){return d("buffer",e).map((function(e){return Buffer.from(e)}))},encodedString:function(e,t){return d("string",t).map((function(t){return t.toString(e)}))},uintBE:g,uint8BE:g(1),uint16BE:g(2),uint32BE:g(4),uintLE:p,uint8LE:p(1),uint16LE:p(2),uint32LE:p(4),intBE:F,int8BE:F(1),int16BE:F(2),int32BE:F(4),intLE:f,int8LE:f(1),int16LE:f(2),int32LE:f(4),floatBE:d("floatBE",4).map((function(e){return e.readFloatBE(0)})),floatLE:d("floatLE",4).map((function(e){return e.readFloatLE(0)})),doubleBE:d("doubleBE",8).map((function(e){return e.readDoubleBE(0)})),doubleLE:d("doubleLE",8).map((function(e){return e.readDoubleLE(0)}))},e.exports=s}]),js.exports.alt(js.exports.regex(new RegExp(/(?:[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDD-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF6](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC2\uDED0-\uDED9\uDEE0-\uDEE7]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?))/g,"")),js.exports.regex(/[0-9\p{Letter}_-]+/u).map((e=>e.toLocaleLowerCase())),js.exports.whitespace.map((e=>"-")),js.exports.any.map((e=>""))).many().map((e=>e.join("")));const Ys=js.exports.alt(js.exports.regex(new RegExp(/(?:[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDD-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF6](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC2\uDED0-\uDED9\uDEE0-\uDEE7]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?))/g,"")),js.exports.regex(/[0-9\p{Letter}_-]+/u),js.exports.whitespace.map((e=>" ")),js.exports.any.map((e=>" "))).many().map((e=>e.join("").split(/\s+/).join(" ").trim()));function Us(e){return Ys.tryParse(e)}var zs,qs,$s,Zs,Xs;!function(e){function t(e){return r(e)?{type:"null",value:e}:s(e)?{type:"number",value:e}:i(e)?{type:"string",value:e}:o(e)?{type:"boolean",value:e}:u(e)?{type:"duration",value:e}:n(e)?{type:"date",value:e}:D(e)?{type:"widget",value:e}:a(e)?{type:"array",value:e}:l(e)?{type:"link",value:e}:c(e)?{type:"function",value:e}:h(e)?{type:"html",value:e}:d(e)?{type:"object",value:e}:void 0}function i(e){return"string"==typeof e}function s(e){return"number"==typeof e}function n(e){return e instanceof _s}function u(e){return e instanceof ki}function r(e){return null==e}function a(e){return Array.isArray(e)}function o(e){return"boolean"==typeof e}function l(e){return e instanceof Js}function D(e){return e instanceof Ks}function h(e){return"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function d(e){return!("object"!=typeof e||h(e)||D(e)||a(e)||u(e)||n(e)||l(e)||void 0===e||r(e))}function c(e){return"function"==typeof e}e.toString=function e(i,s=Rs,n=!1){let u=t(i);if(!u)return s.renderNullAs;switch(u.type){case"null":return s.renderNullAs;case"string":return u.value;case"number":case"boolean":return""+u.value;case"html":return u.value.outerHTML;case"widget":case"link":return u.value.markdown();case"function":return"<function>";case"array":let t="";return n&&(t+="["),t+=u.value.map((t=>e(t,s,!0))).join(", "),n&&(t+="]"),t;case"object":return"{ "+Object.entries(u.value).map((t=>t[0]+": "+e(t[1],s,!0))).join(", ")+" }";case"date":return 0==u.value.second&&0==u.value.hour&&0==u.value.minute?u.value.toFormat(s.defaultDateFormat):u.value.toFormat(s.defaultDateTimeFormat);case"duration":return r=Ws(r=u.value),(r=ki.fromObject(Object.fromEntries(Object.entries(r.toObject()).filter((([,e])=>e>0))))).toHuman()}var r},e.wrapValue=t,e.mapLeaves=function e(t,i){if(d(t)){let s={};for(let[n,u]of Object.entries(t))s[n]=e(u,i);return s}if(a(t)){let s=[];for(let n of t)s.push(e(n,i));return s}return i(t)},e.compareValue=function e(i,s,n){var u,r;if(void 0===i&&(i=null),void 0===s&&(s=null),null===i&&null===s)return 0;if(null===i)return-1;if(null===s)return 1;let a=t(i),o=t(s);if(void 0===a&&void 0===o)return 0;if(void 0===a)return-1;if(void 0===o)return 1;if(a.type!=o.type)return a.type.localeCompare(o.type);if(a.value===o.value)return 0;switch(a.type){case"string":return a.value.localeCompare(o.value);case"number":return a.value<o.value?-1:a.value==o.value?0:1;case"null":case"widget":case"html":case"function":return 0;case"boolean":return a.value==o.value?0:a.value?1:-1;case"link":let t=a.value,i=o.value,s=null!=n?n:e=>e,l=s(t.path).localeCompare(s(i.path));if(0!=l)return l;let D=t.type.localeCompare(i.type);return 0!=D?D:t.subpath&&!i.subpath?1:!t.subpath&&i.subpath?-1:t.subpath||i.subpath?(null!==(u=t.subpath)&&void 0!==u?u:"").localeCompare(null!==(r=i.subpath)&&void 0!==r?r:""):0;case"date":case"duration":return a.value<o.value?-1:a.value.equals(o.value)?0:1;case"array":let h=a.value,d=o.value;for(let t=0;t<Math.min(h.length,d.length);t++){let i=e(h[t],d[t]);if(0!=i)return i}return h.length-d.length;case"object":let c=a.value,g=o.value,p=Array.from(Object.keys(c)),F=Array.from(Object.keys(g));p.sort(),F.sort();let f=e(p,F);if(0!=f)return f;for(let t of p){let i=e(c[t],g[t]);if(0!=i)return i}return 0}},e.typeOf=function(e){var i;return null===(i=t(e))||void 0===i?void 0:i.type},e.isTruthy=function(e){let i=t(e);if(!i)return!1;switch(i.type){case"number":return 0!=i.value;case"string":case"array":return i.value.length>0;case"boolean":return i.value;case"link":return!!i.value.path;case"date":return 0!=i.value.toMillis();case"duration":return 0!=i.value.as("seconds");case"object":return Object.keys(i.value).length>0;case"null":return!1;case"html":case"widget":case"function":return!0}},e.deepCopy=function t(i){if(null==i)return i;if(e.isArray(i))return[].concat(i.map((e=>t(e))));if(e.isObject(i)){let e={};for(let[s,n]of Object.entries(i))e[s]=t(n);return e}return i},e.isString=i,e.isNumber=s,e.isDate=n,e.isDuration=u,e.isNull=r,e.isArray=a,e.isBoolean=o,e.isLink=l,e.isWidget=D,e.isHtml=h,e.isObject=d,e.isFunction=c}(zs||(zs={})),function(e){function t(e){return zs.isObject(e)&&2==Object.keys(e).length&&"key"in e&&"rows"in e}function i(e){for(let i of e)if(!t(i))return!1;return!0}e.isElementGroup=t,e.isGrouping=i,e.count=function e(t){if(i(t)){let i=0;for(let s of t)i+=e(s.rows);return i}return t.length}}(qs||(qs={}));class Js{constructor(e){Object.assign(this,e)}static file(e,t=!1,i){return new Js({path:e,embed:t,display:i,subpath:void 0,type:"file"})}static infer(e,t=!1,i){if(e.includes("#^")){let s=e.split("#^");return Js.block(s[0],s[1],t,i)}if(e.includes("#")){let s=e.split("#");return Js.header(s[0],s[1],t,i)}return Js.file(e,t,i)}static header(e,t,i,s){return new Js({path:e,embed:i,display:s,subpath:Us(t),type:"header"})}static block(e,t,i,s){return new Js({path:e,embed:i,display:s,subpath:t,type:"block"})}static fromObject(e){return new Js(e)}equals(e){return null!=e&&null!=e&&this.path==e.path&&this.type==e.type&&this.subpath==e.subpath}toString(){return this.markdown()}toObject(){return{path:this.path,type:this.type,subpath:this.subpath,display:this.display,embed:this.embed}}withPath(e){return new Js(Object.assign({},this,{path:e}))}withDisplay(e){return new Js(Object.assign({},this,{display:e}))}withHeader(e){return Js.header(this.path,e,this.embed,this.display)}toFile(){return Js.file(this.path,this.embed,this.display)}toEmbed(){if(this.embed)return this;{let e=new Js(this);return e.embed=!0,e}}fromEmbed(){if(this.embed){let e=new Js(this);return e.embed=!1,e}return this}markdown(){let e=(this.embed?"!":"")+"[["+this.obsidianLink();return this.display?e+="|"+this.display:(e+="|"+Gs(this.path),"header"!=this.type&&"block"!=this.type||(e+=" > "+this.subpath)),e+="]]",e}obsidianLink(){var e,t;const i=this.path.replace("|","\\|");return"header"==this.type?i+"#"+(null===(e=this.subpath)||void 0===e?void 0:e.replace("|","\\|")):"block"==this.type?i+"#^"+(null===(t=this.subpath)||void 0===t?void 0:t.replace("|","\\|")):i}fileName(){return Gs(this.path).replace(".md","")}}class Ks{constructor(e){this.$widget=e}}class Qs extends Ks{constructor(e,t){super("dataview:list-pair"),this.key=e,this.value=t}markdown(){return`${zs.toString(this.key)}: ${zs.toString(this.value)}`}}class en extends Ks{constructor(e,t){super("dataview:external-link"),this.url=e,this.display=t}markdown(){var e;return`[${null!==(e=this.display)&&void 0!==e?e:this.url}](${this.url})`}}!function(e){function t(e){return"dataview:list-pair"===e.$widget}function i(e){return"dataview:external-link"===e.$widget}e.listPair=function(e,t){return new Qs(e,t)},e.externalLink=function(e,t){return new en(e,t)},e.isListPair=t,e.isExternalLink=i,e.isBuiltin=function(e){return t(e)||i(e)}}($s||($s={})),function(e){e.variable=function(e){return{type:"variable",name:e}},e.literal=function(e){return{type:"literal",value:e}},e.binaryOp=function(e,t,i){return{type:"binaryop",left:e,op:t,right:i}},e.index=function(e,t){return{type:"index",object:e,index:t}},e.indexVariable=function(t){let i=t.split("."),s=e.variable(i[0]);for(let t=1;t<i.length;t++)s=e.index(s,e.literal(i[t]));return s},e.lambda=function(e,t){return{type:"lambda",arguments:e,value:t}},e.func=function(e,t){return{type:"function",func:e,arguments:t}},e.list=function(e){return{type:"list",values:e}},e.object=function(e){return{type:"object",values:e}},e.negate=function(e){return{type:"negated",child:e}},e.isCompareOp=function(e){return"<="==e||"<"==e||">"==e||">="==e||"!="==e||"="==e},e.NULL=e.literal(null)}(Zs||(Zs={})),function(e){e.tag=function(e){return{type:"tag",tag:e}},e.csv=function(e){return{type:"csv",path:e}},e.folder=function(e){return{type:"folder",folder:e}},e.link=function(e,t){return{type:"link",file:e,direction:t?"incoming":"outgoing"}},e.binaryOp=function(e,t,i){return{type:"binaryop",left:e,op:t,right:i}},e.and=function(e,t){return{type:"binaryop",left:e,op:"&",right:t}},e.or=function(e,t){return{type:"binaryop",left:e,op:"|",right:t}},e.negate=function(e){return{type:"negate",child:e}},e.empty=function(){return{type:"empty"}}}(Xs||(Xs={}));const tn=new RegExp(/(?:[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDD-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF6](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC2\uDED0-\uDED9\uDEE0-\uDEE7]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?))/g,""),sn={year:ki.fromObject({years:1}),years:ki.fromObject({years:1}),yr:ki.fromObject({years:1}),yrs:ki.fromObject({years:1}),month:ki.fromObject({months:1}),months:ki.fromObject({months:1}),mo:ki.fromObject({months:1}),mos:ki.fromObject({months:1}),week:ki.fromObject({weeks:1}),weeks:ki.fromObject({weeks:1}),wk:ki.fromObject({weeks:1}),wks:ki.fromObject({weeks:1}),w:ki.fromObject({weeks:1}),day:ki.fromObject({days:1}),days:ki.fromObject({days:1}),d:ki.fromObject({days:1}),hour:ki.fromObject({hours:1}),hours:ki.fromObject({hours:1}),hr:ki.fromObject({hours:1}),hrs:ki.fromObject({hours:1}),h:ki.fromObject({hours:1}),minute:ki.fromObject({minutes:1}),minutes:ki.fromObject({minutes:1}),min:ki.fromObject({minutes:1}),mins:ki.fromObject({minutes:1}),m:ki.fromObject({minutes:1}),second:ki.fromObject({seconds:1}),seconds:ki.fromObject({seconds:1}),sec:ki.fromObject({seconds:1}),secs:ki.fromObject({seconds:1}),s:ki.fromObject({seconds:1})},nn={now:()=>_s.local(),today:()=>_s.local().startOf("day"),yesterday:()=>_s.local().startOf("day").minus(ki.fromObject({days:1})),tomorrow:()=>_s.local().startOf("day").plus(ki.fromObject({days:1})),sow:()=>_s.local().startOf("week"),"start-of-week":()=>_s.local().startOf("week"),eow:()=>_s.local().endOf("week"),"end-of-week":()=>_s.local().endOf("week"),soy:()=>_s.local().startOf("year"),"start-of-year":()=>_s.local().startOf("year"),eoy:()=>_s.local().endOf("year"),"end-of-year":()=>_s.local().endOf("year"),som:()=>_s.local().startOf("month"),"start-of-month":()=>_s.local().startOf("month"),eom:()=>_s.local().endOf("month"),"end-of-month":()=>_s.local().endOf("month")},un=["FROM","WHERE","LIMIT","GROUP","FLATTEN"];function rn(e,t,i){return js.exports.seqMap(e,js.exports.seq(js.exports.optWhitespace,t,js.exports.optWhitespace,e).many(),((e,t)=>{if(0==t.length)return e;let s=i(e,t[0][1],t[0][3]);for(let e=1;e<t.length;e++)s=i(s,t[e][1],t[e][3]);return s}))}const an=js.exports.createLanguage({number:e=>js.exports.regexp(/-?[0-9]+(\.[0-9]+)?/).map((e=>Number.parseFloat(e))).desc("number"),string:e=>js.exports.string('"').then(js.exports.alt(e.escapeCharacter,js.exports.noneOf('"\\')).atLeast(0).map((e=>e.join("")))).skip(js.exports.string('"')).desc("string"),escapeCharacter:e=>js.exports.string("\\").then(js.exports.any).map((e=>'"'===e?'"':"\\"===e?"\\":"\\"+e)),bool:e=>js.exports.regexp(/true|false|True|False/).map((e=>"true"==e.toLowerCase())).desc("boolean ('true' or 'false')"),tag:e=>js.exports.seqMap(js.exports.string("#"),js.exports.alt(js.exports.regexp(/[^\u2000-\u206F\u2E00-\u2E7F'!"#$%&()*+,.:;<=>?@^`{|}~\[\]\\\s]/).desc("text")).many(),((e,t)=>e+t.join(""))).desc("tag ('#hello/stuff')"),identifier:e=>js.exports.seqMap(js.exports.alt(js.exports.regexp(/\p{Letter}/u),js.exports.regexp(tn).desc("text")),js.exports.alt(js.exports.regexp(/[0-9\p{Letter}_-]/u),js.exports.regexp(tn).desc("text")).many(),((e,t)=>e+t.join(""))).desc("variable identifier"),link:e=>js.exports.regexp(/\[\[([^\[\]]*?)\]\]/u,1).map((e=>function(e){let[t,i]=function(e){let t=-1;for(;(t=e.indexOf("|",t+1))>=0;)if(!(t>0&&"\\"==e[t-1]))return[e.substring(0,t).replace(/\\\|/g,"|"),e.substring(t+1)];return[e.replace(/\\\|/g,"|"),void 0]}(e);return Js.infer(t,!1,i)}(e))).desc("file link"),embedLink:e=>js.exports.seqMap(js.exports.string("!").atMost(1),e.link,((e,t)=>(e.length>0&&(t.embed=!0),t))).desc("file link"),binaryPlusMinus:e=>js.exports.regexp(/\+|-/).map((e=>e)).desc("'+' or '-'"),binaryMulDiv:e=>js.exports.regexp(/\*|\/|%/).map((e=>e)).desc("'*' or '/' or '%'"),binaryCompareOp:e=>js.exports.regexp(/>=|<=|!=|>|<|=/).map((e=>e)).desc("'>=' or '<=' or '!=' or '=' or '>' or '<'"),binaryBooleanOp:e=>js.exports.regexp(/and|or|&|\|/i).map((e=>"and"==e.toLowerCase()?"&":"or"==e.toLowerCase()?"|":e)).desc("'and' or 'or'"),rootDate:e=>js.exports.seqMap(js.exports.regexp(/\d{4}/),js.exports.string("-"),js.exports.regexp(/\d{2}/),((e,t,i)=>_s.fromObject({year:Number.parseInt(e),month:Number.parseInt(i)}))).desc("date in format YYYY-MM[-DDTHH-MM-SS.MS]"),dateShorthand:e=>js.exports.alt(...Object.keys(nn).sort(((e,t)=>t.length-e.length)).map(js.exports.string)),date:e=>function(e,...t){return js.exports.custom(((i,s)=>(i,s)=>{let n=e._(i,s);if(!n.status)return n;for(let e of t){let t=e(n.value)._(i,n.index);if(!t.status)return n;n=t}return n}))}(e.rootDate,(e=>js.exports.seqMap(js.exports.string("-"),js.exports.regexp(/\d{2}/),((t,i)=>e.set({day:Number.parseInt(i)})))),(e=>js.exports.seqMap(js.exports.string("T"),js.exports.regexp(/\d{2}/),((t,i)=>e.set({hour:Number.parseInt(i)})))),(e=>js.exports.seqMap(js.exports.string(":"),js.exports.regexp(/\d{2}/),((t,i)=>e.set({minute:Number.parseInt(i)})))),(e=>js.exports.seqMap(js.exports.string(":"),js.exports.regexp(/\d{2}/),((t,i)=>e.set({second:Number.parseInt(i)})))),(e=>js.exports.alt(js.exports.seqMap(js.exports.string("."),js.exports.regexp(/\d{3}/),((t,i)=>e.set({millisecond:Number.parseInt(i)}))),js.exports.succeed(e))),(e=>js.exports.alt(js.exports.seqMap(js.exports.string("+").or(js.exports.string("-")),js.exports.regexp(/\d{1,2}(:\d{2})?/),((t,i)=>e.setZone("UTC"+t+i,{keepLocalTime:!0}))),js.exports.seqMap(js.exports.string("Z"),(()=>e.setZone("utc",{keepLocalTime:!0}))),js.exports.seqMap(js.exports.string("["),js.exports.regexp(/[0-9A-Za-z+-\/]+/u),js.exports.string("]"),((t,i,s)=>e.setZone(i,{keepLocalTime:!0})))))).assert((e=>e.isValid),"valid date").desc("date in format YYYY-MM[-DDTHH-MM-SS.MS]"),datePlus:e=>js.exports.alt(e.dateShorthand.map((e=>nn[e]())),e.date).desc("date in format YYYY-MM[-DDTHH-MM-SS.MS] or in shorthand"),durationType:e=>js.exports.alt(...Object.keys(sn).sort(((e,t)=>t.length-e.length)).map(js.exports.string)),duration:e=>js.exports.seqMap(e.number,js.exports.optWhitespace,e.durationType,((e,t,i)=>sn[i].mapUnits((t=>t*e)))).sepBy1(js.exports.string(",").trim(js.exports.optWhitespace).or(js.exports.optWhitespace)).map((e=>e.reduce(((e,t)=>e.plus(t))))).desc("duration like 4hr2min"),rawNull:e=>js.exports.string("null"),tagSource:e=>e.tag.map((e=>Xs.tag(e))),csvSource:e=>js.exports.seqMap(js.exports.string("csv(").skip(js.exports.optWhitespace),e.string,js.exports.string(")"),((e,t,i)=>Xs.csv(t))),linkIncomingSource:e=>e.link.map((e=>Xs.link(e.path,!0))),linkOutgoingSource:e=>js.exports.seqMap(js.exports.string("outgoing(").skip(js.exports.optWhitespace),e.link,js.exports.string(")"),((e,t,i)=>Xs.link(t.path,!1))),folderSource:e=>e.string.map((e=>Xs.folder(e))),parensSource:e=>js.exports.seqMap(js.exports.string("("),js.exports.optWhitespace,e.source,js.exports.optWhitespace,js.exports.string(")"),((e,t,i,s,n)=>i)),negateSource:e=>js.exports.seqMap(js.exports.alt(js.exports.string("-"),js.exports.string("!")),e.atomSource,((e,t)=>Xs.negate(t))),atomSource:e=>js.exports.alt(e.parensSource,e.negateSource,e.linkOutgoingSource,e.linkIncomingSource,e.folderSource,e.tagSource,e.csvSource),binaryOpSource:e=>rn(e.atomSource,e.binaryBooleanOp.map((e=>e)),Xs.binaryOp),source:e=>e.binaryOpSource,variableField:e=>e.identifier.chain((e=>un.includes(e.toUpperCase())?js.exports.fail("Variable fields cannot be a keyword ("+un.join(" or ")+")"):js.exports.succeed(Zs.variable(e)))).desc("variable"),numberField:e=>e.number.map((e=>Zs.literal(e))).desc("number"),stringField:e=>e.string.map((e=>Zs.literal(e))).desc("string"),boolField:e=>e.bool.map((e=>Zs.literal(e))).desc("boolean"),dateField:e=>js.exports.seqMap(js.exports.string("date("),js.exports.optWhitespace,e.datePlus,js.exports.optWhitespace,js.exports.string(")"),((e,t,i,s,n)=>Zs.literal(i))).desc("date"),durationField:e=>js.exports.seqMap(js.exports.string("dur("),js.exports.optWhitespace,e.duration,js.exports.optWhitespace,js.exports.string(")"),((e,t,i,s,n)=>Zs.literal(i))).desc("duration"),nullField:e=>e.rawNull.map((e=>Zs.NULL)),linkField:e=>e.link.map((e=>Zs.literal(e))),listField:e=>e.field.sepBy(js.exports.string(",").trim(js.exports.optWhitespace)).wrap(js.exports.string("[").skip(js.exports.optWhitespace),js.exports.optWhitespace.then(js.exports.string("]"))).map((e=>Zs.list(e))).desc("list ('[1, 2, 3]')"),objectField:e=>js.exports.seqMap(e.identifier.or(e.string),js.exports.string(":").trim(js.exports.optWhitespace),e.field,((e,t,i)=>({name:e,value:i}))).sepBy(js.exports.string(",").trim(js.exports.optWhitespace)).wrap(js.exports.string("{").skip(js.exports.optWhitespace),js.exports.optWhitespace.then(js.exports.string("}"))).map((e=>{let t={};for(let i of e)t[i.name]=i.value;return Zs.object(t)})).desc("object ('{ a: 1, b: 2 }')"),atomInlineField:e=>js.exports.alt(e.date,e.duration.map((e=>Ws(e))),e.string,e.tag,e.embedLink,e.bool,e.number,e.rawNull),inlineFieldList:e=>e.atomInlineField.sepBy(js.exports.string(",").trim(js.exports.optWhitespace).lookahead(e.atomInlineField)),inlineField:e=>js.exports.alt(js.exports.seqMap(e.atomInlineField,js.exports.string(",").trim(js.exports.optWhitespace),e.inlineFieldList,((e,t,i)=>[e].concat(i))),e.atomInlineField),atomField:e=>js.exports.alt(e.embedLink.map((e=>Zs.literal(e))),e.negatedField,e.linkField,e.listField,e.objectField,e.lambdaField,e.parensField,e.boolField,e.numberField,e.stringField,e.dateField,e.durationField,e.nullField,e.variableField),indexField:e=>js.exports.seqMap(e.atomField,js.exports.alt(e.dotPostfix,e.indexPostfix,e.functionPostfix).many(),((e,t)=>{let i=e;for(let e of t)switch(e.type){case"dot":i=Zs.index(i,Zs.literal(e.field));break;case"index":i=Zs.index(i,e.field);break;case"function":i=Zs.func(i,e.fields)}return i})),negatedField:e=>js.exports.seqMap(js.exports.string("!"),e.indexField,((e,t)=>Zs.negate(t))).desc("negated field"),parensField:e=>js.exports.seqMap(js.exports.string("("),js.exports.optWhitespace,e.field,js.exports.optWhitespace,js.exports.string(")"),((e,t,i,s,n)=>i)),lambdaField:e=>js.exports.seqMap(e.identifier.sepBy(js.exports.string(",").trim(js.exports.optWhitespace)).wrap(js.exports.string("(").trim(js.exports.optWhitespace),js.exports.string(")").trim(js.exports.optWhitespace)),js.exports.string("=>").trim(js.exports.optWhitespace),e.field,((e,t,i)=>({type:"lambda",arguments:e,value:i}))),dotPostfix:e=>js.exports.seqMap(js.exports.string("."),e.identifier,((e,t)=>({type:"dot",field:t}))),indexPostfix:e=>js.exports.seqMap(js.exports.string("["),js.exports.optWhitespace,e.field,js.exports.optWhitespace,js.exports.string("]"),((e,t,i,s,n)=>({type:"index",field:i}))),functionPostfix:e=>js.exports.seqMap(js.exports.string("("),js.exports.optWhitespace,e.field.sepBy(js.exports.string(",").trim(js.exports.optWhitespace)),js.exports.optWhitespace,js.exports.string(")"),((e,t,i,s,n)=>({type:"function",fields:i}))),binaryMulDivField:e=>rn(e.indexField,e.binaryMulDiv,Zs.binaryOp),binaryPlusMinusField:e=>rn(e.binaryMulDivField,e.binaryPlusMinus,Zs.binaryOp),binaryCompareField:e=>rn(e.binaryPlusMinusField,e.binaryCompareOp,Zs.binaryOp),binaryBooleanField:e=>rn(e.binaryCompareField,e.binaryBooleanOp,Zs.binaryOp),binaryOpField:e=>e.binaryBooleanField,field:e=>e.binaryOpField});var on;!function(e){e.named=function(e,t){return{name:e,field:t}},e.sortBy=function(e,t){return{field:e,direction:t}}}(on||(on={}));const ln=js.exports.createLanguage({queryType:e=>js.exports.alt(js.exports.regexp(/TABLE|LIST|TASK|CALENDAR/i)).map((e=>e.toLowerCase())).desc("query type ('TABLE', 'LIST', 'TASK', or 'CALENDAR')"),explicitNamedField:e=>js.exports.seqMap(an.field.skip(js.exports.whitespace),js.exports.regexp(/AS/i).skip(js.exports.whitespace),an.identifier.or(an.string),((e,t,i)=>on.named(i,e))),namedField:e=>{return js.exports.alt(e.explicitNamedField,(t=an.field,js.exports.custom(((e,i)=>(e,i)=>{let s=t._(e,i);return s.status?Object.assign({},s,{value:[s.value,e.substring(i,s.index)]}):s}))).map((([e,t])=>on.named(function(e){return e.split(/[\r\n]+/).map((e=>e.trim())).join("")}(t),e))));var t},sortField:e=>js.exports.seqMap(an.field.skip(js.exports.optWhitespace),js.exports.regexp(/ASCENDING|DESCENDING|ASC|DESC/i).atMost(1),((e,t)=>{let i=0==t.length?"ascending":t[0].toLowerCase();return"desc"==i&&(i="descending"),"asc"==i&&(i="ascending"),{field:e,direction:i}})),headerClause:e=>e.queryType.skip(js.exports.whitespace).chain((t=>{switch(t){case"table":return js.exports.seqMap(js.exports.regexp(/WITHOUT\s+ID/i).skip(js.exports.optWhitespace).atMost(1),js.exports.sepBy(e.namedField,js.exports.string(",").trim(js.exports.optWhitespace)),((e,t)=>({type:"table",fields:t,showId:0==e.length})));case"list":return js.exports.seqMap(js.exports.regexp(/WITHOUT\s+ID/i).skip(js.exports.optWhitespace).atMost(1),an.field.atMost(1),((e,t)=>({type:"list",format:1==t.length?t[0]:void 0,showId:0==e.length})));case"task":return js.exports.succeed({type:"task"});case"calendar":return js.exports.seqMap(e.namedField,(e=>({type:"calendar",showId:!0,field:e})));default:return js.exports.fail(`Unrecognized query type '${t}'`)}})).desc("TABLE or LIST or TASK or CALENDAR"),fromClause:e=>js.exports.seqMap(js.exports.regexp(/FROM/i),js.exports.whitespace,an.source,((e,t,i)=>i)),whereClause:e=>js.exports.seqMap(js.exports.regexp(/WHERE/i),js.exports.whitespace,an.field,((e,t,i)=>({type:"where",clause:i}))).desc("WHERE <expression>"),sortByClause:e=>js.exports.seqMap(js.exports.regexp(/SORT/i),js.exports.whitespace,e.sortField.sepBy1(js.exports.string(",").trim(js.exports.optWhitespace)),((e,t,i)=>({type:"sort",fields:i}))).desc("SORT field [ASC/DESC]"),limitClause:e=>js.exports.seqMap(js.exports.regexp(/LIMIT/i),js.exports.whitespace,an.field,((e,t,i)=>({type:"limit",amount:i}))).desc("LIMIT <value>"),flattenClause:e=>js.exports.seqMap(js.exports.regexp(/FLATTEN/i).skip(js.exports.whitespace),e.namedField,((e,t)=>({type:"flatten",field:t}))).desc("FLATTEN <value> [AS <name>]"),groupByClause:e=>js.exports.seqMap(js.exports.regexp(/GROUP BY/i).skip(js.exports.whitespace),e.namedField,((e,t)=>({type:"group",field:t}))).desc("GROUP BY <value> [AS <name>]"),clause:e=>js.exports.alt(e.fromClause,e.whereClause,e.sortByClause,e.limitClause,e.groupByClause,e.flattenClause),query:e=>js.exports.seqMap(e.headerClause.trim(js.exports.optWhitespace),e.fromClause.trim(js.exports.optWhitespace).atMost(1),e.clause.trim(js.exports.optWhitespace).many(),((e,t,i)=>({header:e,source:0==t.length?Xs.folder(""):t[0],operations:i,settings:Rs})))});W.DATE_SHORTHANDS=nn,W.DURATION_TYPES=sn,W.EXPRESSION=an,W.KEYWORDS=un,W.QUERY_LANGUAGE=ln;var Dn=W.getAPI=e=>{var t;return e?null===(t=e.plugins.plugins.dataview)||void 0===t?void 0:t.api:window.DataviewAPI};W.isPluginEnabled=e=>e.plugins.enabledPlugins.has("dataview"),W.parseField=function(e){try{return Hs.success(an.field.tryParse(e))}catch(e){return Hs.failure(""+e)}};const hn=`---\n\nexcalidraw-plugin: parsed\nexcalidraw-default-mode: view\nexcalidraw-export-dark: false\nexcalidraw-export-transparent: false\nexcalidraw-linkbutton-opacity: 0.3\nexcalidraw-onload-script: "app.plugins.plugins[${String.fromCharCode(96)}excalibrain${String.fromCharCode(96)}].start(ea.targetView.leaf);"\n\ntags: [excalidraw]\n\n---\n\n# Text Elements\nOpen a document in another pane and click it to get started.\n\nFor the best experience enable 'Open in adjacent pane'\nin Excalidraw settings under 'Links and Transclusion'. ^4mylk7KK\n\n%%\n# Drawing\n${String.fromCharCode(96,96,96)}json\n{\n\t"type": "excalidraw",\n\t"version": 2,\n\t"source": "https://excalidraw.com",\n\t"elements": [\n\t\t{\n\t\t\t"type": "text",\n\t\t\t"version": 1,\n\t\t\t"versionNonce": 423577018,\n\t\t\t"isDeleted": false,\n\t\t\t"id": "4mylk7KK",\n\t\t\t"fillStyle": "hachure",\n\t\t\t"strokeWidth": 1,\n\t\t\t"strokeStyle": "solid",\n\t\t\t"roughness": 1,\n\t\t\t"opacity": 100,\n\t\t\t"angle": 0,\n\t\t\t"x": 0,\n\t\t\t"y": 0,\n\t\t\t"strokeColor": "white",\n\t\t\t"backgroundColor": "transparent",\n\t\t\t"width": 703,\n\t\t\t"height": 96,\n\t\t\t"seed": 4429,\n\t\t\t"groupIds": [],\n\t\t\t"strokeSharpness": "sharp",\n\t\t\t"boundElements": [],\n\t\t\t"updated": 1650784785611,\n\t\t\t"link": null,\n\t\t\t"locked": false,\n\t\t\t"fontSize": 20,\n\t\t\t"fontFamily": 3,\n\t\t\t"text": "Open a document in another pane and click it to get started.\\n\\nFor the best experience enable 'Open in adjacent pane'\\nin Excalidraw settings under 'Links and Transclusion'.",\n\t\t\t"rawText": "Open a document in another pane and click it to get started.\\n\\nFor the best experience enable 'Open in adjacent pane'\\nin Excalidraw settings under 'Links and Transclusion'.",\n\t\t\t"baseline": 91,\n\t\t\t"textAlign": "center",\n\t\t\t"verticalAlign": "top",\n\t\t\t"containerId": null,\n\t\t\t"originalText": "Open a document in another pane and click it to get started.\\n\\nFor the best experience enable 'Open in adjacent pane'\\nin Excalidraw settings under 'Links and Transclusion'."\n\t\t}\n\t],\n\t"appState": {\n\t\t"theme": "dark",\n\t\t"viewBackgroundColor": "hsl(208, 80%, 23%)",\n\t\t"currentItemStrokeColor": "#000000",\n\t\t"currentItemBackgroundColor": "transparent",\n\t\t"currentItemFillStyle": "hachure",\n\t\t"currentItemStrokeWidth": 2,\n\t\t"currentItemStrokeStyle": "solid",\n\t\t"currentItemRoughness": 1,\n\t\t"currentItemOpacity": 100,\n\t\t"currentItemFontFamily": 1,\n\t\t"currentItemFontSize": 16,\n\t\t"currentItemTextAlign": "left",\n\t\t"currentItemStrokeSharpness": "sharp",\n\t\t"currentItemStartArrowhead": null,\n\t\t"currentItemEndArrowhead": "arrow",\n\t\t"currentItemLinearStrokeSharpness": "round",\n\t\t"gridSize": null,\n\t\t"colorPalette": {}\n\t},\n\t"files": {}\n}\n${String.fromCharCode(96,96,96)}\n%%\n`;class dn{constructor(e){this.nodes=[],this.renderedNodes=[],this.spec=e}layout(e=this.spec.columns){const t=this.nodes.sort(((e,t)=>e.title.toLowerCase()<t.title.toLowerCase()?-1:1)),i=t.length;if(0===i)return;const s=Math.ceil(i/e);this.renderedNodes=Array(s).fill(null).map(((n,u)=>{return u+1<s||i%e==0?Array(e).fill(null).map(((i,s)=>t[u*e+s])):(r=i%e,e%2?(t=>{const i=[];let s=0;for(s=e/2;s>t[0];s--)i.push(null);for(s=0;s<t[0];s++)i.push(s+1);for(s=0;s<e/2;s++)i.push(s<t[1]?t[0]+s+1:null);return i})(r%2?[(r+1)/2,(r-1)/2]:[r/2,r/2]):(e=>{const t=[];let i=1,s=!0;return e.map((e=>Math.floor(e))).forEach((e=>{for(let n=0;n<e;n++)t.push(s?null:i++);s=!s})),t})(r%2?[(e-r)/2,r,(e-r)/2]:[(e-r)/2,r/2,1,r/2,(e-r)/2])).map((i=>i?t[u*e+i-1]:null));var r}))}render(){this.layout();const e=this.renderedNodes.length*this.spec.rowHeight,t=null===this.spec.top&&null===this.spec.bottom?this.spec.origoY-e/2:null!==this.spec.top?this.spec.origoY-e/2<this.spec.top?this.spec.top:this.spec.origoY-e/2:this.spec.origoY+e/2>this.spec.bottom?this.spec.bottom-e:this.spec.origoY-e/2,i=this.spec.origoX-(1===this.spec.columns?0:(this.spec.columns-1)/2*this.spec.columnWidth),s=t;this.renderedNodes.forEach(((e,t)=>e.forEach(((e,n)=>{e&&(e.setCenter({x:i+n*this.spec.columnWidth,y:s+t*this.spec.rowHeight}),e.render())}))))}}class cn{constructor(e){this.plugin=e,this.links=new Map,this.reverseLinks=new Set}addLink(e,s,n,u,r,a,o,l){const D=e.page.path+"|:?:|"+s.page.path;if(this.links.has(D)||this.reverseLinks.has(D))return;const h=s.page.path+"|:?:|"+e.page.path,d=new I(a===i.FROM?s:e,a===i.FROM?e:s,a===i.FROM?n===t.FRIEND||n===t.NEXT?n===t.FRIEND?t.FRIEND:t.NEXT:n===t.CHILD?t.PARENT:t.CHILD:n,u,r,o,l,this.plugin);this.links.set(D,d),this.reverseLinks.add(h)}render(e){this.links.forEach((t=>t.render(e.some((e=>{var i;return null===(i=t.hierarchyDefinition)||void 0===i?void 0:i.includes(e)}))||t.isInferred&&e.includes("inferred-link"))))}}class gn{constructor(e,t,i,s,n,u=!0){this.getVal=t,this.updateIndex=u,this.button=s.createEl("button",{cls:"excalibrain-button"}),this.button.createSpan({text:n.display}),this.button.ariaLabel=n.tooltip,this.setColor(),this.button.onclick=()=>{var s;i(!t()),e.saveSettings(),this.setColor(),null===(s=e.scene)||void 0===s||s.reRender(this.updateIndex)}}setColor(){if(this.getVal())return this.button.removeClass("off"),void this.button.addClass("on");this.button.removeClass("on"),this.button.addClass("off")}}var pn="top",Fn="bottom",fn="right",En="left",mn=[pn,Fn,fn,En],Cn=mn.reduce((function(e,t){return e.concat([t+"-start",t+"-end"])}),[]),yn=[].concat(mn,["auto"]).reduce((function(e,t){return e.concat([t,t+"-start",t+"-end"])}),[]),wn=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function vn(e){return e?(e.nodeName||"").toLowerCase():null}function Sn(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function bn(e){return e instanceof Sn(e).Element||e instanceof Element}function xn(e){return e instanceof Sn(e).HTMLElement||e instanceof HTMLElement}function Tn(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Sn(e).ShadowRoot||e instanceof ShadowRoot)}var An={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},s=t.attributes[e]||{},n=t.elements[e];xn(n)&&vn(n)&&(Object.assign(n.style,i),Object.keys(s).forEach((function(e){var t=s[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var s=t.elements[e],n=t.attributes[e]||{},u=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});xn(s)&&vn(s)&&(Object.assign(s.style,u),Object.keys(n).forEach((function(e){s.removeAttribute(e)})))}))}},requires:["computeStyles"]};function On(e){return e.split("-")[0]}var Nn=Math.max,Ln=Math.min,Bn=Math.round;function kn(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function In(){return!/^((?!chrome|android).)*safari/i.test(kn())}function _n(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var s=e.getBoundingClientRect(),n=1,u=1;t&&xn(e)&&(n=e.offsetWidth>0&&Bn(s.width)/e.offsetWidth||1,u=e.offsetHeight>0&&Bn(s.height)/e.offsetHeight||1);var r=(bn(e)?Sn(e):window).visualViewport,a=!In()&&i,o=(s.left+(a&&r?r.offsetLeft:0))/n,l=(s.top+(a&&r?r.offsetTop:0))/u,D=s.width/n,h=s.height/u;return{width:D,height:h,top:l,right:o+D,bottom:l+h,left:o,x:o,y:l}}function Mn(e){var t=_n(e),i=e.offsetWidth,s=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:s}}function Rn(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&Tn(i)){var s=t;do{if(s&&e.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Pn(e){return Sn(e).getComputedStyle(e)}function Vn(e){return["table","td","th"].indexOf(vn(e))>=0}function Hn(e){return((bn(e)?e.ownerDocument:e.document)||window.document).documentElement}function jn(e){return"html"===vn(e)?e:e.assignedSlot||e.parentNode||(Tn(e)?e.host:null)||Hn(e)}function Wn(e){return xn(e)&&"fixed"!==Pn(e).position?e.offsetParent:null}function Gn(e){for(var t=Sn(e),i=Wn(e);i&&Vn(i)&&"static"===Pn(i).position;)i=Wn(i);return i&&("html"===vn(i)||"body"===vn(i)&&"static"===Pn(i).position)?t:i||function(e){var t=/firefox/i.test(kn());if(/Trident/i.test(kn())&&xn(e)&&"fixed"===Pn(e).position)return null;var i=jn(e);for(Tn(i)&&(i=i.host);xn(i)&&["html","body"].indexOf(vn(i))<0;){var s=Pn(i);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||t&&"filter"===s.willChange||t&&s.filter&&"none"!==s.filter)return i;i=i.parentNode}return null}(e)||t}function Yn(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Un(e,t,i){return Nn(e,Ln(t,i))}function zn(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function qn(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}var $n={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,s=e.name,n=e.options,u=i.elements.arrow,r=i.modifiersData.popperOffsets,a=On(i.placement),o=Yn(a),l=[En,fn].indexOf(a)>=0?"height":"width";if(u&&r){var D=function(e,t){return zn("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:qn(e,mn))}(n.padding,i),h=Mn(u),d="y"===o?pn:En,c="y"===o?Fn:fn,g=i.rects.reference[l]+i.rects.reference[o]-r[o]-i.rects.popper[l],p=r[o]-i.rects.reference[o],F=Gn(u),f=F?"y"===o?F.clientHeight||0:F.clientWidth||0:0,E=g/2-p/2,m=D[d],C=f-h[l]-D[c],y=f/2-h[l]/2+E,w=Un(m,y,C),v=o;i.modifiersData[s]=((t={})[v]=w,t.centerOffset=w-y,t)}},effect:function(e){var t=e.state,i=e.options.element,s=void 0===i?"[data-popper-arrow]":i;null!=s&&("string"!=typeof s||(s=t.elements.popper.querySelector(s)))&&Rn(t.elements.popper,s)&&(t.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Zn(e){return e.split("-")[1]}var Xn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Jn(e){var t,i=e.popper,s=e.popperRect,n=e.placement,u=e.variation,r=e.offsets,a=e.position,o=e.gpuAcceleration,l=e.adaptive,D=e.roundOffsets,h=e.isFixed,d=r.x,c=void 0===d?0:d,g=r.y,p=void 0===g?0:g,F="function"==typeof D?D({x:c,y:p}):{x:c,y:p};c=F.x,p=F.y;var f=r.hasOwnProperty("x"),E=r.hasOwnProperty("y"),m=En,C=pn,y=window;if(l){var w=Gn(i),v="clientHeight",S="clientWidth";w===Sn(i)&&"static"!==Pn(w=Hn(i)).position&&"absolute"===a&&(v="scrollHeight",S="scrollWidth"),(n===pn||(n===En||n===fn)&&"end"===u)&&(C=Fn,p-=(h&&w===y&&y.visualViewport?y.visualViewport.height:w[v])-s.height,p*=o?1:-1),n!==En&&(n!==pn&&n!==Fn||"end"!==u)||(m=fn,c-=(h&&w===y&&y.visualViewport?y.visualViewport.width:w[S])-s.width,c*=o?1:-1)}var b,x=Object.assign({position:a},l&&Xn),T=!0===D?function(e){var t=e.x,i=e.y,s=window.devicePixelRatio||1;return{x:Bn(t*s)/s||0,y:Bn(i*s)/s||0}}({x:c,y:p}):{x:c,y:p};return c=T.x,p=T.y,o?Object.assign({},x,((b={})[C]=E?"0":"",b[m]=f?"0":"",b.transform=(y.devicePixelRatio||1)<=1?"translate("+c+"px, "+p+"px)":"translate3d("+c+"px, "+p+"px, 0)",b)):Object.assign({},x,((t={})[C]=E?p+"px":"",t[m]=f?c+"px":"",t.transform="",t))}var Kn={passive:!0},Qn={left:"right",right:"left",bottom:"top",top:"bottom"};function eu(e){return e.replace(/left|right|bottom|top/g,(function(e){return Qn[e]}))}var tu={start:"end",end:"start"};function iu(e){return e.replace(/start|end/g,(function(e){return tu[e]}))}function su(e){var t=Sn(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function nu(e){return _n(Hn(e)).left+su(e).scrollLeft}function uu(e){var t=Pn(e),i=t.overflow,s=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+s)}function ru(e){return["html","body","#document"].indexOf(vn(e))>=0?e.ownerDocument.body:xn(e)&&uu(e)?e:ru(jn(e))}function au(e,t){var i;void 0===t&&(t=[]);var s=ru(e),n=s===(null==(i=e.ownerDocument)?void 0:i.body),u=Sn(s),r=n?[u].concat(u.visualViewport||[],uu(s)?s:[]):s,a=t.concat(r);return n?a:a.concat(au(jn(r)))}function ou(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function lu(e,t,i){return"viewport"===t?ou(function(e,t){var i=Sn(e),s=Hn(e),n=i.visualViewport,u=s.clientWidth,r=s.clientHeight,a=0,o=0;if(n){u=n.width,r=n.height;var l=In();(l||!l&&"fixed"===t)&&(a=n.offsetLeft,o=n.offsetTop)}return{width:u,height:r,x:a+nu(e),y:o}}(e,i)):bn(t)?function(e,t){var i=_n(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):ou(function(e){var t,i=Hn(e),s=su(e),n=null==(t=e.ownerDocument)?void 0:t.body,u=Nn(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),r=Nn(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),a=-s.scrollLeft+nu(e),o=-s.scrollTop;return"rtl"===Pn(n||i).direction&&(a+=Nn(i.clientWidth,n?n.clientWidth:0)-u),{width:u,height:r,x:a,y:o}}(Hn(e)))}function Du(e){var t,i=e.reference,s=e.element,n=e.placement,u=n?On(n):null,r=n?Zn(n):null,a=i.x+i.width/2-s.width/2,o=i.y+i.height/2-s.height/2;switch(u){case pn:t={x:a,y:i.y-s.height};break;case Fn:t={x:a,y:i.y+i.height};break;case fn:t={x:i.x+i.width,y:o};break;case En:t={x:i.x-s.width,y:o};break;default:t={x:i.x,y:i.y}}var l=u?Yn(u):null;if(null!=l){var D="y"===l?"height":"width";switch(r){case"start":t[l]=t[l]-(i[D]/2-s[D]/2);break;case"end":t[l]=t[l]+(i[D]/2-s[D]/2)}}return t}function hu(e,t){void 0===t&&(t={});var i=t,s=i.placement,n=void 0===s?e.placement:s,u=i.strategy,r=void 0===u?e.strategy:u,a=i.boundary,o=void 0===a?"clippingParents":a,l=i.rootBoundary,D=void 0===l?"viewport":l,h=i.elementContext,d=void 0===h?"popper":h,c=i.altBoundary,g=void 0!==c&&c,p=i.padding,F=void 0===p?0:p,f=zn("number"!=typeof F?F:qn(F,mn)),E="popper"===d?"reference":"popper",m=e.rects.popper,C=e.elements[g?E:d],y=function(e,t,i,s){var n="clippingParents"===t?function(e){var t=au(jn(e)),i=["absolute","fixed"].indexOf(Pn(e).position)>=0&&xn(e)?Gn(e):e;return bn(i)?t.filter((function(e){return bn(e)&&Rn(e,i)&&"body"!==vn(e)})):[]}(e):[].concat(t),u=[].concat(n,[i]),r=u[0],a=u.reduce((function(t,i){var n=lu(e,i,s);return t.top=Nn(n.top,t.top),t.right=Ln(n.right,t.right),t.bottom=Ln(n.bottom,t.bottom),t.left=Nn(n.left,t.left),t}),lu(e,r,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(bn(C)?C:C.contextElement||Hn(e.elements.popper),o,D,r),w=_n(e.elements.reference),v=Du({reference:w,element:m,strategy:"absolute",placement:n}),S=ou(Object.assign({},m,v)),b="popper"===d?S:w,x={top:y.top-b.top+f.top,bottom:b.bottom-y.bottom+f.bottom,left:y.left-b.left+f.left,right:b.right-y.right+f.right},T=e.modifiersData.offset;if("popper"===d&&T){var A=T[n];Object.keys(x).forEach((function(e){var t=[fn,Fn].indexOf(e)>=0?1:-1,i=[pn,Fn].indexOf(e)>=0?"y":"x";x[e]+=A[i]*t}))}return x}var cu={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,s=e.name;if(!t.modifiersData[s]._skip){for(var n=i.mainAxis,u=void 0===n||n,r=i.altAxis,a=void 0===r||r,o=i.fallbackPlacements,l=i.padding,D=i.boundary,h=i.rootBoundary,d=i.altBoundary,c=i.flipVariations,g=void 0===c||c,p=i.allowedAutoPlacements,F=t.options.placement,f=On(F),E=o||(f!==F&&g?function(e){if("auto"===On(e))return[];var t=eu(e);return[iu(e),t,iu(t)]}(F):[eu(F)]),m=[F].concat(E).reduce((function(e,i){return e.concat("auto"===On(i)?function(e,t){void 0===t&&(t={});var i=t,s=i.placement,n=i.boundary,u=i.rootBoundary,r=i.padding,a=i.flipVariations,o=i.allowedAutoPlacements,l=void 0===o?yn:o,D=Zn(s),h=D?a?Cn:Cn.filter((function(e){return Zn(e)===D})):mn,d=h.filter((function(e){return l.indexOf(e)>=0}));0===d.length&&(d=h);var c=d.reduce((function(t,i){return t[i]=hu(e,{placement:i,boundary:n,rootBoundary:u,padding:r})[On(i)],t}),{});return Object.keys(c).sort((function(e,t){return c[e]-c[t]}))}(t,{placement:i,boundary:D,rootBoundary:h,padding:l,flipVariations:g,allowedAutoPlacements:p}):i)}),[]),C=t.rects.reference,y=t.rects.popper,w=new Map,v=!0,S=m[0],b=0;b<m.length;b++){var x=m[b],T=On(x),A="start"===Zn(x),O=[pn,Fn].indexOf(T)>=0,N=O?"width":"height",L=hu(t,{placement:x,boundary:D,rootBoundary:h,altBoundary:d,padding:l}),B=O?A?fn:En:A?Fn:pn;C[N]>y[N]&&(B=eu(B));var k=eu(B),I=[];if(u&&I.push(L[T]<=0),a&&I.push(L[B]<=0,L[k]<=0),I.every((function(e){return e}))){S=x,v=!1;break}w.set(x,I)}if(v)for(var _=function(e){var t=m.find((function(t){var i=w.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return S=t,"break"},M=g?3:1;M>0&&"break"!==_(M);M--);t.placement!==S&&(t.modifiersData[s]._skip=!0,t.placement=S,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function gu(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function pu(e){return[pn,fn,Fn,En].some((function(t){return e[t]>=0}))}function Fu(e,t,i){void 0===i&&(i=!1);var s,n,u=xn(t),r=xn(t)&&function(e){var t=e.getBoundingClientRect(),i=Bn(t.width)/e.offsetWidth||1,s=Bn(t.height)/e.offsetHeight||1;return 1!==i||1!==s}(t),a=Hn(t),o=_n(e,r,i),l={scrollLeft:0,scrollTop:0},D={x:0,y:0};return(u||!u&&!i)&&(("body"!==vn(t)||uu(a))&&(l=(s=t)!==Sn(s)&&xn(s)?{scrollLeft:(n=s).scrollLeft,scrollTop:n.scrollTop}:su(s)),xn(t)?((D=_n(t,!0)).x+=t.clientLeft,D.y+=t.clientTop):a&&(D.x=nu(a))),{x:o.left+l.scrollLeft-D.x,y:o.top+l.scrollTop-D.y,width:o.width,height:o.height}}function fu(e){var t=new Map,i=new Set,s=[];function n(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var s=t.get(e);s&&n(s)}})),s.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||n(e)})),s}var Eu={placement:"bottom",modifiers:[],strategy:"absolute"};function mu(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}var yu,wu=function(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,s=void 0===i?[]:i,n=t.defaultOptions,u=void 0===n?Eu:n;return function(e,t,i){void 0===i&&(i=u);var n,r,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Eu,u),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],l=!1,D={state:a,setOptions:function(i){var n="function"==typeof i?i(a.options):i;h(),a.options=Object.assign({},u,a.options,n),a.scrollParents={reference:bn(e)?au(e):e.contextElement?au(e.contextElement):[],popper:au(t)};var r,l,d=function(e){var t=fu(e);return wn.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}((r=[].concat(s,a.options.modifiers),l=r.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return a.orderedModifiers=d.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,s=void 0===i?{}:i,n=e.effect;if("function"==typeof n){var u=n({state:a,name:t,instance:D,options:s});o.push(u||function(){})}})),D.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,i=e.popper;if(mu(t,i)){a.rects={reference:Fu(t,Gn(i),"fixed"===a.options.strategy),popper:Mn(i)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var s=0;s<a.orderedModifiers.length;s++)if(!0!==a.reset){var n=a.orderedModifiers[s],u=n.fn,r=n.options,o=void 0===r?{}:r,h=n.name;"function"==typeof u&&(a=u({state:a,options:o,name:h,instance:D})||a)}else a.reset=!1,s=-1}}},update:(n=function(){return new Promise((function(e){D.forceUpdate(),e(a)}))},function(){return r||(r=new Promise((function(e){Promise.resolve().then((function(){r=void 0,e(n())}))}))),r}),destroy:function(){h(),l=!0}};if(!mu(e,t))return D;function h(){o.forEach((function(e){return e()})),o=[]}return D.setOptions(i).then((function(e){!l&&i.onFirstUpdate&&i.onFirstUpdate(e)})),D}}({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,s=e.options,n=s.scroll,u=void 0===n||n,r=s.resize,a=void 0===r||r,o=Sn(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return u&&l.forEach((function(e){e.addEventListener("scroll",i.update,Kn)})),a&&o.addEventListener("resize",i.update,Kn),function(){u&&l.forEach((function(e){e.removeEventListener("scroll",i.update,Kn)})),a&&o.removeEventListener("resize",i.update,Kn)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=Du({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,s=i.gpuAcceleration,n=void 0===s||s,u=i.adaptive,r=void 0===u||u,a=i.roundOffsets,o=void 0===a||a,l={placement:On(t.placement),variation:Zn(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Jn(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:r,roundOffsets:o})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Jn(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:o})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},An,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,s=e.name,n=i.offset,u=void 0===n?[0,0]:n,r=yn.reduce((function(e,i){return e[i]=function(e,t,i){var s=On(e),n=[En,pn].indexOf(s)>=0?-1:1,u="function"==typeof i?i(Object.assign({},t,{placement:e})):i,r=u[0],a=u[1];return r=r||0,a=(a||0)*n,[En,fn].indexOf(s)>=0?{x:a,y:r}:{x:r,y:a}}(i,t.rects,u),e}),{}),a=r[t.placement],o=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=o,t.modifiersData.popperOffsets.y+=l),t.modifiersData[s]=r}},cu,{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,s=e.name,n=i.mainAxis,u=void 0===n||n,r=i.altAxis,a=void 0!==r&&r,o=i.boundary,l=i.rootBoundary,D=i.altBoundary,h=i.padding,d=i.tether,c=void 0===d||d,g=i.tetherOffset,p=void 0===g?0:g,F=hu(t,{boundary:o,rootBoundary:l,padding:h,altBoundary:D}),f=On(t.placement),E=Zn(t.placement),m=!E,C=Yn(f),y="x"===C?"y":"x",w=t.modifiersData.popperOffsets,v=t.rects.reference,S=t.rects.popper,b="function"==typeof p?p(Object.assign({},t.rects,{placement:t.placement})):p,x="number"==typeof b?{mainAxis:b,altAxis:b}:Object.assign({mainAxis:0,altAxis:0},b),T=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(w){if(u){var O,N="y"===C?pn:En,L="y"===C?Fn:fn,B="y"===C?"height":"width",k=w[C],I=k+F[N],_=k-F[L],M=c?-S[B]/2:0,R="start"===E?v[B]:S[B],P="start"===E?-S[B]:-v[B],V=t.elements.arrow,H=c&&V?Mn(V):{width:0,height:0},j=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},W=j[N],G=j[L],Y=Un(0,v[B],H[B]),U=m?v[B]/2-M-Y-W-x.mainAxis:R-Y-W-x.mainAxis,z=m?-v[B]/2+M+Y+G+x.mainAxis:P+Y+G+x.mainAxis,q=t.elements.arrow&&Gn(t.elements.arrow),$=q?"y"===C?q.clientTop||0:q.clientLeft||0:0,Z=null!=(O=null==T?void 0:T[C])?O:0,X=k+z-Z,J=Un(c?Ln(I,k+U-Z-$):I,k,c?Nn(_,X):_);w[C]=J,A[C]=J-k}if(a){var K,Q="x"===C?pn:En,ee="x"===C?Fn:fn,te=w[y],ie="y"===y?"height":"width",se=te+F[Q],ne=te-F[ee],ue=-1!==[pn,En].indexOf(f),re=null!=(K=null==T?void 0:T[y])?K:0,ae=ue?se:te-v[ie]-S[ie]-re+x.altAxis,oe=ue?te+v[ie]+S[ie]-re-x.altAxis:ne,le=c&&ue?function(e,t,i){var s=Un(e,t,i);return s>i?i:s}(ae,te,oe):Un(c?ae:se,te,c?oe:ne);w[y]=le,A[y]=le-te}t.modifiersData[s]=A}},requiresIfExists:["offset"]},$n,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,s=t.rects.reference,n=t.rects.popper,u=t.modifiersData.preventOverflow,r=hu(t,{elementContext:"reference"}),a=hu(t,{altBoundary:!0}),o=gu(r,s),l=gu(a,n,u),D=pu(o),h=pu(l);t.modifiersData[i]={referenceClippingOffsets:o,popperEscapeOffsets:l,isReferenceHidden:D,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":D,"data-popper-escaped":h})}}]});class vu{constructor(e,t,i,s=30){this.owner=e,this.containerEl=t,this.limit=s,this.owner=e,this.containerEl=t,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),i.register([],"ArrowUp",(e=>{if(!e.isComposing)return this.setSelectedItem(this.selectedItem-1,!0),!1})),i.register([],"ArrowDown",(e=>{if(!e.isComposing)return this.setSelectedItem(this.selectedItem+1,!0),!1})),i.register([],"Enter",(e=>{if(!e.isComposing)return this.useSelectedItem(e),!1}))}onSuggestionClick(e,t){e.preventDefault();const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1)}setSuggestions(e){this.containerEl.empty();const t=[];e.slice(0,this.limit).forEach((e=>{const i=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(e,i),t.push(i)})),this.values=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){const t=this.values[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}setSelectedItem(e,t){const i=(e%(s=this.suggestions.length)+s)%s;var s;const n=this.suggestions[this.selectedItem],u=this.suggestions[i];null==n||n.removeClass("is-selected"),null==u||u.addClass("is-selected"),this.selectedItem=i,t&&u.scrollIntoView(!1)}}class Su{constructor(e,t,i){this.app=e,this.inputEl=t,this.containerEl=i,this.scope=new s.Scope,this.suggestEl=i.createDiv("suggestion-container");const n=this.suggestEl.createDiv("suggestion");this.suggest=new vu(this,n,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("focus",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",(e=>{e.preventDefault()}))}onInputChanged(){const e=this.inputEl.value,t=this.getSuggestions(e);t&&t.length>0?(this.suggest.setSuggestions(t),this.open(this.containerEl,this.inputEl)):this.close()}open(e,t){this.app.keymap.pushScope(this.scope),e.appendChild(this.suggestEl),this.popper=wu(t,this.suggestEl,{placement:"bottom-start",modifiers:[{name:"sameWidth",enabled:!0,fn:({state:e,instance:t})=>{const i=`${e.rects.reference.width}px`;e.styles.popper.width!==i&&(e.styles.popper.width=i,t.update())},phase:"beforeWrite",requires:["computeStyles"]}]})}close(){this.app.keymap.popScope(this.scope),this.suggest.setSuggestions([]),this.popper&&this.popper.destroy(),this.suggestEl.detach()}}!function(e){e[e.TemplateFiles=0]="TemplateFiles",e[e.ScriptFiles=1]="ScriptFiles"}(yu||(yu={}));class bu extends Su{constructor(e,t,i,s){super(e,t,s),this.plugin=i}getSuggestions(e){var t,i,n;if(""===e)return this.plugin.starred;const u=e.toLowerCase(),r=null===(t=this.plugin.pages)||void 0===t?void 0:t.getPages().filter((e=>(!e.file||(this.plugin.settings.showAttachments||"md"===e.file.extension)&&!this.plugin.settings.excludeFilepaths.some((t=>e.path.startsWith(t))))&&(e.file||(this.plugin.settings.showFolderNodes||!e.path.startsWith("folder:"))&&(this.plugin.settings.showTagNodes||!e.path.startsWith("tag:")))&&e.name.toLowerCase().contains(u)));if(r.length>30)return r;const a=r.concat(null===(i=this.plugin.pages)||void 0===i?void 0:i.getPages().filter((e=>!r.contains(e)&&(!e.file||(this.plugin.settings.showAttachments||"md"===e.file.extension)&&!this.plugin.settings.excludeFilepaths.some((t=>e.path.startsWith(t))))&&(e.file||(this.plugin.settings.showFolderNodes||!e.path.startsWith("folder:"))&&(this.plugin.settings.showTagNodes||!e.path.startsWith("tag:")))&&e.path.toLowerCase().contains(u))));if(a.length>30)return a;const o=s.prepareFuzzySearch(e);return a.concat(null===(n=this.plugin.pages)||void 0===n?void 0:n.getPages().filter((e=>!e.isVirtual&&(!e.file||(this.plugin.settings.showAttachments||"md"===e.file.extension)&&!this.plugin.settings.excludeFilepaths.some((t=>e.path.startsWith(t))))&&(e.file||(this.plugin.settings.showFolderNodes||!e.path.startsWith("folder:"))&&(this.plugin.settings.showTagNodes||!e.path.startsWith("tag:")))&&!a.contains(e)&&o(e.path))))}renderSuggestion(e,t){var i,s;t.ariaLabel=e.path,t.setText(e.isFolder||e.isTag?e.path.replace(/^folder:/,null!==(i=this.plugin.settings.folderNodeStyle.prefix)&&void 0!==i?i:"ðŸ“‚").replace(/^tag:/,null!==(s=this.plugin.settings.tagNodeStyle.prefix)&&void 0!==s?s:"ðŸ·ï¸"):e.name)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}}class xu{constructor(e,t,i,s){this.label="",this.selected=!1,this.value=e,this.label=t,this.multiple=i,this.onChange=s,this.createOptionElement(),this.createListeners()}select(e=!0){this.selected=!0,this.setAttribute(),e&&this.onChange(this)}deselect(e=!0){this.selected=!1,this.setAttribute(),e&&this.onChange(this)}createOptionElement(){const e=document.createElement("div");e.classList.add("option"),this.singleSelectTextSpanRef=document.createElement("span"),this.singleSelectTextSpanRef.classList.add("option-text"),this.singleSelectTextSpanRef.innerText=this.label,e.appendChild(this.singleSelectTextSpanRef),e.appendChild(this.createCheckbox()),this.optionRef=e}createCheckbox(){const e=document.createElement("label");e.classList.add("checkbox-wrapper");const t=document.createElement("span");t.classList.add("checkbox-text"),t.innerText=this.label;const i=document.createElement("input");i.setAttribute("type","checkbox"),this.checkboxRef=i;const s=document.createElement("span");return s.classList.add("checkbox-checkmark"),e.appendChild(t),e.appendChild(i),e.appendChild(s),e}setAttribute(){this.multiple?this.selected?this.checkboxRef.setAttribute("checked","checked"):this.checkboxRef.removeAttribute("checked"):this.selected?this.singleSelectTextSpanRef.classList.add("selected"):this.singleSelectTextSpanRef.classList.remove("selected")}createListeners(){this.multiple?this.checkboxRef.addEventListener("change",(()=>{this.selected=this.checkboxRef.checked,this.onChange(this)})):this.singleSelectTextSpanRef.addEventListener("click",(()=>{this.selected=!0,this.onChange(this)}))}}class Tu{constructor(e){if(this.options=[],this.dropdownOpened=!1,this.destroyed=!1,this.rendered=!1,this.documentClickDropdownToggle=e=>{this.selectWrapperRef.contains(e.target)||this.handleDropdownToggle(!1,this.dropdownOpened)},this.config=e,this.assignConfig(),this.setOrigin(),!this.origin)throw"You have to pass origin element!";this.init()}init(){this.destroyed=!1,this.dropdownOpened=!1,this.createSelect(),this.createListeners()}destroy(){this.destroyed=!0,this.rendered=!1,this.hide(),document.removeEventListener("click",this.documentClickDropdownToggle),this.selectWrapperRef.cloneNode(!0),this.origin=null,this.selectHeaderRef=null,this.selectWrapperRef=null,this.selectedValueRef=null,this.optionsWrapperRef=null,this.options=[]}reset(){this.options.forEach((e=>e.deselect(!1))),this.updateSelection()}hide(){this.origin.innerHTML="",this.rendered=!1}render(){if(this.destroyed)throw"But you destroyed me... :(";if(this.origin.innerText.trim())throw"Hey! I am rendered already!";this.origin.appendChild(this.selectWrapperRef),this.rendered=!0,this.selectHeaderRef&&this.origin.prepend(this.selectHeaderRef)}assignConfig(){var e,t;this.origin=this.config.origin,this.configOptions=this.config.options,this.multiple=null===(e=this.config.multiple)||void 0===e||e,this.singularNominativeLabel=this.config.singularNominativeLabel,this.pluralNominativeLabel=this.config.pluralNominativeLabel,this.pluralGenitiveLabel=this.config.pluralGenitiveLabel,this.placeholder=null!==(t=this.config.placeholder)&&void 0!==t?t:"",this.headerLabel=this.config.headerLabel,this.selected=this.config.selected,this.onDropdownOpen=this.config.onDropdownOpen,this.onDropdownClose=this.config.onDropdownClose,this.onSelectionChange=this.config.onSelectionChange}setOrigin(){this.origin&&this.origin.classList.add("multiselect-container")}createHeader(){this.headerLabel&&(this.selectHeaderRef=document.createElement("div"),this.selectHeaderRef.classList.add("multiselect-header"),this.selectHeaderRef.innerText=this.headerLabel)}createSelect(){this.selectWrapperRef=document.createElement("div"),this.selectWrapperRef.classList.add("multiselect-wrapper"),this.multiple||this.selectWrapperRef.classList.add("single-select"),this.selectedValueRef=document.createElement("div"),this.selectedValueRef.classList.add("selected-value"),this.selectWrapperRef.appendChild(this.selectedValueRef),this.optionsWrapperRef=document.createElement("div"),this.optionsWrapperRef.classList.add("options-wrapper"),this.configOptions.forEach((e=>{var t;const i=new xu(e.value,e.label,this.multiple,this.onSelectChange.bind(this));(null===(t=this.selected)||void 0===t?void 0:t.includes(e.value))&&i.select(!1),this.options.push(i),this.optionsWrapperRef.appendChild(i.optionRef)})),this.updateSelection(),this.selectWrapperRef.appendChild(this.optionsWrapperRef),this.createHeader(),this.render()}createListeners(){this.selectWrapperRef.addEventListener("click",(e=>{this.selectWrapperRef.contains(e.target)&&!this.optionsWrapperRef.contains(e.target)&&this.handleDropdownToggle(!this.dropdownOpened)})),document.addEventListener("click",this.documentClickDropdownToggle)}handleDropdownToggle(e,t=!0){this.dropdownOpened=e,this.dropdownOpened?(this.selectWrapperRef.classList.add("opened"),this.onDropdownOpen&&t&&this.onDropdownOpen()):(this.selectWrapperRef.classList.remove("opened"),this.onDropdownClose&&t&&this.onDropdownClose(this.selected))}onSelectChange(e){this.multiple||(this.options.forEach((e=>e.deselect(!1))),e.select(!1)),this.updateSelection(),this.onSelectionChange&&this.onSelectionChange(this.selected),this.multiple||this.handleDropdownToggle(!1)}updateSelection(){this.selected=this.options.filter((e=>!!e.selected)).map((e=>e.value));const e=this.options.filter((e=>!!e.selected)).map((e=>e.label));let t=this.placeholder;1===e.length?t=e[0]:e.length>1&&(t=`${e.length} ${this.transformPluralLabel(e.length)}`),this.selectedValueRef.innerText=t}transformPluralLabel(e){var t,i,s;return 1===e?null!==(t=this.singularNominativeLabel)&&void 0!==t?t:"items":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?null!==(i=this.pluralNominativeLabel)&&void 0!==i?i:"items":null!==(s=this.pluralGenitiveLabel)&&void 0!==s?s:"items"}}class Au{constructor(e,t){this.plugin=e,this.selectedLinks=new Set,this.selectedTags=new Set,this.isOpen=!1,this.filterDiv=t.createDiv({attr:{id:"filter"}})}render(){if(this.isOpen)return;if(this.filterDiv.empty(),!this.plugin.scene)return;const e=Array.from(this.selectedTags);this.selectedLinks.forEach((t=>e.push("link::"+t)));const t=[],i=new Set(this.selectedLinks.keys());this.plugin.scene.links.links.forEach((e=>{var t;null===(t=e.hierarchyDefinition)||void 0===t||t.split(",").map((e=>e.trim())).forEach((e=>i.add(e))),e.hierarchyDefinition||(e.isInferred?i.add("inferred-link"):i.add("normal-link"))})),i.forEach((e=>t.push({label:e,value:"link::"+e})));const s=new Set(this.selectedTags.keys());this.plugin.scene.nodesMap.forEach((e=>{e.page.primaryStyleTag&&s.add(e.page.primaryStyleTag)})),s.forEach((e=>t.push({label:e,value:e})));const n=new Tu({origin:this.filterDiv,placeholder:"filter links and tags",options:t.sort(((e,t)=>e.label>t.label?1:-1)),selected:e,onDropdownOpen:()=>{this.isOpen=!0,this.selectedItems=n.selected},onSelectionChange:e=>{var t;this.selectedLinks.clear(),this.selectedTags.clear(),e.forEach((e=>{e.startsWith("link::")?this.selectedLinks.add(e.substring(6)):this.selectedTags.add(e)})),null===(t=this.plugin.scene)||void 0===t||t.reRender(!1)},onDropdownClose:e=>{var t;this.isOpen=!1,e!==this.selectedItems&&(null===(t=this.plugin.scene)||void 0===t||t.reRender(!1))}})}}class Ou{constructor(e,t){this.contentEl=e,this.plugin=t,this.buttons=[],e.addClass("excalibrain-contentEl"),this.wrapperDiv=this.contentEl.createDiv({cls:"excalibrain-toolspanel-wrapper"});const i=this.wrapperDiv.createDiv({cls:"excalibrain-dropdown-wrapper"}),s=i.createEl("input",{type:"text",cls:"excalibrain-searchinput"});s.ariaLabel=L("SEARCH_IN_VAULT"),s.oninput=()=>{var e;const t=this.plugin.pages.get(s.value);t&&(null===(e=this.plugin.scene)||void 0===e||e.renderGraphForPath(t.path))},s.onblur=()=>{s.value=""},new bu(this.plugin.app,s,this.plugin,e),this.searchElement=s,this.linkTagFilter=new Au(t,i),this.linkTagFilter.render();const n=this.wrapperDiv.createDiv({cls:"excalibrain-buttons"}),u=n.createEl("button",{cls:"excalibrain-button",text:"âœ"});u.ariaLabel=L("OPEN_DRAWING"),u.onclick=()=>{const e=this.plugin.EA.getExcalidrawAPI().getSceneElements(),t=this.plugin.EA.getExcalidrawAPI().getAppState(),i=this.plugin.EA;i.reset(),i.canvas.viewBackgroundColor=t.viewBackgroundColor,i.canvas.theme="light",e.forEach((e=>i.elementsDict[e.id]=e)),i.create({filename:`ExcaliBrain Snapshot - ${d(this.plugin.scene.centralPagePath).basename}`,onNewPane:!0})},this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showAttachments),(e=>this.plugin.settings.showAttachments=e),n,{display:"ðŸ“Ž",tooltip:L("SHOW_HIDE_ATTACHMENTS")})),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showVirtualNodes),(e=>this.plugin.settings.showVirtualNodes=e),n,{display:"âˆ…",tooltip:L("SHOW_HIDE_VIRTUAL")},!1)),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showInferredNodes),(e=>this.plugin.settings.showInferredNodes=e),n,{display:"ðŸ¤”",tooltip:L("SHOW_HIDE_INFERRED")})),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showPageNodes),(e=>this.plugin.settings.showPageNodes=e),n,{display:"ðŸ“„",tooltip:L("SHOW_HIDE_PAGES")})),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showFolderNodes),(e=>this.plugin.settings.showFolderNodes=e),n,{display:"ðŸ“‚",tooltip:L("SHOW_HIDE_FOLDER")},!0)),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.showTagNodes),(e=>this.plugin.settings.showTagNodes=e),n,{display:"#",tooltip:L("SHOW_HIDE_TAG")},!1)),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.renderAlias),(e=>this.plugin.settings.renderAlias=e),n,{display:"ðŸ§¥",tooltip:L("SHOW_HIDE_ALIAS")},!1)),this.buttons.push(new gn(this.plugin,(()=>this.plugin.scene.pinLeaf),(e=>this.plugin.scene.pinLeaf=e),n,{display:"ðŸ“Œ",tooltip:L("PIN_LEAF")},!1)),this.buttons.push(new gn(this.plugin,(()=>this.plugin.settings.renderSiblings),(e=>this.plugin.settings.renderSiblings=e),n,{display:"ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦",tooltip:L("SHOW_HIDE_SIBLINGS")},!1)),this.contentEl.appendChild(this.wrapperDiv)}rerender(){this.buttons.forEach((e=>e.setColor())),this.linkTagFilter.render()}terminate(){var e;if(this.contentEl&&this.contentEl.removeClass("excalibrain-contentEl"),this.wrapperDiv){try{null===(e=this.contentEl)||void 0===e||e.removeChild(this.wrapperDiv)}catch(e){}this.wrapperDiv=null}}}class Nu{constructor(e,t){this.contentEl=e,this.plugin=t,this.wrapperDiv=this.contentEl.createDiv({cls:"excalibrain-history-wrapper"}),this.rerender(),this.contentEl.appendChild(this.wrapperDiv)}rerender(){this.wrapperDiv.empty();const e=this.wrapperDiv.createDiv({cls:"excalibrain-history-container"}),t=this.plugin.settings.navigationHistory;for(let i=t.length-1;i>=0;i--){i!==t.length-1&&e.createDiv({text:"â€¢",cls:"excalibrain-history-divider"});let s="",n="";const u=this.plugin.pages.get(t[i]);if(!u)return;const r=u.path.startsWith("folder:")?this.plugin.settings.folderNodeStyle:u.path.startsWith("tag:")?this.plugin.settings.tagNodeStyle:Object.assign(Object.assign({},this.plugin.settings.baseNodeStyle),l(o(u.dvPage,this.plugin.settings),this.plugin.settings));u.file?(s=r.prefix+u.getTitle(),n=u.path):(s=r.prefix+u.name,u.path,n=u.path),e.createDiv({text:s,cls:"excalibrain-history-item"},(e=>{e.onclick=()=>{var e;return null===(e=this.plugin.scene)||void 0===e?void 0:e.renderGraphForPath(n)}}))}}terminate(){var e;if(this.wrapperDiv){try{null===(e=this.contentEl)||void 0===e||e.removeChild(this.wrapperDiv)}catch(e){}this.wrapperDiv=null}}}class Lu{constructor(e,t,i){this.disregardLeafChange=!1,this.nodesMap=new Map,this.layouts=[],this.blockUpdateTimer=!1,this.vaultFileChanged=!1,this.pinLeaf=!1,this.focusSearchAfterInitiation=!0,this.zoomToFitOnNextBrainLeafActivate=!1,this.ea=e.EA,this.plugin=e,this.app=e.app,this.leaf=null!=i?i:app.workspace.getLeaf(t),this.terminated=!1,this.links=new cn(e)}async initialize(e){var t;this.focusSearchAfterInitiation=e,await this.plugin.loadSettings(),(null===(t=this.leaf)||void 0===t?void 0:t.view)&&(this.toolsPanel=new Ou(this.leaf.view.contentEl,this.plugin),this.initializeScene())}isActive(){var e;return!this.terminated&&app.workspace.getLeafById(null===(e=this.leaf)||void 0===e?void 0:e.id)}async reRender(e=!0){this.isActive()&&this.centralLeaf&&this.centralPagePath&&(e&&(this.vaultFileChanged=!1,await this.plugin.createIndex()),await this.render())}async renderGraphForPath(e,t=!0){var i;if(!this.isActive())return;this.blockUpdateTimer=!0;const s=this.plugin.pages.get(e);if(!s)return void(this.blockUpdateTimer=!1);const n=!(s.isFolder||s.isTag||s.isVirtual);if(n&&!s.file)return void(this.blockUpdateTimer=!1);if(!(null===(i=this.ea.targetView)||void 0===i?void 0:i.file)||this.ea.targetView.file.path!==this.plugin.settings.excalibrainFilepath)return void this.unloadScene();if(n&&s.file.path===this.ea.targetView.file.path)return void(this.blockUpdateTimer=!1);const u=this.plugin.pages.get(this.centralPagePath);u&&u.path===e&&n&&s.file.stat.mtime===u.mtime?this.blockUpdateTimer=!1:(n&&t?(this.centralLeaf&&app.workspace.getLeafById(this.centralLeaf.id)?this.centralLeaf.openFile(s.file,{active:!1}):this.centralLeaf=this.ea.openFileInNewOrAdjacentLeaf(s.file),this.addToHistory(s.file.path)):this.addToHistory(s.path),s.isFolder&&!this.plugin.settings.showFolderNodes&&(this.plugin.settings.showFolderNodes=!0,this.toolsPanel.rerender()),s.isTag&&!this.plugin.settings.showTagNodes&&(this.plugin.settings.showTagNodes=!0,this.toolsPanel.rerender()),this.centralPagePath=e,await this.render())}async addToHistory(e){const t=this.plugin.settings.navigationHistory;if(t.last()===e)return;const i=t.indexOf(e);i>-1&&t.splice(i,1),t.length>50&&t.shift(),t.push(e)}static async openExcalidrawLeaf(e,t,i){var n;let u=0,r=app.vault.getAbstractFileByPath(t.excalibrainFilepath);if(!r||r instanceof s.TFile){if(!r)for(r=await app.vault.create(t.excalibrainFilepath,hn);r instanceof s.TFile&&!e.isExcalidrawFile(r)&&u++<10;)await sleep(50);if(u=0,r&&r instanceof s.TFile&&!e.isExcalidrawFile(r))new B(app,"âš  File Exists",`${r.path} already exists in your Vault. Is it ok to overwrite this file? If not, change ExcaliBrain file path in plugin settings.`).show((async n=>{if(n){for(await app.vault.modify(r,hn);r instanceof s.TFile&&!e.isExcalidrawFile(r)&&u++<10;)await sleep(50);Lu.openExcalidrawLeaf(e,t,i)}else new s.Notice("Could not start ExcaliBrain. Please change the ExcaliBrain file path in plugin settings.")}));else if(await(null!=i?i:app.workspace.getLeaf(!0)).openFile(r),t.defaultAlwaysOnTop&&i){const e=null===(n=i.view)||void 0===n?void 0:n.ownerWindow;e&&e!==window&&!e.electronWindow.isMaximized()&&e.electronWindow.setAlwaysOnTop(!0)}}else new s.Notice(`Please check settings. ExcaliBrain path (${t.excalibrainFilepath}) points to a folder, not a file`)}async initializeScene(){this.disregardLeafChange=!1;const e=this.ea,t=this.plugin.settings.baseNodeStyle;let i=0;for(e.clear(),e.setView(this.leaf.view);!e.targetView.excalidrawAPI&&i++<10;)await sleep(50);if(!e.targetView.excalidrawAPI)return void new s.Notice("Error initializing Excalidraw view");const n=e.getExcalidrawAPI();this.ea.registerThisAsViewEA(),this.ea.targetView.semaphores.saving=!0,n.setMobileModeAllowed(!1),e.style.fontFamily=t.fontFamily,e.style.fontSize=t.fontSize,this.textSize=e.measureText("m".repeat(t.maxLabelLength+3)),this.nodeWidth=this.textSize.width+3*t.padding,this.plugin.settings.compactView&&(this.nodeWidth=.6*this.nodeWidth),this.nodeHeight=2*(this.textSize.height+2*t.padding),(()=>{n.updateScene({appState:{viewModeEnabled:!0,activeTool:{lastActiveToolBeforeEraser:null,locked:!1,type:"selection"},theme:"light",viewBackgroundColor:this.plugin.settings.backgroundColor},elements:[]})})(),e.style.strokeColor=t.textColor,e.addText(0,0,"ðŸš€ To get started\nselect a document using the search in the top left or\nopen a document in another pane.\n\nâœ¨ For the best experience enable 'Open in adjacent pane'\nin Excalidraw settings under 'Links and Transclusion'.\n\nâš  ExcaliBrain may need to wait for DataView to initialize its index.\nThis can take up to a few minutes after starting Obsidian.",{textAlign:"center"}),e.addElementsToView(),(()=>{this.plugin.settings.allowAutozoom&&n.zoomToFit(null,5,.15),e.targetView.linksAlwaysOpenInANewPane=!0,this.addEventHandler(),this.historyPanel=new Nu(this.leaf.view.contentEl,this.plugin),new s.Notice("ExcaliBrain On")})()}addNodes(t){t.neighbours.forEach((i=>{if(i.page.path===this.ea.targetView.file.path)return;const s=new k({ea:this.ea,page:i.page,isInferred:i.relationType===e.INFERRED,isCentral:t.isCentral,isSibling:t.isSibling,friendGateOnLeft:t.friendGateOnLeft});this.nodesMap.set(i.page.path,s),t.layout.nodes.push(s)}))}async render(){var e,i;if(this.historyPanel&&this.historyPanel.rerender(),!this.centralPagePath)return;let s=this.plugin.pages.get(this.centralPagePath);if(!s&&(this.centralPagePath=this.plugin.lowercasePathMap.get(this.centralPagePath.toLowerCase()),s=this.plugin.pages.get(this.centralPagePath),!s))return;const n=this.ea;this.zoomToFitOnNextBrainLeafActivate=!n.targetView.containerEl.isShown(),n.clear(),n.getExcalidrawAPI().updateScene({elements:[]}),n.style.verticalAlign="middle";const u=s.getParents().filter((e=>!(e.page.path===s.path||this.plugin.settings.excludeFilepaths.some((t=>e.page.path.startsWith(t)))||e.page.primaryStyleTag&&this.toolsPanel.linkTagFilter.selectedTags.has(e.page.primaryStyleTag)))).slice(0,this.plugin.settings.maxItemCount),r=u.map((e=>e.page.path)),a=s.getChildren().filter((e=>!(e.page.path===s.path||this.plugin.settings.excludeFilepaths.some((t=>e.page.path.startsWith(t)))||e.page.primaryStyleTag&&this.toolsPanel.linkTagFilter.selectedTags.has(e.page.primaryStyleTag)))).slice(0,this.plugin.settings.maxItemCount),o=s.getLeftFriends().filter((e=>!(e.page.path===s.path||this.plugin.settings.excludeFilepaths.some((t=>e.page.path.startsWith(t)))||e.page.primaryStyleTag&&this.toolsPanel.linkTagFilter.selectedTags.has(e.page.primaryStyleTag)))).slice(0,this.plugin.settings.maxItemCount),l=s.getRightFriends().filter((e=>!(e.page.path===s.path||this.plugin.settings.excludeFilepaths.some((t=>e.page.path.startsWith(t)))||e.page.primaryStyleTag&&this.toolsPanel.linkTagFilter.selectedTags.has(e.page.primaryStyleTag)))).slice(0,this.plugin.settings.maxItemCount),D=s.getSiblings().filter((e=>!(u.some((t=>t.page.path===e.page.path))||a.some((t=>t.page.path===e.page.path))||o.some((t=>t.page.path===e.page.path))||l.some((t=>t.page.path===e.page.path))||this.plugin.settings.excludeFilepaths.some((t=>e.page.path.startsWith(t))))&&e.page.path!==s.path)),h=D.filter((e=>e.page.getParents().map((e=>e.page.path)).some((e=>r.includes(e)))&&(!e.page.primaryStyleTag||!this.toolsPanel.linkTagFilter.selectedTags.has(e.page.primaryStyleTag)))).slice(0,this.plugin.settings.maxItemCount);this.nodesMap=new Map,this.links=new cn(this.plugin),this.layouts=[];const d=o.length>=10,c=l.length>=10,g=this.plugin.settings.baseNodeStyle,p=h.length>=20?3:h.length>=10?2:1,F=this.plugin.settings.compactView?a.length<=12?[1,1,2,3,3,3,3,2,2,3,3,2,2][a.length]:3:a.length<=12?[1,1,2,3,3,3,3,4,4,5,5,4,4][a.length]:5,f=this.plugin.settings.compactView?u.length<2?1:2:u.length<5?[1,1,2,3,2][u.length]:3,E=new dn({origoX:0,origoY:0,top:null,bottom:null,columns:1,columnWidth:this.nodeWidth,rowHeight:this.nodeHeight});this.layouts.push(E);const m=new dn({origoX:0,origoY:2.5*this.nodeHeight,top:2*this.nodeHeight,bottom:null,columns:F,columnWidth:this.nodeWidth,rowHeight:this.nodeHeight});this.layouts.push(m);const C=new dn({origoX:-((d?1:0)+Math.max(F,f)+1.9)/2.4*this.nodeWidth,origoY:0,top:null,bottom:null,columns:1,columnWidth:this.nodeWidth,rowHeight:this.nodeHeight});this.layouts.push(C);const y=new dn({origoX:((c?1:0)+Math.max(F,f)+1.9)/2.4*this.nodeWidth,origoY:0,top:null,bottom:null,columns:1,columnWidth:this.nodeWidth,rowHeight:this.nodeHeight});this.layouts.push(y);const w=new dn({origoX:0,origoY:-2.5*this.nodeHeight,top:null,bottom:-2*this.nodeHeight,columns:f,columnWidth:this.nodeWidth,rowHeight:this.nodeHeight});this.layouts.push(w);const v=this.plugin.settings.siblingNodeStyle,S=null!==(e=v.padding)&&void 0!==e?e:g.padding,b=null!==(i=v.maxLabelLength)&&void 0!==i?i:g.maxLabelLength;n.style.fontFamily=v.fontFamily,n.style.fontSize=v.fontSize;const x=n.measureText("m".repeat(b+3)),T=x.width+3*S,A=2*(x.height+2*S),O=new dn({origoX:this.nodeWidth*((f-1)/2+(p+1.5)/3),origoY:-2.5*this.nodeHeight,top:null,bottom:-this.nodeHeight/2,columns:p,columnWidth:T,rowHeight:A});this.layouts.push(O);const N=new k({ea:n,page:s,isInferred:!1,isCentral:!0,isSibling:!1,friendGateOnLeft:!0});this.nodesMap.set(s.path,N),E.nodes.push(N),this.addNodes({neighbours:u,layout:w,isCentral:!1,isSibling:!1,friendGateOnLeft:!0}),this.addNodes({neighbours:a,layout:m,isCentral:!1,isSibling:!1,friendGateOnLeft:!0}),this.addNodes({neighbours:o,layout:C,isCentral:!1,isSibling:!1,friendGateOnLeft:!1}),this.addNodes({neighbours:l,layout:y,isCentral:!1,isSibling:!1,friendGateOnLeft:!0}),this.plugin.settings.renderSiblings&&this.addNodes({neighbours:h,layout:O,isCentral:!1,isSibling:!0,friendGateOnLeft:!0});const L=(e,t,i)=>{t.forEach((t=>{const s=this.nodesMap.get(t.page.path);s&&this.links.addLink(e,s,i,t.relationType,t.typeDefinition,t.linkDirection,n,this.plugin.settings)}))};Array.from(this.nodesMap.values()).forEach((e=>{L(e,e.page.getChildren(),t.CHILD),L(e,e.page.getParents(),t.PARENT),L(e,e.page.getLeftFriends(),t.FRIEND),L(e,e.page.getRightFriends(),t.NEXT)})),n.style.opacity=100,this.layouts.forEach((e=>e.render()));const B=n.getElements();this.links.render(Array.from(this.toolsPanel.linkTagFilter.selectedLinks));const I=n.getElements().filter((e=>!B.includes(e)));n.getExcalidrawAPI().updateScene({elements:I.concat(B)}),n.getExcalidrawAPI().updateScene({appState:{viewBackgroundColor:this.plugin.settings.backgroundColor}}),this.plugin.settings.allowAutozoom&&n.getExcalidrawAPI().zoomToFit(null,5,.15),this.toolsPanel.rerender(),this.focusSearchAfterInitiation&&this.plugin.settings.allowAutofocuOnSearch&&(this.toolsPanel.searchElement.focus(),this.focusSearchAfterInitiation=!1),this.blockUpdateTimer=!1}isCentralLeafStillThere(){return null!==app.workspace.getLeafById(this.centralLeaf.id)}async addEventHandler(){const e=this,t=async t=>{var i;if(this.disregardLeafChange)return;if(e.blockUpdateTimer=!0,await sleep(100),this.pinLeaf&&!this.isCentralLeafStillThere()&&(this.pinLeaf=!1,this.toolsPanel.rerender()),this.pinLeaf&&t!==this.centralLeaf)return;if(!(null===(i=e.ea.targetView)||void 0===i?void 0:i.file)||e.ea.targetView.file.path!==e.plugin.settings.excalibrainFilepath)return void e.unloadScene();if(!((null==t?void 0:t.view)&&t.view instanceof s.FileView&&t.view.file))return void(e.blockUpdateTimer=!1);const n=t.view.file;if(n.path===e.ea.targetView.file.path)return this.vaultFileChanged&&(this.zoomToFitOnNextBrainLeafActivate=!1,await this.reRender(!0)),this.zoomToFitOnNextBrainLeafActivate&&(this.zoomToFitOnNextBrainLeafActivate=!1,e.plugin.settings.allowAutozoom&&e.ea.getExcalidrawAPI().zoomToFit(null,5,.15)),void(e.blockUpdateTimer=!1);const u=e.plugin.pages.get(e.centralPagePath);u&&u.path===n.path&&n.stat.mtime===u.mtime?e.blockUpdateTimer=!1:(e.plugin.pages.get(n.path)||await e.plugin.createIndex(),this.addToHistory(n.path),e.centralPagePath=n.path,e.centralLeaf=t,e.render())},i=()=>{this.vaultFileChanged=!0};app.workspace.on("active-leaf-change",t),this.removeEH=()=>app.workspace.off("active-leaf-change",t),this.setTimer(),app.vault.on("rename",i),this.removeOnRename=()=>app.vault.off("rename",i),app.vault.on("modify",i),this.removeOnModify=()=>app.vault.off("modify",i),app.vault.on("create",i),this.removeOnCreate=()=>app.vault.off("create",i),app.vault.on("delete",i),this.removeOnDelete=()=>app.vault.off("delete",i);const n=[];app.workspace.iterateAllLeaves((e=>{e.view instanceof s.FileView&&e.view.file&&e.view.file.path!==this.ea.targetView.file.path&&n.push(e)})),await this.plugin.createIndex();let u=n[0];if(n.length>0){const e=app.workspace.getLastOpenFiles()[0];if(e&&""!==e){const t=n.filter((t=>{var i;return(null===(i=t.view)||void 0===i?void 0:i.file.path)===e}));t.length>0&&(u=t[0])}t(u)}}setTimer(){this.removeTimer&&(this.removeTimer(),this.removeTimer=void 0);const e=setInterval((async()=>{this.blockUpdateTimer||this.vaultFileChanged&&(this.vaultFileChanged=!1,await this.plugin.createIndex(),this.centralPagePath&&(this.plugin.pages.get(this.centralPagePath)||this.centralLeaf&&this.centralLeaf.view&&this.centralLeaf.view.file&&(this.centralPagePath=this.centralLeaf.view.file.path)),this.render())}),this.plugin.settings.indexUpdateInterval);this.removeTimer=()=>clearInterval(e)}unloadScene(){var e,t;if(this.removeEH&&(this.removeEH(),this.removeEH=void 0),this.removeTimer&&(this.removeTimer(),this.removeTimer=void 0),this.removeOnRename&&(this.removeOnRename(),this.removeOnRename=void 0),this.removeOnModify&&(this.removeOnModify(),this.removeOnModify=void 0),this.removeOnCreate&&(this.removeOnCreate(),this.removeOnCreate=void 0),this.removeOnDelete&&(this.removeOnDelete(),this.removeOnDelete=void 0),this.ea.targetView&&isBoolean(this.ea.targetView.linksAlwaysOpenInANewPane)&&(this.ea.targetView.linksAlwaysOpenInANewPane=!1),this.ea.targetView&&this.ea.targetView.excalidrawAPI)try{this.ea.targetView.semaphores.saving=!1,this.ea.targetView.excalidrawAPI.setMobileModeAllowed(!0),this.ea.targetView.excalidrawAPI.updateScene({appState:{viewModeEnabled:!1}})}catch(e){}if(this.ea.targetView&&this.ea.targetView._loaded)try{this.ea.deregisterThisAsViewEA()}catch(e){}(async()=>{const e=this.plugin.settings.navigationHistory.slice();await this.plugin.loadSettings(),this.plugin.settings.navigationHistory=e,await this.plugin.saveSettings()})(),null===(e=this.toolsPanel)||void 0===e||e.terminate(),this.toolsPanel=void 0,null===(t=this.historyPanel)||void 0===t||t.terminate(),this.historyPanel=void 0,this.ea.targetView=void 0,this.leaf=void 0,this.centralLeaf=void 0,this.centralPagePath=void 0,this.terminated=!0,app.plugins.plugins["obsidian-excalidraw-plugin"]||(this.plugin.EA=null),new s.Notice("Brain Graph Off")}}class Bu extends s.EditorSuggest{constructor(e){super(e.app),this.getKeys=()=>{const e=this.plugin.settings.hierarchy,t=this.suggestType;return"all"===t?[...e.parents,...e.children,...e.leftFriends,...e.rightFriends,...e.previous,...e.next].sort(((e,t)=>e.toLowerCase()>t.toLowerCase()?1:-1)):"parent"===t?e.parents:"child"===t?e.children:"rightFriend"===t?e.rightFriends:"leftFriend"===t?e.leftFriends:"previous"===t?e.previous:e.next},this.getTrigger=()=>{const e=this.suggestType,t=this.plugin.settings;return"all"===e?t.ontologySuggesterTrigger:"parent"===e?t.ontologySuggesterParentTrigger:"child"===e?t.ontologySuggesterChildTrigger:"rightFriend"===e?t.ontologySuggesterRightFriendTrigger:"leftFriend"===e?t.ontologySuggesterLeftFriendTrigger:"previous"===e?t.ontologySuggesterPreviousTrigger:t.ontologySuggesterNextTrigger},this.getSuggestions=e=>{const t=e.query.toLowerCase();return this.getKeys().filter((e=>e.toLowerCase().includes(t)))},this.plugin=e}onTrigger(e,t,i){const s=this.plugin.settings;if(s.allowOntologySuggester){const i=t.getLine(e.line).substring(0,e.ch),n=new RegExp(`(^${s.ontologySuggesterTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterTrigger}|^${s.ontologySuggesterParentTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterParentTrigger}|^${s.ontologySuggesterChildTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterChildTrigger}|^${s.ontologySuggesterLeftFriendTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterLeftFriendTrigger}|^${s.ontologySuggesterRightFriendTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterRightFriendTrigger}|^${s.ontologySuggesterPreviousTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterPreviousTrigger}|^${s.ontologySuggesterNextTrigger}|\\${s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterNextTrigger})([^\\s\\${s.ontologySuggesterTrigger}]*)`,"g");let u,r,a;const o=i.matchAll(n);for(;!(a=o.next()).done;)r=a.value[1],u=a.value[2];if(void 0!==u){switch(r){case s.ontologySuggesterTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterTrigger:this.suggestType="all";break;case s.ontologySuggesterParentTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterParentTrigger:this.suggestType="parent";break;case s.ontologySuggesterChildTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterChildTrigger:this.suggestType="child";break;case s.ontologySuggesterRightFriendTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterRightFriendTrigger:this.suggestType="rightFriend";break;case s.ontologySuggesterPreviousTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterPreviousTrigger:this.suggestType="previous";break;case s.ontologySuggesterNextTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterNextTrigger:this.suggestType="next";break;case s.ontologySuggesterLeftFriendTrigger:case s.ontologySuggesterMidSentenceTrigger+s.ontologySuggesterLeftFriendTrigger:this.suggestType="leftFriend";break;default:this.suggestType="all"}return this.latestTriggerInfo={end:e,start:{ch:e.ch-u.length-this.getTrigger().length,line:e.line},query:u},this.latestTriggerInfo}}return null}renderSuggestion(e,t){t.createEl("b",{text:e})}selectSuggestion(e){const{context:t}=this;if(t){const i=this.plugin.settings.boldFields,s=(i?"**":"")+e+(i?"**":"")+":: ";if(t.editor.replaceRange(s,this.latestTriggerInfo.start,this.latestTriggerInfo.end),this.latestTriggerInfo.start.ch===this.latestTriggerInfo.end.ch){const e=this.latestTriggerInfo.end;e.ch+=s.length,t.editor.setCursor(e)}}}}class ku extends s.Plugin{constructor(e,t){super(e,t),this.hierarchyLowerCase={parents:[],children:[],leftFriends:[],rightFriends:[],previous:[],next:[]},this.scene=null,this.pluginLoaded=!1,this.starred=[],this.focusSearchAfterInitiation=!1,this.starred=[new m(null,"Initializing index, please wait",null,this,!1,!1,"Initializing index, please wait")]}async onload(){await this.loadSettings(),this.addSettingTab(new j(this.app,this)),this.registerEditorSuggest(new Bu(this)),this.app.workspace.onLayoutReady((()=>{this.DVAPI=Dn(),this.DVAPI?this.DVAPI.version.compare(">=","0.5.31")?(this.EA=v(),this.EA?this.EA.verifyMinimumPluginVersion("1.6.33")?(this.registerCommands(),this.registerExcalidrawAutomateHooks(),this.pluginLoaded=!0):new B(app,"âš  ExcaliBrain Disabled: Please upgrade Excalidraw and try again",L("EXCALIDRAW_MINAPP_VERSION")).show((async e=>{new s.Notice("Disabling ExcaliBrain Plugin",8e3),D({fn:this.onload,where:"main.ts/onload()",message:"ExcaliBrain requires a new version of Excalidraw"}),this.app.plugins.disablePlugin("excalibrain")})):new B(app,"âš  ExcaliBrain Disabled: Excalidraw Plugin not found",L("EXCALIDRAW_NOT_FOUND")).show((async e=>{new s.Notice("Disabling ExcaliBrain Plugin",8e3),D({fn:this.onload,where:"main.ts/onload()",message:"Excalidraw not found"}),this.app.plugins.disablePlugin("excalibrain")}))):new B(app,"âš  ExcaliBrain Disabled: Dataview upgrade requried",L("DATAVIEW_UPGRADE")).show((async e=>{new s.Notice("Disabling ExcaliBrain Plugin",8e3),D({fn:this.onload,where:"main.ts/onload()",message:"Dataview version error"}),this.app.plugins.disablePlugin("excalibrain")})):new B(app,"âš  ExcaliBrain Disabled: DataView Plugin not found",L("DATAVIEW_NOT_FOUND")).show((async e=>{new s.Notice("Disabling ExcaliBrain Plugin",8e3),D({fn:this.onload,where:"main.ts/onload()",message:"Dataview not found"}),this.app.plugins.disablePlugin("excalibrain")}))}))}async createIndex(){this.pages=new c(this),this.lowercasePathMap=new Map;let t=0;for(;this.app.metadataCache.inProgressTaskCount>0||this.DVAPI.index.importer.reloadQueue.length>0;)t++%100==10&&new s.Notice("ExcaliBrain is waiting for Dataview to update its index",1e3),await sleep(100);const n=(t,u)=>{t.children.forEach((t=>{if(t instanceof s.TFolder){const s=new m(this.pages,"folder:"+t.path,null,this,!0,!1,t.name);return this.pages.add("folder:"+t.path,s),s.addParent(u,e.DEFINED,i.FROM,"file-tree"),u.addChild(s,e.DEFINED,i.TO,"file-tree"),void n(t,s)}{this.lowercasePathMap.set(t.path.toLowerCase(),t.path);const s=new m(this.pages,t.path,t,this);this.pages.add(t.path,s),s.addParent(u,e.DEFINED,i.FROM,"file-tree"),u.addChild(s,e.DEFINED,i.TO,"file-tree")}}))},u=app.vault.getRoot(),r=new m(this.pages,"folder:/",null,this,!0,!1,"/");this.pages.add("folder:/",r),n(u,r);const a=Object.keys(app.metadataCache.getTags()).map((e=>e.substring(1).split("/")));a.forEach((t=>{const s=[];t.forEach(((t,n,u)=>{const r=u.slice(0,n+1).join("/"),a="tag:"+r;let o=this.pages.get(a);if(o)s.push(o);else if(o=new m(this.pages,a,null,this,!1,!0,this.settings.showFullTagName?r:t),this.pages.add(a,o),s.push(o),n>0){const t=s[n-1];o.addParent(t,e.DEFINED,i.FROM,"tag-tree"),t.addChild(o,e.DEFINED,i.TO,"tag-tree")}}))})),this.pages.addUnresolvedLinks(),this.pages.addResolvedLinks();const o=this;setTimeout((async()=>{const e=app.internalPlugins.getPluginById("bookmarks");if(!e){const e=app.internalPlugins.getPluginById("starred");if(!e)return;return void(o.starred=(await e.loadData()).items.filter((e=>"file"===e.type)).map((e=>e.path)).filter((e=>e!==o.settings.excalibrainFilepath&&o.pages.has(e))).map((e=>o.pages.get(e))))}e._loaded||await e.loadData();const t=e=>{if(!e)return;let i=e.filter((e=>"file"===e.type)).map((e=>e.path)).filter((e=>e!==o.settings.excalibrainFilepath&&o.pages.has(e))).map((e=>o.pages.get(e)));return i=i.concat(e.filter((e=>"folder"===e.type)).map((e=>e.path)).filter((e=>e!==o.settings.excalibrainFilepath&&o.pages.has(`folder:${e}`))).map((e=>o.pages.get(`folder:${e}`)))),e.filter((e=>"group"===e.type)).forEach((e=>i=i.concat(t(e.items)))),i};o.starred=t(e.instance.items)}))}excalidrawAvailable(){const e=v();return e?(!this.EA!==e&&(this.EA=e,this.registerExcalidrawAutomateHooks()),!0):(this.EA=null,this.scene&&this.scene.unloadScene(),new s.Notice("ExcaliBrain: Please start Excalidraw and try again.",4e3),!1)}revealBrainLeaf(){var e;if(!this.scene||this.scene.terminated)return;app.workspace.revealLeaf(this.scene.leaf);const t=app.plugins.getPlugin("obsidian-hover-editor");if(t){const e=t.activePopovers.filter((e=>e.leaves()[0]===this.scene.leaf))[0];e&&0===this.scene.leaf.view.containerEl.offsetHeight&&e.titleEl.querySelector("a.popover-action.mod-minimize").click()}const i=null===(e=this.scene.toolsPanel)||void 0===e?void 0:e.searchElement;null==i||i.focus()}registerCommands(){const e=(e,t)=>{var i;const n=null===(i=app.workspace.activeLeaf)||void 0===i?void 0:i.view;if(e)return n instanceof s.MarkdownView&&"source"===n.getMode();if(!(n instanceof s.MarkdownView)||"source"!==n.getMode())return!1;const u=n.editor.getCursor(),r=n.editor.getLine(u.line).match(/^([^\:]*)::/);return!!r&&((async()=>{const e=this.settings.navigationHistory;if(await this.loadSettings(),this.settings.navigationHistory=e,this.settings.hierarchy.parents.includes(r[1]))new s.Notice(`${r[1]} is already registered as a PARENT`);else if(this.settings.hierarchy.children.includes(r[1]))new s.Notice(`${r[1]} is already registered as a CHILD`);else if(this.settings.hierarchy.leftFriends.includes(r[1]))new s.Notice(`${r[1]} is already registered as a LEFT-SIDE FRIEND`);else if(this.settings.hierarchy.rightFriends.includes(r[1]))new s.Notice(`${r[1]} is already registered as a RIGHT-SIDE FRIEND`);else if(this.settings.hierarchy.previous.includes(r[1]))new s.Notice(`${r[1]} is already registered as a PREVIOUS (FRIEND)`);else if(this.settings.hierarchy.next.includes(r[1]))new s.Notice(`${r[1]} is already registered as a NEXT (FRIEND)`);else{switch(t){case"parent":this.settings.hierarchy.parents.push(r[1]),this.settings.hierarchy.parents=this.settings.hierarchy.parents.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.parents=[],this.settings.hierarchy.parents.forEach((e=>this.hierarchyLowerCase.parents.push(e.toLowerCase().replaceAll(" ","-"))));break;case"child":this.settings.hierarchy.children.push(r[1]),this.settings.hierarchy.children=this.settings.hierarchy.children.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.children=[],this.settings.hierarchy.children.forEach((e=>this.hierarchyLowerCase.children.push(e.toLowerCase().replaceAll(" ","-"))));break;case"rightFriend":this.settings.hierarchy.rightFriends.push(r[1]),this.settings.hierarchy.rightFriends=this.settings.hierarchy.rightFriends.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.rightFriends=[],this.settings.hierarchy.rightFriends.forEach((e=>this.hierarchyLowerCase.rightFriends.push(e.toLowerCase().replaceAll(" ","-"))));break;case"previous":this.settings.hierarchy.previous.push(r[1]),this.settings.hierarchy.previous=this.settings.hierarchy.previous.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.previous=[],this.settings.hierarchy.previous.forEach((e=>this.hierarchyLowerCase.previous.push(e.toLowerCase().replaceAll(" ","-"))));break;case"next":this.settings.hierarchy.next.push(r[1]),this.settings.hierarchy.next=this.settings.hierarchy.next.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.next=[],this.settings.hierarchy.next.forEach((e=>this.hierarchyLowerCase.next.push(e.toLowerCase().replaceAll(" ","-"))));break;default:this.settings.hierarchy.leftFriends.push(r[1]),this.settings.hierarchy.leftFriends=this.settings.hierarchy.leftFriends.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.hierarchyLowerCase.leftFriends=[],this.settings.hierarchy.leftFriends.forEach((e=>this.hierarchyLowerCase.leftFriends.push(e.toLowerCase().replaceAll(" ","-"))))}await this.saveSettings(),this.scene&&!this.scene.terminated&&(this.scene.vaultFileChanged=!0),new s.Notice(`Added ${r[1]} as ${t}`)}})(),!0)};this.addCommand({id:"excalibrain-addParentField",name:L("COMMAND_ADD_PARENT_FIELD"),checkCallback:t=>e(t,"parent")}),this.addCommand({id:"excalibrain-addChildField",name:L("COMMAND_ADD_CHILD_FIELD"),checkCallback:t=>e(t,"child")}),this.addCommand({id:"excalibrain-addLeftFriendField",name:L("COMMAND_ADD_LEFT_FRIEND_FIELD"),checkCallback:t=>e(t,"leftFriend")}),this.addCommand({id:"excalibrain-addRightFriendField",name:L("COMMAND_ADD_RIGHT_FRIEND_FIELD"),checkCallback:t=>e(t,"rightFriend")}),this.addCommand({id:"excalibrain-addPreviousField",name:L("COMMAND_ADD_PREVIOUS_FIELD"),checkCallback:t=>e(t,"previous")}),this.addCommand({id:"excalibrain-addNextField",name:L("COMMAND_ADD_NEXT_FIELD"),checkCallback:t=>e(t,"next")}),this.addCommand({id:"excalibrain-start",name:L("COMMAND_START"),checkCallback:e=>{if(e)return this.excalidrawAvailable();if(!this.excalidrawAvailable())return;if(this.scene&&!this.scene.terminated)return void this.revealBrainLeaf();const t=this.getBrainLeaf();if(t)return this.scene=new Lu(this,!0,t),this.scene.initialize(!0),void this.revealBrainLeaf();this.focusSearchAfterInitiation=!0,Lu.openExcalidrawLeaf(window.ExcalidrawAutomate,this.settings,t)}}),this.addCommand({id:"excalibrain-start-popout",name:L("COMMAND_START_POPOUT"),checkCallback:e=>{if(e)return!app.isMobile&&this.excalidrawAvailable();if(!this.excalidrawAvailable()||app.isMobile)return;if(this.scene&&!this.scene.terminated)return void this.revealBrainLeaf();const t=this.getBrainLeaf();if(t)return this.scene=new Lu(this,!0,t),this.scene.initialize(!0),void this.revealBrainLeaf();this.focusSearchAfterInitiation=!0,Lu.openExcalidrawLeaf(window.ExcalidrawAutomate,this.settings,app.workspace.openPopoutLeaf())}}),this.addCommand({id:"excalibrain-open-hover",name:L("COMMAND_START_HOVER"),checkCallback:e=>{const t=app.plugins.getPlugin("obsidian-hover-editor");if(e)return t&&this.excalidrawAvailable();if(this.excalidrawAvailable()&&t)if(!this.scene||this.scene.terminated)try{const e=this.getBrainLeaf();if(e){const i=t.activePopovers.filter((t=>t.leaves()[0]===e))[0];if(i)return app.workspace.revealLeaf(e),0===e.view.containerEl.offsetHeight&&i.titleEl.querySelector("a.popover-action.mod-maximize").click(),this.scene=new Lu(this,!0,e),void this.scene.initialize(!0)}const i=t.spawnPopover(void 0,(()=>{if(this.app.workspace.setActiveLeaf(i,!1,!0),!t.activePopovers.filter((e=>e.leaves()[0]===i))[0])return new s.Notice(L("HOVER_EDITOR_ERROR"),6e3),!1;setTimeout((()=>app.commands.executeCommandById("obsidian-hover-editor:snap-active-popover-to-viewport"))),this.focusSearchAfterInitiation=!0,Lu.openExcalidrawLeaf(window.ExcalidrawAutomate,this.settings,i)}))}catch(e){new s.Notice(L("HOVER_EDITOR_ERROR"),6e3)}else this.revealBrainLeaf()}})}getBrainLeaf(){let e;return app.workspace.iterateAllLeaves((t=>{t.view&&this.EA.isExcalidrawView(t.view)&&t.view instanceof s.TextFileView&&t.view.file.path===this.settings.excalibrainFilepath&&(e=t)})),e}registerExcalidrawAutomateHooks(){this.EA.onViewModeChangeHook=e=>{var t;this.EA.targetView&&(null===(t=this.EA.targetView.file)||void 0===t?void 0:t.path)===this.settings.excalibrainFilepath&&(e||this.stop())},this.EA.onLinkHoverHook=(e,t)=>{var i;return!(this.scene&&this.EA.targetView&&(null===(i=this.EA.targetView.file)||void 0===i?void 0:i.path)===this.settings.excalibrainFilepath&&this.EA.targetView.excalidrawAPI&&this.EA.targetView.excalidrawAPI.getAppState().viewModeEnabled&&(this.scene.disregardLeafChange=!0,this.disregardLeafChangeTimer&&clearTimeout(this.disregardLeafChangeTimer),this.disregardLeafChangeTimer=setTimeout((()=>{this.disregardLeafChangeTimer=null,this.scene&&(this.scene.disregardLeafChange=!1)}),1e3),0))},this.EA.onLinkClickHook=(e,t,i)=>{var n,u,r,a,o,l,D,h,d,c,g;const p=t.match(/\[\[([^\]]*)/)[1],F=this.pages.get(p);if(!i.shiftKey&&F&&F.isVirtual)return null===(n=this.scene)||void 0===n||n.renderGraphForPath(p),!1;if(!t.startsWith("[[folder:")&&!t.startsWith("[[tag:")){if((null===(o=null===(a=null===(r=null===(u=this.scene)||void 0===u?void 0:u.centralLeaf)||void 0===r?void 0:r.view)||void 0===a?void 0:a.file)||void 0===o?void 0:o.path)===p)return null===(l=this.scene)||void 0===l||l.renderGraphForPath(p),!1;if((null===(D=this.scene)||void 0===D?void 0:D.pinLeaf)&&(null===(h=this.scene)||void 0===h?void 0:h.isCentralLeafStillThere())){const e=app.vault.getAbstractFileByPath(p.split("#")[0]);if(e&&e instanceof s.TFile)return this.scene.centralLeaf.openFile(e),this.scene.renderGraphForPath(p),!1}if(null===(d=this.scene)||void 0===d?void 0:d.isCentralLeafStillThere()){const e=app.vault.getAbstractFileByPath(p.split("#")[0]);if(e&&e instanceof s.TFile)return this.scene.centralLeaf.openFile(e),this.scene.renderGraphForPath(p),!1}return null===(c=this.scene)||void 0===c||c.renderGraphForPath(p,!1),!0}return null===(g=this.scene)||void 0===g||g.renderGraphForPath(p),!1},this.EA.onViewUnloadHook=e=>{this.scene&&this.scene.leaf===e.leaf&&this.stop()}}onunload(){this.scene&&(this.scene.unloadScene(),this.scene=null)}setHierarchyLinkStylesExtended(){this.hierarchyLinkStylesExtended={},Object.entries(this.settings.hierarchyLinkStyles).forEach((e=>{const t=e[0].toLowerCase().replaceAll(" ","-");this.hierarchyLinkStylesExtended[e[0]]=e[1],e[0]!==t&&(this.hierarchyLinkStylesExtended[t]=e[1])}))}loadCustomNodeLabelFunction(){if(this.settings.nodeTitleScript)try{this.customNodeLabel=new Function("dvPage","defaultName","return "+this.settings.nodeTitleScript)}catch(e){D({fn:this.loadCustomNodeLabelFunction,message:"error processing custom node label script",where:"loadCustomNodeLabelFunction()",data:this.settings.nodeTitleScript,error:e}),new s.Notice("Could not load custom node label function. See Developer console for details"),this.customNodeLabel=null}else this.customNodeLabel=null}async loadSettings(){var e;this.settings=Object.assign({},_,await this.loadData()),this.settings.hierarchy.exclusions||(this.settings.hierarchy.exclusions=A.exclusions),this.loadCustomNodeLabelFunction(),this.settings.baseLinkStyle=Object.assign(Object.assign({},x),this.settings.baseLinkStyle),this.settings.baseNodeStyle=Object.assign(Object.assign({},T),this.settings.baseNodeStyle),this.hierarchyLowerCase.parents=[],this.settings.hierarchy.parents=this.settings.hierarchy.parents.sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.parents.forEach((e=>this.hierarchyLowerCase.parents.push(e.toLowerCase().replaceAll(" ","-"))));let t=[...this.hierarchyLowerCase.parents];this.hierarchyLowerCase.children=[],this.settings.hierarchy.children=this.settings.hierarchy.children.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.children.forEach((e=>this.hierarchyLowerCase.children.push(e.toLowerCase().replaceAll(" ","-")))),t=[...t,...this.hierarchyLowerCase.children],this.hierarchyLowerCase.leftFriends=[],this.settings.hierarchy.leftFriends||(this.settings.hierarchy.leftFriends=null!==(e=this.settings.hierarchy.friends)&&void 0!==e?e:A.leftFriends),this.settings.hierarchy.leftFriends=this.settings.hierarchy.leftFriends.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.leftFriends.forEach((e=>this.hierarchyLowerCase.leftFriends.push(e.toLowerCase().replaceAll(" ","-")))),t=[...t,...this.hierarchyLowerCase.leftFriends],this.hierarchyLowerCase.rightFriends=[],this.settings.hierarchy.rightFriends||(this.settings.hierarchy.rightFriends=A.rightFriends),this.settings.hierarchy.rightFriends=this.settings.hierarchy.rightFriends.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.rightFriends.forEach((e=>this.hierarchyLowerCase.rightFriends.push(e.toLowerCase().replaceAll(" ","-")))),t=[...t,...this.hierarchyLowerCase.rightFriends],this.hierarchyLowerCase.previous=[],this.settings.hierarchy.previous||(this.settings.hierarchy.previous=A.previous),this.settings.hierarchy.previous=this.settings.hierarchy.previous.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.previous.forEach((e=>this.hierarchyLowerCase.previous.push(e.toLowerCase().replaceAll(" ","-")))),t=[...t,...this.hierarchyLowerCase.previous],this.hierarchyLowerCase.next=[],this.settings.hierarchy.next||(this.settings.hierarchy.next=A.next),this.settings.hierarchy.next=this.settings.hierarchy.next.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.settings.hierarchy.next.forEach((e=>this.hierarchyLowerCase.next.push(e.toLowerCase().replaceAll(" ","-")))),t=[...t,...this.hierarchyLowerCase.next],this.settings.hierarchy.exclusions=this.settings.hierarchy.exclusions.filter((e=>!t.includes(e.toLowerCase().replaceAll(" ","-")))).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1)),this.setHierarchyLinkStylesExtended(),this.linkStyles={},this.linkStyles.base={style:this.settings.baseLinkStyle,allowOverride:!1,userStyle:!1,display:L("LINKSTYLE_BASE"),getInheritedStyle:()=>this.settings.baseLinkStyle},this.linkStyles.inferred={style:this.settings.inferredLinkStyle,allowOverride:!0,userStyle:!1,display:L("LINKSTYLE_INFERRED"),getInheritedStyle:()=>this.settings.baseLinkStyle},this.linkStyles["file-tree"]={style:this.settings.folderLinkStyle,allowOverride:!0,userStyle:!1,display:L("LINKSTYLE_FOLDER"),getInheritedStyle:()=>this.settings.baseLinkStyle},this.linkStyles["tag-tree"]={style:this.settings.tagLinkStyle,allowOverride:!0,userStyle:!1,display:L("LINKSTYLE_TAG"),getInheritedStyle:()=>this.settings.baseLinkStyle},Object.entries(this.settings.hierarchyLinkStyles).forEach((e=>{b.contains(e[0])||(this.linkStyles[e[0]]={style:e[1],allowOverride:!0,userStyle:!0,display:e[0],getInheritedStyle:()=>this.settings.baseLinkStyle})})),this.nodeStyles={},this.nodeStyles.base={style:this.settings.baseNodeStyle,allowOverride:!1,userStyle:!1,display:L("NODESTYLE_BASE"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.inferred={style:this.settings.inferredNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_INFERRED"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.virtual={style:this.settings.virtualNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_VIRTUAL"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.central={style:this.settings.centralNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_CENTRAL"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.sibling={style:this.settings.siblingNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_SIBLING"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.attachment={style:this.settings.attachmentNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_ATTACHMENT"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.folder={style:this.settings.folderNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_FOLDER"),getInheritedStyle:()=>this.settings.baseNodeStyle},this.nodeStyles.tag={style:this.settings.tagNodeStyle,allowOverride:!0,userStyle:!1,display:L("NODESTYLE_TAG"),getInheritedStyle:()=>this.settings.baseNodeStyle},Object.entries(this.settings.tagNodeStyles).sort(((e,t)=>e[0].toLowerCase()<t[0].toLowerCase()?-1:1)).forEach((e=>{this.nodeStyles[e[0]]={style:e[1],allowOverride:!0,userStyle:!0,display:e[0],getInheritedStyle:()=>this.settings.baseNodeStyle}}))}async saveSettings(){await this.saveData(this.settings)}stop(){this.scene&&!this.scene.terminated&&(this.scene.unloadScene(),this.scene=null)}async start(e){if(!e.view)return;if(!(e.view instanceof s.TextFileView))return void new s.Notice("Wrong view type. Cannot start ExcaliBrain.");if(e.view.file.path!==this.settings.excalibrainFilepath)return void new s.Notice(`The brain file is not the one configured in settings!\nThe file in settings is ${this.settings.excalibrainFilepath}.\nThis file is ${e.view.file.path}.\nPlease start ExcaliBrain using the Command Palette action.`,5e3);let t=0;for(;!this.pluginLoaded&&t++<100;)await sleep(50);if(!this.pluginLoaded)return new s.Notice("ExcaliBrain plugin did not load - aborting start()"),void D({where:"ExcaliBrain.start()",fn:this.start,message:"ExcaliBrain did not load. Aborting after 5000ms of trying"});this.excalidrawAvailable()&&(this.stop(),e?(this.scene=new Lu(this,!0,e),this.scene.initialize(this.focusSearchAfterInitiation),this.focusSearchAfterInitiation=!1):await Lu.openExcalidrawLeaf(window.ExcalidrawAutomate,this.settings,this.getBrainLeaf()))}}module.exports=ku;